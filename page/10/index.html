<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.iexxk.com","root":"/","images":"/images","scheme":"Muse","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="e想天开，天马行空">
<meta property="og:type" content="website">
<meta property="og:title" content="e想行空">
<meta property="og:url" content="https://blog.iexxk.com/page/10/index.html">
<meta property="og:site_name" content="e想行空">
<meta property="og:description" content="e想天开，天马行空">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="e想行空">
<meta property="article:tag" content="exxk,e想行空">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.iexxk.com/page/10/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>e想行空</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">e想行空</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="e想行空"
      src="/uploads/headimg.jpg">
  <p class="site-author-name" itemprop="name">e想行空</p>
  <div class="site-description" itemprop="description">e想天开，天马行空</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">239</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">311</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/iexxk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;iexxk" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:exxk.lx@gmail.com" title="E-Mail → mailto:exxk.lx@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/iexxk" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/06/04/tools-jenkins-pipline/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/06/04/tools-jenkins-pipline/" class="post-title-link" itemprop="url">Tools-Jenkins-pipeline</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-06-04 14:33:16" itemprop="dateCreated datePublished" datetime="2018-06-04T14:33:16+00:00">2018-06-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
    <span id="/2018/06/04/tools-jenkins-pipline/" class="post-meta-item leancloud_visitors" data-flag-title="Tools-Jenkins-pipeline" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="jenkins使用pipeline"><a href="#jenkins使用pipeline" class="headerlink" title="jenkins使用pipeline"></a>jenkins使用pipeline</h2><p>脚本名词解释</p>
<h5 id="pipeline-lt-必须-gt-Pipeline是CD管道的用户定义模型。Pipeline的代码定义了您的整个构建过程，通常包括构建应用程序，测试和交付应用程序的阶段。"><a href="#pipeline-lt-必须-gt-Pipeline是CD管道的用户定义模型。Pipeline的代码定义了您的整个构建过程，通常包括构建应用程序，测试和交付应用程序的阶段。" class="headerlink" title="pipeline &lt;必须&gt; Pipeline是CD管道的用户定义模型。Pipeline的代码定义了您的整个构建过程，通常包括构建应用程序，测试和交付应用程序的阶段。"></a><code>pipeline</code> <strong>&lt;必须&gt;</strong> Pipeline是CD管道的用户定义模型。Pipeline的代码定义了您的整个构建过程，通常包括构建应用程序，测试和交付应用程序的阶段。</h5><h5 id="agent-lt-必须-gt-定义pipeline的执行环境，必须存在"><a href="#agent-lt-必须-gt-定义pipeline的执行环境，必须存在" class="headerlink" title="agent &lt;必须&gt; 定义pipeline的执行环境，必须存在"></a><code>agent</code> <strong>&lt;必须&gt;</strong> 定义pipeline的执行环境，必须存在</h5><h5 id="stages-lt-阶段-gt-包含多个子阶段stage-‘子阶段名’"><a href="#stages-lt-阶段-gt-包含多个子阶段stage-‘子阶段名’" class="headerlink" title="stages&lt;阶段&gt; 包含多个子阶段stage(‘子阶段名’)"></a><code>stages</code>&lt;阶段&gt; 包含多个子阶段stage(‘子阶段名’)</h5><p> jenkins 的工作空间目录 <code>/var/jenkins_home/workspace/</code></p>
<h3 id="node-vs-agent-区别"><a href="#node-vs-agent-区别" class="headerlink" title="node vs agent 区别"></a>node vs agent 区别</h3><p>agent是声明性的pipelines，node是脚本性的pipelines</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h4 id="pipeline使用gradle"><a href="#pipeline使用gradle" class="headerlink" title="pipeline使用gradle"></a>pipeline使用gradle</h4><p>学习到如何使用工具，和配置工具全局变量</p>
<ol>
<li><p>配置工具<code>系统管理-&gt;全局工具配置-&gt;Gradle-&gt;Gradle 安装</code></p>
<p>name：gradle4.8</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 自动安装</li>
</ul>
<p>版本 Gradle 4.8</p>
<p><code>Apply-&gt;Save</code>即可</p>
<p>注释：如果没有Gradle设置，先去安装Gradle插件，默认推荐设置是安装了的</p>
</li>
<li><p>编写Jenkinsfile进行测试</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env groovy Jenkinsfile</span></span><br><span class="line">node &#123;</span><br><span class="line">	<span class="keyword">def</span> gradleHome = tool <span class="string">&#x27;gradle4.8&#x27;</span>   <span class="comment">//这里的gradle4.8要和gradle工具的配置里的name要一致</span></span><br><span class="line">	env.PATH = <span class="string">&quot;$&#123;gradleHome&#125;/bin:$&#123;env.PATH&#125;&quot;</span></span><br><span class="line">	stage(<span class="string">&#x27;build&#x27;</span>) &#123;</span><br><span class="line">		sh <span class="string">&#x27;gradle -v&#x27;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="pipeline使用gradle打包java-spring-boot"><a href="#pipeline使用gradle打包java-spring-boot" class="headerlink" title="pipeline使用gradle打包java spring boot"></a>pipeline使用gradle打包java spring boot</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env groovy Jenkinsfile</span></span><br><span class="line">node &#123;</span><br><span class="line">    <span class="keyword">def</span> gradleHome = tool <span class="string">&#x27;gradle4.8&#x27;</span>  <span class="comment">//这里的gradle4.8要和gradle工具的配置里的name要一致</span></span><br><span class="line">    env.PATH = <span class="string">&quot;$&#123;gradleHome&#125;/bin:$&#123;env.PATH&#125;&quot;</span></span><br><span class="line">    stage(<span class="string">&#x27;gradle build&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isUnix()) &#123;</span><br><span class="line">            <span class="comment">//sh &#x27;./gradlew clean :eurekaserver:build&#x27;  //这里会自动下载项目里的gradle版本(4.7)</span></span><br><span class="line">            sh <span class="string">&#x27;gradle clean :eurekaserver:build&#x27;</span> <span class="comment">//使用jenkns安装的gradle工具(4.8)</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">// bat &#x27;gradlew.bat clean :eurekaserver:build&#x27;</span></span><br><span class="line">            bat <span class="string">&#x27;gradle clean :eurekaserver:build&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="打包jar为镜像"><a href="#打包jar为镜像" class="headerlink" title="打包jar为镜像"></a>打包jar为镜像</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env groovy Jenkinsfile</span></span><br><span class="line">node &#123;</span><br><span class="line">    <span class="keyword">def</span> gradleHome = tool <span class="string">&#x27;gradle4.8&#x27;</span>  <span class="comment">//这里的gradle4.8要和gradle工具的配置里的name要一致</span></span><br><span class="line">    env.PATH = <span class="string">&quot;$&#123;gradleHome&#125;/bin:$&#123;env.PATH&#125;&quot;</span></span><br><span class="line">    stage(<span class="string">&#x27;gradle build&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isUnix()) &#123;</span><br><span class="line">            <span class="comment">//sh &#x27;./gradlew clean :eurekaserver:build&#x27;  //这里会自动下载项目里的gradle版本(4.7)</span></span><br><span class="line">            sh <span class="string">&#x27;gradle clean :eurekaserver:build&#x27;</span> <span class="comment">//使用jenkns安装的gradle工具(4.8)</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">// bat &#x27;gradlew.bat clean :eurekaserver:build&#x27;</span></span><br><span class="line">            bat <span class="string">&#x27;gradle clean :eurekaserver:build&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&#x27;docker build image&#x27;</span>)&#123;</span><br><span class="line">        dir(<span class="string">&#x27;eurekaserver&#x27;</span>)&#123;  <span class="comment">//dockerfile的跟目录</span></span><br><span class="line">            docker.build(<span class="string">&quot;springcould/eurekaserver:$&#123;env.BUILD_NUMBER&#125;&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="运行镜像"><a href="#运行镜像" class="headerlink" title="运行镜像"></a>运行镜像</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env groovy Jenkinsfile</span></span><br><span class="line">node &#123;</span><br><span class="line">    <span class="keyword">def</span> gradleHome = tool <span class="string">&#x27;gradle4.8&#x27;</span>  <span class="comment">//这里的gradle4.8要和gradle工具的配置里的name要一致</span></span><br><span class="line">    env.PATH = <span class="string">&quot;$&#123;gradleHome&#125;/bin:$&#123;env.PATH&#125;&quot;</span></span><br><span class="line">    stage(<span class="string">&#x27;gradle build&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isUnix()) &#123;</span><br><span class="line">            sh <span class="string">&#x27;gradle clean :eurekaserver:build&#x27;</span> <span class="comment">//使用jenkns安装的gradle工具(4.8)</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            bat <span class="string">&#x27;gradle clean :eurekaserver:build&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&#x27;docker build image&#x27;</span>)&#123;</span><br><span class="line">        dir(<span class="string">&#x27;eurekaserver&#x27;</span>)&#123;  <span class="comment">//dockerfile的跟目录</span></span><br><span class="line">            docker.build(<span class="string">&quot;springcould/eurekaserver:$&#123;env.BUILD_NUMBER&#125;&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&#x27;docker run Application&#x27;</span>)&#123;</span><br><span class="line">        sh <span class="string">&quot;docker run -p 8091:8091 springcould/eurekaserver:$&#123;env.BUILD_NUMBER&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="pipeline-环境变量选择设置"><a href="#pipeline-环境变量选择设置" class="headerlink" title="pipeline 环境变量选择设置"></a>pipeline 环境变量选择设置</h4><h6 id="严重注意-这个需要第二次运行才会生效，第一次设置之后运行，不会出来，第二次拉去运行才会出来"><a href="#严重注意-这个需要第二次运行才会生效，第一次设置之后运行，不会出来，第二次拉去运行才会出来" class="headerlink" title="**严重注意**这个需要第二次运行才会生效，第一次设置之后运行，不会出来，第二次拉去运行才会出来"></a><code>**严重注意**</code>这个需要第二次运行才会生效，第一次设置之后运行，不会出来，第二次拉去运行才会出来</h6><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env groovy Jenkinsfile</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    parameters &#123;</span><br><span class="line">        choice(<span class="attr">name:</span> <span class="string">&#x27;door_choice&#x27;</span>,</span><br><span class="line">                <span class="symbol">choices:</span> <span class="string">&#x27;one\ntwo\nthree\nfour&#x27;</span>,</span><br><span class="line">                <span class="symbol">description:</span> <span class="string">&#x27;What door do you choose?&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;build&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&quot;$&#123;params.door_choice&#125;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="pipeline-agent版gradle脚本"><a href="#pipeline-agent版gradle脚本" class="headerlink" title="pipeline agent版gradle脚本"></a>pipeline agent版gradle脚本</h4><p>not support <code>tool &quot;gradle4.8&quot;</code>单个设置</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env groovy Jenkinsfile</span></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    parameters &#123;</span><br><span class="line">        choice(<span class="attr">name:</span> <span class="string">&#x27;door_choice&#x27;</span>,</span><br><span class="line">                <span class="symbol">choices:</span> <span class="string">&#x27;one\ntwo\nthree\nfour&#x27;</span>,</span><br><span class="line">                <span class="symbol">description:</span> <span class="string">&#x27;What door do you choose?&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;build&#x27;</span>) &#123;</span><br><span class="line">            tools&#123;</span><br><span class="line">                gradle <span class="string">&quot;gradle4.8&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo <span class="string">&quot;$&#123;params.door_choice&#125;&quot;</span></span><br><span class="line">                sh <span class="string">&#x27;gradle -v&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="申明式使用脚本式语言script"><a href="#申明式使用脚本式语言script" class="headerlink" title="申明式使用脚本式语言script"></a>申明式使用脚本式语言<code>script</code></h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env groovy Jenkinsfile</span></span><br><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line">    parameters &#123;</span><br><span class="line">        choice(<span class="attr">name:</span> <span class="string">&#x27;project_choice&#x27;</span>,</span><br><span class="line">                <span class="symbol">choices:</span> <span class="string">&#x27;eurekaserver\neurekaclient\neurekafeign\neurekazuul&#x27;</span>,</span><br><span class="line">                <span class="symbol">description:</span> <span class="string">&#x27;你要编译构建那个项目?&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;docker build&#x27;</span>)&#123;</span><br><span class="line">            steps&#123;</span><br><span class="line">               dir(<span class="string">&quot;$&#123;params.project_choice&#125;&quot;</span>)&#123;</span><br><span class="line">                   sh <span class="string">&quot;pwd&quot;</span></span><br><span class="line">                   script &#123;  <span class="comment">//需要用script包裹，就能使用脚本式语言</span></span><br><span class="line">                       docker.build(<span class="string">&quot;my-image:$&#123;env.BUILD_ID&#125;&quot;</span>)</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>env.BUILD_ID 当前的编译id，和Jenkins versions 1.597+ 的env.BUILD_NUMBER一样</p>
<p>env.JOB_NAME 当前项目名</p>
<p>env.JENKINS_URL only available if Jenkins URL set in “System Configuration”</p>
<p><code> git diff HEAD^ eurekaserver/</code> 和上个版本比较eurekaserver目录，可以不要</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://github.com/arun-gupta/docker-jenkins-pipeline">https://github.com/arun-gupta/docker-jenkins-pipeline</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/29/android-osmdroid/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/29/android-osmdroid/" class="post-title-link" itemprop="url">Android-osmdroid</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-29 15:59:44" itemprop="dateCreated datePublished" datetime="2018-05-29T15:59:44+00:00">2018-05-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-28 17:53:22" itemprop="dateModified" datetime="2018-12-28T17:53:22+00:00">2018-12-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
    <span id="/2018/05/29/android-osmdroid/" class="post-meta-item leancloud_visitors" data-flag-title="Android-osmdroid" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="参考工具"><a href="#参考工具" class="headerlink" title="参考工具"></a>参考工具</h4><p>github: <a target="_blank" rel="noopener" href="https://github.com/osmdroid/osmdroid">osmdroid/osmdroid</a></p>
<p><code>compile &#39;org.osmdroid:osmdroid-android:&lt;VERSION&gt;&#39;</code></p>
<p>离线地图制作工具: <a target="_blank" rel="noopener" href="http://mobac.sourceforge.net/">Mobile Atlas Creator</a></p>
<p><a target="_blank" rel="noopener" href="https://mobiledevstories.wordpress.com/2014/02/27/osmdroid-mobile-atlas-creator-tutorial/">使用Mobile Atlas Creator</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/osmdroid/osmdroid/wiki/Map-Sources">wiki map sources</a></p>
<p>离线地图工具类<a target="_blank" rel="noopener" href="https://github.com/osmdroid/osmdroid/blob/master/OpenStreetMapViewer/src/main/java/org/osmdroid/samplefragments/tileproviders/SampleOfflineOnly.java">SampleOfflineOnly.java</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/osmdroid/osmdroid/wiki/Offline-Map-Tiles">离线地图官方教程Offline-Map-Tiles</a></p>
<h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><h5 id="离线地图制作"><a href="#离线地图制作" class="headerlink" title="离线地图制作"></a>离线地图制作</h5><ol>
<li>打开<a target="_blank" rel="noopener" href="http://mobac.sourceforge.net/">Mobile Atlas Creator</a>工具</li>
<li>新建地图册（可选Osmdroid ZIP/SQLite/GEMF）</li>
<li>选择地图源</li>
<li>勾选图片转换，设置图块格式(<strong>重要，要和代码的设置一致</strong>)</li>
<li>设置缩放比例</li>
<li>地图上框选区域</li>
<li>在当前地图册点击添加选择区域</li>
<li>最后开始点击下载地图册</li>
<li>得到一个压缩文件，存储备用</li>
</ol>
<h5 id="离线地图自定义地图源-geoserver"><a href="#离线地图自定义地图源-geoserver" class="headerlink" title="离线地图自定义地图源(geoserver)"></a>离线地图自定义地图源(geoserver)</h5><ol>
<li><p>在<a target="_blank" rel="noopener" href="http://mobac.sourceforge.net/">Mobile Atlas Creator</a>工具目录的<code>mapsources</code>目录添加地图源配置文件</p>
</li>
<li><p>geoserver地图地图源配置文件<code>geoserver_maps.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">customWmsMapSource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>My Geoserver WMS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">minZoom</span>&gt;</span>0<span class="tag">&lt;/<span class="name">minZoom</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maxZoom</span>&gt;</span>18<span class="tag">&lt;/<span class="name">maxZoom</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tileType</span>&gt;</span>PNG<span class="tag">&lt;/<span class="name">tileType</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 图层名字hws(工作空间):china_net(图层名字) --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">layers</span>&gt;</span>hws:china_net<span class="tag">&lt;/<span class="name">layers</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- hws替换为自己的工作区间，ip端口替换自己服务器的，其他不变 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.1.230:8082/geoserver/hws/wms?service=WMS<span class="symbol">&amp;amp;</span><span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 投影坐标系 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">coordinatesystem</span>&gt;</span>EPSG:4326<span class="tag">&lt;/<span class="name">coordinatesystem</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aditionalparameters</span>&gt;</span><span class="tag">&lt;/<span class="name">aditionalparameters</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">backgroundColor</span>&gt;</span>#000000<span class="tag">&lt;/<span class="name">backgroundColor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">customWmsMapSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>多图层配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">customMultiLayerMapSource</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>多图层自定义<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tileType</span>&gt;</span>png<span class="tag">&lt;/<span class="name">tileType</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">backgroundColor</span>&gt;</span>#000000<span class="tag">&lt;/<span class="name">backgroundColor</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 0~1由透明到不透明，1.0是设置对底层的图层，0.5是设置底层上一层图层，以此类推n图层以此设置即可--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">layersAlpha</span>&gt;</span>1.0 1.0 0.5 1.0<span class="tag">&lt;/<span class="name">layersAlpha</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">layers</span>&gt;</span></span><br><span class="line">       		<span class="tag">&lt;<span class="name">customMapSource</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Google 卫星图<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">minZoom</span>&gt;</span>0<span class="tag">&lt;/<span class="name">minZoom</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">maxZoom</span>&gt;</span>20<span class="tag">&lt;/<span class="name">maxZoom</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">tileType</span>&gt;</span>PNG<span class="tag">&lt;/<span class="name">tileType</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">tileUpdate</span>&gt;</span>None<span class="tag">&lt;/<span class="name">tileUpdate</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mt0.google.cn/vt/lyrs=s@124<span class="symbol">&amp;amp;</span>hl=zh-CN<span class="symbol">&amp;amp;</span>gl=CN<span class="symbol">&amp;amp;</span>src=app<span class="symbol">&amp;amp;</span>x=&#123;$x&#125;<span class="symbol">&amp;amp;</span>s=<span class="symbol">&amp;amp;</span>y=&#123;$y&#125;<span class="symbol">&amp;amp;</span>z=&#123;$z&#125;<span class="symbol">&amp;amp;</span>s=Galileo<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">backgroundColor</span>&gt;</span>#000000<span class="tag">&lt;/<span class="name">backgroundColor</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">customMapSource</span>&gt;</span> </span><br><span class="line">       </span><br><span class="line">        <span class="tag">&lt;<span class="name">customMapSource</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Google 地名图<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">minZoom</span>&gt;</span>0<span class="tag">&lt;/<span class="name">minZoom</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">maxZoom</span>&gt;</span>20<span class="tag">&lt;/<span class="name">maxZoom</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">tileType</span>&gt;</span>PNG<span class="tag">&lt;/<span class="name">tileType</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">tileUpdate</span>&gt;</span>None<span class="tag">&lt;/<span class="name">tileUpdate</span>&gt;</span> </span><br><span class="line">           <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mt0.google.cn/vt/imgtp=png32<span class="symbol">&amp;amp;</span>lyrs=h@207000000<span class="symbol">&amp;amp;</span>hl=zh-CN<span class="symbol">&amp;amp;</span>gl=CN<span class="symbol">&amp;amp;</span>src=app<span class="symbol">&amp;amp;</span>x=&#123;$x&#125;<span class="symbol">&amp;amp;</span>y=&#123;$y&#125;<span class="symbol">&amp;amp;</span>z=&#123;$z&#125;<span class="symbol">&amp;amp;</span>s=Galil<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">customMapSource</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">       	<span class="tag">&lt;<span class="name">customWmsMapSource</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">name</span>&gt;</span>林班界<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">minZoom</span>&gt;</span>0<span class="tag">&lt;/<span class="name">minZoom</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">maxZoom</span>&gt;</span>20<span class="tag">&lt;/<span class="name">maxZoom</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tileType</span>&gt;</span>PNG<span class="tag">&lt;/<span class="name">tileType</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tileUpdate</span>&gt;</span>None<span class="tag">&lt;/<span class="name">tileUpdate</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">layers</span>&gt;</span>hws:linbanjie<span class="tag">&lt;/<span class="name">layers</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.1.230:8082/geoserver/hws/wms?service=WMS<span class="symbol">&amp;amp;</span>transparent=TRUE<span class="symbol">&amp;amp;</span><span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 投影坐标系 --&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">coordinatesystem</span>&gt;</span>EPSG:4326<span class="tag">&lt;/<span class="name">coordinatesystem</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">aditionalparameters</span>&gt;</span><span class="tag">&lt;/<span class="name">aditionalparameters</span>&gt;</span>    </span><br><span class="line">		<span class="tag">&lt;/<span class="name">customWmsMapSource</span>&gt;</span> </span><br><span class="line">       </span><br><span class="line"> 		<span class="tag">&lt;<span class="name">customWmsMapSource</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">name</span>&gt;</span>巡护路线<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">minZoom</span>&gt;</span>0<span class="tag">&lt;/<span class="name">minZoom</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">maxZoom</span>&gt;</span>20<span class="tag">&lt;/<span class="name">maxZoom</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tileType</span>&gt;</span>PNG<span class="tag">&lt;/<span class="name">tileType</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tileUpdate</span>&gt;</span>None<span class="tag">&lt;/<span class="name">tileUpdate</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 图层名字hws(工作空间):china_net(图层名字) --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">layers</span>&gt;</span>hws:xunhuluxian<span class="tag">&lt;/<span class="name">layers</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- hws替换为自己的工作区间，ip端口替换自己服务器的，其他不变 --&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 多参数，每个参数用&amp;amp;分开--&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 背景设置透明transparent=TRUE--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.1.230:8082/geoserver/hws/wms?service=WMS<span class="symbol">&amp;amp;</span>transparent=TRUE<span class="symbol">&amp;amp;</span><span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">customWmsMapSource</span>&gt;</span>   </span><br><span class="line">   <span class="tag">&lt;/<span class="name">layers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">customMultiLayerMapSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="离线地图自定义地图源-google地图"><a href="#离线地图自定义地图源-google地图" class="headerlink" title="离线地图自定义地图源(google地图)"></a>离线地图自定义地图源(google地图)</h5><ol>
<li><p>在<a target="_blank" rel="noopener" href="http://mobac.sourceforge.net/">Mobile Atlas Creator</a>工具目录的<code>mapsources</code>目录添加地图源配置文件</p>
</li>
<li><p>google地图地图源配置文件<code>google_maps.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">customMultiLayerMapSource</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Google 卫星<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">tileType</span>&gt;</span>PNG<span class="tag">&lt;/<span class="name">tileType</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">layers</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">customMapSource</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Google 卫星图<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">minZoom</span>&gt;</span>0<span class="tag">&lt;/<span class="name">minZoom</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">maxZoom</span>&gt;</span>20<span class="tag">&lt;/<span class="name">maxZoom</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">tileType</span>&gt;</span>PNG<span class="tag">&lt;/<span class="name">tileType</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">tileUpdate</span>&gt;</span>None<span class="tag">&lt;/<span class="name">tileUpdate</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mt0.google.cn/vt/lyrs=s@124<span class="symbol">&amp;amp;</span>hl=zh-CN<span class="symbol">&amp;amp;</span>gl=CN<span class="symbol">&amp;amp;</span>src=app<span class="symbol">&amp;amp;</span>x=&#123;$x&#125;<span class="symbol">&amp;amp;</span>s=<span class="symbol">&amp;amp;</span>y=&#123;$y&#125;<span class="symbol">&amp;amp;</span>z=&#123;$z&#125;<span class="symbol">&amp;amp;</span>s=Galileo<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">backgroundColor</span>&gt;</span>#000000<span class="tag">&lt;/<span class="name">backgroundColor</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">customMapSource</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">customMapSource</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Google 地名图<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">minZoom</span>&gt;</span>0<span class="tag">&lt;/<span class="name">minZoom</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">maxZoom</span>&gt;</span>20<span class="tag">&lt;/<span class="name">maxZoom</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">tileType</span>&gt;</span>PNG<span class="tag">&lt;/<span class="name">tileType</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">tileUpdate</span>&gt;</span>None<span class="tag">&lt;/<span class="name">tileUpdate</span>&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mt0.google.cn/vt/imgtp=png32<span class="symbol">&amp;amp;</span>lyrs=h@207000000<span class="symbol">&amp;amp;</span>hl=zh-CN<span class="symbol">&amp;amp;</span>gl=CN<span class="symbol">&amp;amp;</span>src=app<span class="symbol">&amp;amp;</span>x=&#123;$x&#125;<span class="symbol">&amp;amp;</span>y=&#123;$y&#125;<span class="symbol">&amp;amp;</span>z=&#123;$z&#125;<span class="symbol">&amp;amp;</span>s=Galil<span class="tag">&lt;/<span class="name">url</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">customMapSource</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">layers</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">customMultiLayerMapSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>地图源文件xml的设置搜索<code>Mobile Atlas Creator自定义地图源</code></p>
<p><a target="_blank" rel="noopener" href="https://doc-pi.blogspot.com/2015/07/ipad-mobile-atlas-creator-google-map.html">IPad 離線地圖：「Mobile Atlas Creator + 地圖加加」，讓google map成為好用的離線地圖!!</a></p>
</li>
</ol>
<h4 id="Android代码设置"><a href="#Android代码设置" class="headerlink" title="Android代码设置"></a>Android代码设置</h4><ol>
<li><p>导包<code>compile &#39;org.osmdroid:osmdroid-android:&lt;VERSION&gt;&#39;</code></p>
</li>
<li><p>手动设置离线地图的文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路径压缩包的路径放在存储目录下/osmdroid/Google Maps（世界墨卡托）.zip这个是刚刚用工具制作得到的压缩文件</span></span><br><span class="line">String path=Environment.getExternalStorageDirectory().getAbsolutePath() + <span class="string">&quot;/osmdroid/&quot;</span>+<span class="string">&quot;Google Maps（世界墨卡托）.zip&quot;</span>;</span><br><span class="line"><span class="comment">//设置为离线工作模式。路径一定要对，而且只支持 ZIP/SQLite/GEMF</span></span><br><span class="line">mapView.setTileProvider(<span class="keyword">new</span> OfflineTileProvider(<span class="keyword">new</span> SimpleRegisterReceiver(<span class="keyword">this</span>),<span class="keyword">new</span> File[]&#123;<span class="keyword">new</span> File(path)&#125;));</span><br><span class="line"><span class="comment">//这里Google Map为压缩文件的第一层目录名，一定要一致，.png.tile为最内层目录的文件后缀名一点定要一致，一般是png，这里比较特殊</span></span><br><span class="line">mapView.setTileSource(<span class="keyword">new</span> XYTileSource(<span class="string">&quot;Google Map&quot;</span>, <span class="number">7</span>, <span class="number">16</span>,</span><br><span class="line">                <span class="number">256</span>, <span class="string">&quot;.png.tile&quot;</span>, <span class="keyword">null</span>));</span><br></pre></td></tr></table></figure>
</li>
<li><p>上面那步基本就可以解析了，官方使用<a target="_blank" rel="noopener" href="https://github.com/osmdroid/osmdroid/blob/master/OpenStreetMapViewer/src/main/java/org/osmdroid/samplefragments/tileproviders/SampleOfflineOnly.java">SampleOfflineOnly.java</a>做自动解析</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置离线地图的路径</span></span><br><span class="line">File f = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory().getAbsolutePath() + <span class="string">&quot;/osmdroid/&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (f.exists()) &#123;  <span class="comment">//判断目录是否存在</span></span><br><span class="line">    File[] list = f.listFiles(); <span class="comment">//得到该目录下的文件</span></span><br><span class="line">    <span class="keyword">if</span> (list != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;  <span class="comment">//遍历的得到的所有目录和文件</span></span><br><span class="line">            <span class="keyword">if</span> (list[i].isDirectory()) &#123;  <span class="comment">//目录跳过</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String name = list[i].getName().toLowerCase();</span><br><span class="line">            <span class="keyword">if</span> (!name.contains(<span class="string">&quot;.&quot;</span>)) &#123;  <span class="comment">//没有后缀跳过</span></span><br><span class="line">                <span class="keyword">continue</span>; <span class="comment">//skip files without an extension</span></span><br><span class="line">            &#125;</span><br><span class="line">            name = name.substring(name.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);  <span class="comment">//得到后缀名</span></span><br><span class="line">            <span class="keyword">if</span> (name.length() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ArchiveFileFactory.isFileExtensionRegistered(name)) &#123; <span class="comment">//后缀名是否是ZIP/SQLite/GEMF其中一个</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    OfflineTileProvider tileProvider = <span class="keyword">new</span> OfflineTileProvider(<span class="keyword">new</span> SimpleRegisterReceiver(<span class="keyword">this</span>),</span><br><span class="line">                                                                               <span class="keyword">new</span> File[]&#123;list[i]&#125;);  <span class="comment">//如果是把该文件作为离线地图的提供者</span></span><br><span class="line">                    mapView.setTileProvider(tileProvider);  <span class="comment">// &lt;重要&gt;</span></span><br><span class="line">                    String source = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    IArchiveFile[] archives = tileProvider.getArchives();</span><br><span class="line">                    <span class="keyword">if</span> (archives.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        Set&lt;String&gt; tileSources = archives[<span class="number">0</span>].getTileSources();</span><br><span class="line">                        <span class="keyword">if</span> (!tileSources.isEmpty()) &#123;</span><br><span class="line">                            source = tileSources.iterator().next();  <span class="comment">//活动压缩文件第一级目录的目录名</span></span><br><span class="line">                            <span class="comment">//自定义设置  &lt;重要&gt; ，其中文件后缀名要和压缩文件内的后缀一致</span></span><br><span class="line">                            <span class="keyword">this</span>.mapView.setTileSource(<span class="keyword">new</span> FileBasedTileSource(source,<span class="number">0</span>, <span class="number">18</span>, <span class="number">256</span>, <span class="string">&quot;.png&quot;</span>, <span class="keyword">null</span>));</span><br><span class="line">                            <span class="comment">//   this.mapView.setTileSource(FileBasedTileSource.getSource(source));  //默认设置</span></span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">this</span>.mapView.setTileSource(TileSourceFactory.DEFAULT_TILE_SOURCE);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">this</span>.mapView.setTileSource(TileSourceFactory.DEFAULT_TILE_SOURCE);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">this</span>.mapView.invalidate();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, f.getAbsolutePath() + <span class="string">&quot; did not have any files I can open! Try using MOBAC&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, f.getAbsolutePath() + <span class="string">&quot; dir not found!&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><ol>
<li>当mobac配置多图层时，geoserver wms不加<code>transparent=TRUE&amp;amp;</code>会有白色背景，设置透明度会导致最底层的地图上覆盖了一层半透明的白色，导致看不起低图</li>
<li>mobac加载geoserver gwc连接，如果图层只有一部分，会导致Google map在图层之外的也加载不出来</li>
</ol>
<h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><p><a target="_blank" rel="noopener" href="https://gis.stackexchange.com/questions/72898/how-to-use-custom-map-in-mobac">How to use Custom map in MOBAC?</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/29/java-type/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/29/java-type/" class="post-title-link" itemprop="url">Java-Type</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-29 14:39:59" itemprop="dateCreated datePublished" datetime="2018-05-29T14:39:59+00:00">2018-05-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
    <span id="/2018/05/29/java-type/" class="post-meta-item leancloud_visitors" data-flag-title="Java-Type" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>type泛型解析</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Integer&gt; map;</span><br><span class="line"></span><br><span class="line">type.getRawType();   <span class="comment">//返回Map</span></span><br><span class="line">type.getActualTypeArguments()[<span class="number">0</span>];  <span class="comment">//返回string</span></span><br><span class="line">type.getActualTypeArguments()[<span class="number">1</span>];  <span class="comment">//返回Integer</span></span><br></pre></td></tr></table></figure>





<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/jeasonlzy/okhttp-OkGo/wiki/JsonCallback">https://github.com/jeasonlzy/okhttp-OkGo/wiki/JsonCallback</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/26/db-realm-base/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/26/db-realm-base/" class="post-title-link" itemprop="url">DB-Realm-Base</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-26 15:35:08" itemprop="dateCreated datePublished" datetime="2018-05-26T15:35:08+00:00">2018-05-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
    <span id="/2018/05/26/db-realm-base/" class="post-meta-item leancloud_visitors" data-flag-title="DB-Realm-Base" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a target="_blank" rel="noopener" href="https://realm.io/docs/java/latest/">官网</a></p>
<p>全平台通用数据库</p>
<ol>
<li>特点自带通知</li>
<li>实体类方式</li>
</ol>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol>
<li><p>在project中的build.gradle添加</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    classpath <span class="string">&quot;io.realm:realm-gradle-plugin:5.1.0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在model中的build.gradle添加</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;realm-android&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>新建实体类，两种方式</p>
<p>方式一</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RealmClass</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEntiy</span> <span class="keyword">implements</span> <span class="title">RealmModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方式二</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEntiy</span> <span class="keyword">extends</span> <span class="title">RealmModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在application中初始化realm</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Realm.init(context); <span class="comment">//数据库初始化</span></span><br><span class="line">RealmConfiguration config = <span class="keyword">new</span> RealmConfiguration.Builder().name(<span class="string">&quot;mulun.realm&quot;</span>).build();</span><br><span class="line">Realm.setDefaultConfiguration(config);  <span class="comment">//设置配置，数据库文件名为mulun.realm</span></span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line">Realm realm = Realm.getDefaultInstance(); <span class="comment">//获取数据库实例</span></span><br><span class="line">Log.i(<span class="string">&quot;MyApplication&quot;</span>,<span class="string">&quot;数据库路径为：&quot;</span>+realm.getPath()); <span class="comment">//打印路径</span></span><br><span class="line">realm.close(); <span class="comment">//用完需要关闭实例</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在data/data/包名/file目录下可以找到数据库文件<code>mulun.realm</code></p>
</li>
<li><p>该文件可以通过<code>Realm Studio</code>打开</p>
</li>
</ol>
<h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h3><p>数据库插入/删除数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Realm realm = Realm.getDefaultInstance(); <span class="comment">//获取数据库实例</span></span><br><span class="line"><span class="comment">//方式一</span></span><br><span class="line">TestEntiy testEntiy=<span class="keyword">new</span> TestEntiy();        </span><br><span class="line">realm.executeTransaction(<span class="keyword">new</span> Realm.Transaction() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Realm realm)</span> </span>&#123;</span><br><span class="line">        realm.copyToRealm(testEntiy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//查询删除数据，该查询是异步的，如果数据testEntiy发生了修改和增加会在这里收到通知</span></span><br><span class="line">realm.where(TestEntiy.class).findAllAsync().asFlowable().subscribe(<span class="keyword">new</span> Consumer&lt;RealmResults&lt;TestEntiy&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(<span class="keyword">final</span> RealmResults&lt;TestEntiy&gt; testEntiy)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">         TestEntiy testEntiyRes = realm.copyFromRealm(testEntiy); <span class="comment">//此种方式才能真正取到实体类，不能直接用testEntiy</span></span><br><span class="line">        realm.executeTransaction(<span class="keyword">new</span> Realm.Transaction() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Realm realm)</span> </span>&#123;</span><br><span class="line">                testEntiy.deleteAllFromRealm();   <span class="comment">//上传失败删除数据</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">                                                                   realm.close();</span><br></pre></td></tr></table></figure>

<p>另一种操作方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Realm realm = Realm.getDefaultInstance(); <span class="comment">//获取数据库实例</span></span><br><span class="line">realm.beginTransaction();</span><br><span class="line">realm.copyToRealm(testEntiy);</span><br><span class="line">realm.commitTransaction();</span><br><span class="line">realm.close();</span><br></pre></td></tr></table></figure>












      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/21/docker-install-jenkins/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/21/docker-install-jenkins/" class="post-title-link" itemprop="url">Docker-Install-Jenkins</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-21 19:04:52" itemprop="dateCreated datePublished" datetime="2018-05-21T19:04:52+00:00">2018-05-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-02-18 11:17:11" itemprop="dateModified" datetime="2019-02-18T11:17:11+00:00">2019-02-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
    <span id="/2018/05/21/docker-install-jenkins/" class="post-meta-item leancloud_visitors" data-flag-title="Docker-Install-Jenkins" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>github文档：<a target="_blank" rel="noopener" href="https://github.com/jenkinsci/docker/blob/master/README.md">jenkinsci/docker</a></p>
<p><a target="_blank" rel="noopener" href="https://jenkins.io/">jenkins官网</a></p>
<p>Docker hub：<a target="_blank" rel="noopener" href="https://hub.docker.com/r/jenkins/jenkins/">jenkins/jenkins</a></p>
<p><a target="_blank" rel="noopener" href="https://jenkins.io/doc/book/blueocean/getting-started/">蓝色主题版</a>:<a target="_blank" rel="noopener" href="https://hub.docker.com/r/jenkinsci/blueocean/">jenkinsci/blueocean</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>脚本文件<a target="_blank" rel="noopener" href="https://github.com/xuanfong1/config/blob/master/dockerStack/stack-jenkins.yml">https://github.com/xuanfong1/config/blob/master/dockerStack/stack-jenkins.yml</a></p>
<p>创建挂载目录</p>
<p>启动提示：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch: cannot touch &#x27;/<span class="keyword">var</span>/jenkins_home/copy_reference_file<span class="variable">.log</span>&#x27;: Permission denied</span><br><span class="line"></span><br><span class="line">Can <span class="keyword">not</span> write to /<span class="keyword">var</span>/jenkins_home/copy_reference_file<span class="variable">.log</span>. Wrong volume permissions?</span><br></pre></td></tr></table></figure>

<p>解决：执行<code>chown -R 1000:1000 /dockerdata/v-jenkins/jenkins_home</code>改变用户组为1000 用户1000</p>
<h3 id="jenkins-之docker插件"><a href="#jenkins-之docker插件" class="headerlink" title="jenkins 之docker插件"></a>jenkins 之docker插件</h3><p><a target="_blank" rel="noopener" href="https://plugins.jenkins.io/docker-build-step">docker-build-step</a> 构建步骤使用docker命令</p>
<p><a target="_blank" rel="noopener" href="https://plugins.jenkins.io/docker-build-publish">CloudBees Docker Build and Publish</a>镜像构建以及推送仓库</p>
<p><a target="_blank" rel="noopener" href="https://plugins.jenkins.io/docker-plugin">Docker</a> 远程连接docker进行代理构建</p>
<p><a target="_blank" rel="noopener" href="https://plugins.jenkins.io/docker-java-api">Docker API</a>提供其他插件docker服务api</p>
<p><a target="_blank" rel="noopener" href="https://plugins.jenkins.io/docker-custom-build-environment">CloudBees Docker Custom Build Environment</a>构建镜像或从仓库拉去镜像</p>
<p><a target="_blank" rel="noopener" href="https://plugins.jenkins.io/docker-swarm">Docker Swarm</a>集群</p>
<p><a target="_blank" rel="noopener" href="https://github.com/boxboat/jenkins-demo">https://github.com/boxboat/jenkins-demo</a></p>
<p>错误处理</p>
<ol>
<li><p>连接错误，解决添加挂在卷<code>&quot;/var/run/docker.sock:/var/run/docker.sock&quot; </code></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cannot connect to the Docker daemon at unix:<span class="comment">///var/run/docker.sock. Is the docker daemon running?</span></span><br><span class="line"></span><br><span class="line">script returned exit code <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>连接没权限,解决</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Got permission denied while trying to connect to the Docker daemon socket at unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock: Post http:&#x2F;&#x2F;%2Fvar%2Frun%2Fdocker.sock&#x2F;v1.35&#x2F;build?buildargs&#x3D;%7B%7D&amp;cachefrom&#x3D;%5B%5D&amp;cgroupparent&#x3D;&amp;cpuperiod&#x3D;0&amp;cpuquota&#x3D;0&amp;cpusetcpus&#x3D;&amp;cpusetmems&#x3D;&amp;cpushares&#x3D;0&amp;dockerfile&#x3D;Dockerfile&amp;labels&#x3D;%7B%7D&amp;memory&#x3D;0&amp;memswap&#x3D;0&amp;networkmode&#x3D;default&amp;rm&#x3D;1&amp;session&#x3D;6ec5bc5a7afd427649abb0a03b733c9586dd9271474c89359e31a3910ed971e8&amp;shmsize&#x3D;0&amp;t&#x3D;e5e2d0e18760db6972a9c42a9a81653e633ff131&amp;target&#x3D;&amp;ulimits&#x3D;null: dial unix &#x2F;var&#x2F;run&#x2F;docker.sock: connect: permission denied</span><br><span class="line"></span><br><span class="line">script returned exit code 1</span><br></pre></td></tr></table></figure>

<p>执行<code>sudo ls -la /var/run/docker.sock </code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srw-rw----. 1 root docker 0 5月  15 16:36 &#x2F;var&#x2F;run&#x2F;docker.sock</span><br></pre></td></tr></table></figure>

<p><code>--group-add=$(stat -c %g /var/run/docker.sock)</code></p>
<p><code>sudo usermod -a -G docker jenkins</code></p>
<p>解决方案</p>
<h5 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h5><p>改变socke所属的用户组</p>
<p>用root用户进入jenkins容器</p>
<p>执行<code>chown :jenkins /var/run/docker.sock</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-------------宿主机------------------------------</span><br><span class="line">[<span class="type">root</span>@<span class="type">worker</span> ~]<span class="comment"># ls -la /var/run/docker.sock</span></span><br><span class="line">srw<span class="literal">-rw</span>----. <span class="number">1</span> root docker <span class="number">0</span> <span class="number">6</span>月   <span class="number">6</span> <span class="number">16</span>:<span class="number">58</span> /var/run/docker.sock</span><br><span class="line">执行后</span><br><span class="line">[<span class="type">root</span>@<span class="type">worker</span> ~]<span class="comment"># ls -la /var/run/docker.sock</span></span><br><span class="line">srw<span class="literal">-rw</span>----. <span class="number">1</span> root <span class="number">1000</span> <span class="number">0</span> <span class="number">6</span>月   <span class="number">6</span> <span class="number">16</span>:<span class="number">58</span> /var/run/docker.sock</span><br><span class="line">-----------------<span class="literal">-jenkins</span>容器---------------------</span><br><span class="line">srw<span class="literal">-rw</span>---- <span class="number">1</span> root <span class="number">994</span> <span class="number">0</span> Jun  <span class="number">6</span> <span class="number">08</span>:<span class="number">58</span> var/run/docker.sock</span><br><span class="line">执行后</span><br><span class="line">srw<span class="literal">-rw</span>---- <span class="number">1</span> root jenkins <span class="number">0</span> Jun  <span class="number">6</span> <span class="number">08</span>:<span class="number">58</span> var/run/docker.sock</span><br></pre></td></tr></table></figure>

<p><code>cat /etc/group</code>查看用户组id</p>
<p>自我理解：</p>
<p>这里通过挂载卷的形式共享/var/run/docker.sock套接字，但是默认套接字属于root docker组，这里docker的组id为994，但是容器内没有994的组，所以直接显示994，最后执行这个<code>chown :jenkins /var/run/docker.sock</code>之后把组更改为乐jenkins组，但是默认宿主机是没有jenkins组，所以直接显示jenkins的id 1000，这里直接修改为jenkins用户组，虽然可以解决权限问题，不知道会不会影响其他的使用该sock套接字（<strong>隐患</strong>）</p>
<p>完善思路：</p>
<p>新建个jenkins组</p>
<p>添加docker用户到jenkins组</p>
<p>但是发现</p>
<p>宿主机<code>id docker</code> 没有docker用户</p>
<p>且docker组没有任何用户，因此可以放心更改组，所以要不要新建组待考虑</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/group #查看组信息</span><br><span class="line">cgred:x:995:</span><br><span class="line">docker:x:994:jenkins</span><br><span class="line"><span class="meta">#</span><span class="bash">组名:口令(默认空/*):组标识号(gid):组内用户列表</span></span><br></pre></td></tr></table></figure>

<h5 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h5><p>自我新思路</p>
<p>宿主机创建个jenkins用户组指定id1000</p>
<p>宿主机执行<code>useradd -u 1000 jenkins</code></p>
<p>然后执行<code>sudo usermod -a -G docker jenkins</code></p>
<p>失败，没有权限</p>
<h5 id="方案三-未实验"><a href="#方案三-未实验" class="headerlink" title="方案三(未实验)"></a>方案三(未实验)</h5><p>root用户可以访问docker,需要重写dockerfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM &lt;base-image&gt;</span><br><span class="line">USER root</span><br></pre></td></tr></table></figure>

<p>隐患：不知到用root用户登陆会不会影响jenkins的一些功能</p>
<h5 id="方案四-未实验"><a href="#方案四-未实验" class="headerlink" title="方案四(未实验)"></a>方案四(未实验)</h5><p>修改<code>groupadd -g 994 docker</code>，找不到命令</p>
<p>然后执行<code>usermod -a -G docker jenkins</code></p>
<p>此法每次重启容器都会丢失配置，虽然可以通过挂载目录形式保存设置，太麻烦。</p>
</li>
<li><p>Jenkins 第一次打开，一直显示启动中</p>
<p>解决：</p>
<p>修改jenkins_home/updates/default.json</p>
<p>把 “connectionCheckUrl”:”<a target="_blank" rel="noopener" href="http://www.google.com/&quot;">http://www.google.com/&quot;</a> 改为 “connectionCheckUrl”:”<a target="_blank" rel="noopener" href="http://www.baidu.com/&quot;">http://www.baidu.com/&quot;</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/jenkinsci/docker/issues/263">https://github.com/jenkinsci/docker/issues/263</a></p>
</li>
</ol>
<h2 id="centos-安装jenkins-需要jdk8"><a href="#centos-安装jenkins-需要jdk8" class="headerlink" title="centos 安装jenkins,需要jdk8"></a>centos 安装jenkins,需要jdk8</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br><span class="line">sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br><span class="line">yum install jenkins</span><br><span class="line">sudo service jenkins start/stop/restart</span><br><span class="line">sudo chkconfig jenkins on</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/20/microservices-gitlab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/20/microservices-gitlab/" class="post-title-link" itemprop="url">微服务之Gitlab搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-20 21:18:35" itemprop="dateCreated datePublished" datetime="2018-05-20T21:18:35+00:00">2018-05-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Microservices/" itemprop="url" rel="index"><span itemprop="name">Microservices</span></a>
        </span>
    </span>

  
    <span id="/2018/05/20/microservices-gitlab/" class="post-meta-item leancloud_visitors" data-flag-title="微服务之Gitlab搭建" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>博客见<a href="https://blog.iexxk.com/2017/12/11/Dcoker-Swarm-install-gitlab/">dcoker swarm安装gitlab</a></p>
<p>操作步骤见<a href="">微服务之gitlab搭建</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/20/javaee-shiro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/20/javaee-shiro/" class="post-title-link" itemprop="url">JavaEE-shiro</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-20 08:54:50" itemprop="dateCreated datePublished" datetime="2018-05-20T08:54:50+00:00">2018-05-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-18 18:34:28" itemprop="dateModified" datetime="2021-03-18T18:34:28+00:00">2021-03-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaEE/" itemprop="url" rel="index"><span itemprop="name">JavaEE</span></a>
        </span>
    </span>

  
    <span id="/2018/05/20/javaee-shiro/" class="post-meta-item leancloud_visitors" data-flag-title="JavaEE-shiro" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Apache Shiro是java的一个安全框架，和<code>Spring Security</code>比相对简单，功能简单，使用简单，适合小型简单的项目。</p>
<h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><ul>
<li>Authentication：身份认证/登陆，验证用户身份</li>
<li>Authorization：授权，权限验证，验证已认证的用户是否拥有某个权限</li>
<li>session manager：会话管理</li>
<li>cryptography：加密</li>
<li>web support：web支持</li>
<li>caching：缓存</li>
<li>concurrency：多线程并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；</li>
<li>testing：测试支持</li>
<li>run as：运行一个用户假装另一个用户的身份进行登陆</li>
<li>remember me：记住我密码功能</li>
</ul>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">a[object&#x2F;用户]--&gt;b[SecurityManager&#x2F;shiro]</span><br><span class="line">b--&gt;c[Realm&#x2F;数据源]</span><br></pre></td></tr></table></figure>

<h4 id="简单体验登陆"><a href="#简单体验登陆" class="headerlink" title="简单体验登陆"></a>简单体验登陆</h4><ol>
<li><p>在gradle引入依赖<code>compile group: &#39;org.apache.shiro&#39;, name: &#39;shiro-core&#39;, version: &#39;1.4.0&#39;</code></p>
</li>
<li><p>在目录<code>resources</code>下新建一个<code>shiro.ini</code>文件</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># users 标签下面格式为</span></span><br><span class="line"><span class="comment"># 用户名 = 密码,角色1，角色2，....,角色N</span></span><br><span class="line"><span class="section">[users]</span></span><br><span class="line"><span class="attr">root</span> = secret, admin</span><br><span class="line"><span class="attr">guest</span> = guest, guest</span><br><span class="line"><span class="attr">test</span> = <span class="number">123456</span>,test</span><br><span class="line"></span><br><span class="line"><span class="comment"># roldes 角色标签下面格式为</span></span><br><span class="line"><span class="comment"># 角色 = 权限1，权限2, ....权限N</span></span><br><span class="line"><span class="section">[roles]</span></span><br><span class="line"><span class="attr">admin</span> = *</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建登陆方法，<code>IniSecurityManagerFactory</code>该方法在1.4已经过期了，用下面的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Factory&lt;SecurityManager&gt; factory=new IniSecurityManagerFactory(&quot;classpath:shiro.ini&quot;); //此方法过期</span></span><br><span class="line">IniRealm iniRealm=<span class="keyword">new</span> IniRealm(<span class="string">&quot;classpath:shiro.ini&quot;</span>); <span class="comment">//读取shiro配置文件</span></span><br><span class="line">DefaultSecurityManager securityManager=<span class="keyword">new</span> DefaultSecurityManager(iniRealm);</span><br><span class="line">SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line">Subject currentUser=SecurityUtils.getSubject();</span><br><span class="line"><span class="keyword">if</span> (!currentUser.isAuthenticated())&#123;</span><br><span class="line">    UsernamePasswordToken token=<span class="keyword">new</span> UsernamePasswordToken(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    token.setRememberMe(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        currentUser.login(token);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (UnknownAccountException una)&#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;用户名不存在&quot;</span>+una.getMessage());</span><br><span class="line">    &#125;<span class="keyword">catch</span> (IncorrectCredentialsException ice)&#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;无效的认证&quot;</span>+ice.getMessage());</span><br><span class="line">    &#125;<span class="keyword">catch</span> (LockedAccountException lae)&#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;你的账户被锁定&quot;</span>+lae.getMessage());</span><br><span class="line">    &#125;<span class="keyword">catch</span> (AuthenticationException ae)&#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;未知错误&quot;</span>+ae.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="shiro名词概念解释"><a href="#shiro名词概念解释" class="headerlink" title="shiro名词概念解释"></a>shiro名词概念解释</h4><ul>
<li>subject ：当前操作的用户</li>
<li>SecurityManager ：shiro框架核心，内部组件管理</li>
<li>realm : 连接桥梁，用于和用户数据，权限数据连接（来源文件、数据库）</li>
</ul>
<p>xml配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;securityManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.shiro.web.mgt.DefaultWebSecurityManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;realms&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;customRealm&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cacheManager&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;cacheManager&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sessionManager&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sessionManager&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>数据库表设计：</p>
<p><img src="https://s3.ax1x.com/2021/03/18/627PgJ.png" alt="1529049788944"></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://www.zifangsky.cn/770.html">Shiro权限控制框架入门</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/16/dubbo-gradle-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/16/dubbo-gradle-config/" class="post-title-link" itemprop="url">Dubbo-Gradle-Config</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-16 23:29:07" itemprop="dateCreated datePublished" datetime="2018-05-16T23:29:07+00:00">2018-05-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Dubbo/" itemprop="url" rel="index"><span itemprop="name">Dubbo</span></a>
        </span>
    </span>

  
    <span id="/2018/05/16/dubbo-gradle-config/" class="post-meta-item leancloud_visitors" data-flag-title="Dubbo-Gradle-Config" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="配置方式一xml"><a href="#配置方式一xml" class="headerlink" title="配置方式一xml"></a>配置方式一<code>xml</code></h4><p>在resources目录<code>dubbo-provider.xml</code>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该提供者服务名称--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;dubbo-provider&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--组播模式的注册中心，推荐用zookeeper--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;dubbo:registry address=&quot;zookeeper://10.14.1.7:2181&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--暴露的端口服务--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--声明暴露服务公共接口类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;exxk.dubbo.commonimpl.DemoService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;demoService&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--提供者实现类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;demoService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;exxk.dubbo.provider.impl.DemoServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要在dubbo启动器指向xml名字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">                <span class="keyword">new</span> String[]&#123;<span class="string">&quot;dubbo-provider.xml&quot;</span>&#125;); <span class="comment">//读取dubbo配置文件</span></span><br><span class="line">        context.start();</span><br></pre></td></tr></table></figure>

<h4 id="配置方式二dubbo-properties"><a href="#配置方式二dubbo-properties" class="headerlink" title="配置方式二dubbo.properties"></a>配置方式二<code>dubbo.properties</code></h4><p>注：配置文件名字是固定的</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">dubbo.registry.address</span>=<span class="string">zookeeper://10.14.1.7:2181</span></span><br></pre></td></tr></table></figure>

<h4 id="配置方式三jvm"><a href="#配置方式三jvm" class="headerlink" title="配置方式三jvm"></a>配置方式三<code>jvm</code></h4><p>注：gradle application task run启动vm设置无效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Ddubbo.registry.address&#x3D;zookeeper:&#x2F;&#x2F;10.14.1.7:2181</span><br></pre></td></tr></table></figure>

<h3 id="覆盖策略"><a href="#覆盖策略" class="headerlink" title="覆盖策略"></a>覆盖策略</h3><p>JVM&gt;XML&gt;Properties其中jvm优先级最高</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/14/dubbo-gradle-build/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/14/dubbo-gradle-build/" class="post-title-link" itemprop="url">Dubbo-Gradle-Build</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-14 14:56:08" itemprop="dateCreated datePublished" datetime="2018-05-14T14:56:08+00:00">2018-05-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Dubbo/" itemprop="url" rel="index"><span itemprop="name">Dubbo</span></a>
        </span>
    </span>

  
    <span id="/2018/05/14/dubbo-gradle-build/" class="post-meta-item leancloud_visitors" data-flag-title="Dubbo-Gradle-Build" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>源码：<a target="_blank" rel="noopener" href="https://github.com/xuanfong1/DubboLearning">https://github.com/xuanfong1/DubboLearning</a></p>
<ol>
<li><p>新建目录<code> mkdir DubboLearning</code>,然后<code>cd Dubbolearning</code>进去之后执行<code>gradle init</code>初始化gradle项目</p>
</li>
<li><p>新建三个子项目目录<code>mkdir library,provider,consumer </code>分别为公共依赖项目、提供者、消费者</p>
</li>
<li><p>复制build.gradle到三个子项目目录</p>
</li>
<li><p>分别为三个子项目创建目录<code>mkdir -p src/main/java,src/test/java,src/main/resources</code></p>
</li>
<li><p>修改顶级项目目录的setting.gradle添加三个子项目</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">&#x27;library&#x27;</span></span><br><span class="line">inclede <span class="string">&#x27;provider&#x27;</span></span><br><span class="line">inclede <span class="string">&#x27;consumer&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>复制项目helloworld的源码到项目目录</p>
</li>
<li><p>然后修改顶级项目目录build.gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&quot;org.springframework.boot&quot;</span> version <span class="string">&quot;2.0.1.RELEASE&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter() <span class="comment">//将jcenter仓库配置到所有项目</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">subprojects &#123;</span><br><span class="line">    version = <span class="string">&#x27;1.0&#x27;</span> <span class="comment">//设置版本号</span></span><br><span class="line">&#125;</span><br><span class="line">configure(subprojects.findAll &#123;it.name == <span class="string">&#x27;provider&#x27;</span> || it.name == <span class="string">&#x27;consumer&#x27;</span>&#125; ) &#123;</span><br><span class="line"></span><br><span class="line">    apply <span class="attr">plugin:</span> <span class="string">&#x27;java&#x27;</span></span><br><span class="line">    apply <span class="attr">plugin:</span> <span class="string">&#x27;eclipse&#x27;</span></span><br><span class="line">    apply <span class="attr">plugin:</span> <span class="string">&quot;org.springframework.boot&quot;</span></span><br><span class="line">    apply <span class="attr">plugin:</span> <span class="string">&#x27;io.spring.dependency-management&#x27;</span></span><br><span class="line"></span><br><span class="line">    group = <span class="string">&#x27;exxk.dubbo&#x27;</span></span><br><span class="line">    version = <span class="string">&#x27;0.0.1-SNAPSHOT&#x27;</span></span><br><span class="line">    sourceCompatibility = <span class="number">1.8</span></span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        compile(<span class="string">&#x27;org.springframework.boot:spring-boot-starter&#x27;</span>)</span><br><span class="line">        compile <span class="attr">group:</span> <span class="string">&#x27;com.alibaba&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;dubbo&#x27;</span>, <span class="attr">version:</span> <span class="string">&#x27;2.6.1&#x27;</span></span><br><span class="line">        testCompile(<span class="string">&#x27;org.springframework.boot:spring-boot-starter-test&#x27;</span>)</span><br><span class="line">        compile project(<span class="string">&#x27;:library&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
</ol>
<h3 id="额外"><a href="#额外" class="headerlink" title="额外"></a>额外</h3><p><a target="_blank" rel="noopener" href="https://plugins.gradle.org/plugin/org.springframework.boot">https://plugins.gradle.org/plugin/org.springframework.boot</a></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//低版本，动态</span></span><br><span class="line">buildscript &#123;</span><br><span class="line">    ext &#123;</span><br><span class="line">        springBootVersion = <span class="string">&#x27;2.0.1.RELEASE&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath(<span class="string">&quot;org.springframework.boot:spring-boot-gradle-plugin:$&#123;springBootVersion&#125;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line"><span class="comment">//高版本</span></span><br><span class="line">plugins &#123;</span><br><span class="line">  id <span class="string">&quot;org.springframework.boot&quot;</span> version <span class="string">&quot;2.0.2.RELEASE&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org&#x2F;apache&#x2F;curator&#x2F;RetryPolicy</span><br><span class="line">	at com.alibaba.dubbo.remoting.zookeeper.curator.CuratorZookeeperTransporter.connect(CuratorZookeeperTransporter.java:26)</span><br></pre></td></tr></table></figure>

<p>解决：添加依赖<code>compile group: &#39;org.apache.curator&#39;, name: &#39;curator-framework&#39;, version: &#39;4.0.1&#39;</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/13/tools-gradle-build-java-libraries/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/13/tools-gradle-build-java-libraries/" class="post-title-link" itemprop="url">Gradle构建java库</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-13 16:41:51" itemprop="dateCreated datePublished" datetime="2018-05-13T16:41:51+00:00">2018-05-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
    <span id="/2018/05/13/tools-gradle-build-java-libraries/" class="post-meta-item leancloud_visitors" data-flag-title="Gradle构建java库" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>gradle init --type &lt;name&gt;</code>其中name可选</p>
<ul>
<li>java-application</li>
<li>java-library</li>
<li>scala-library</li>
<li>groovy-library</li>
<li>basic</li>
</ul>
<h2 id="build-java-library"><a href="#build-java-library" class="headerlink" title="build java-library"></a>build java-library</h2><blockquote>
<p>This guide walks you through the process of using Gradle’s Build Init plugin to produce a JVM library which is suitable for consumption by other JVM libraries and applications.</p>
</blockquote>
<p>本指南引导您完成使用Gradle的Build Init插件生成适合其他JVM库和应用程序使用的JVM库的过程。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mkdir demo-java-lib <span class="comment">#创建项目目录</span></span><br><span class="line"><span class="built_in">cd</span> demo-java-lib</span><br><span class="line">gradle init --<span class="built_in">type</span> java-library  <span class="comment">#初始化构建为java-library</span></span><br><span class="line">tree <span class="comment">#查看生成的目录树</span></span><br><span class="line">├── build.gradle</span><br><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties</span><br><span class="line">├── gradlew</span><br><span class="line">├── gradlew.bat</span><br><span class="line">├── settings.gradle</span><br><span class="line">└── src</span><br><span class="line">    ├── main  <span class="comment">#java资源为件</span></span><br><span class="line">    │   └── java  </span><br><span class="line">    │       └── Library.java</span><br><span class="line">    └── <span class="built_in">test</span>  <span class="comment">#java测试文件</span></span><br><span class="line">        └── java</span><br><span class="line">            └── LibraryTest.java</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>build.gradle</code>解读</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    <span class="comment">// Java Library依赖插件</span></span><br><span class="line">    id <span class="string">&#x27;java-library&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// 依赖该api</span></span><br><span class="line">    api <span class="string">&#x27;org.apache.commons:commons-math3:3.6.1&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;com.google.guava:guava:23.0&#x27;</span></span><br><span class="line">    testImplementation <span class="string">&#x27;junit:junit:4.12&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">repositories &#123;</span><br><span class="line">    <span class="comment">// 仓库</span></span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行<code>./gradew build</code>第一次构建会下载依赖jar包比较慢,下载到目录<code>~/.gradle/wrapper/dists</code>，编译完成后生成</p>
<ul>
<li>build/reports/tests/test/index.html 测试报告</li>
<li>build/libs/building-java-libraries.jar 编译生成的jar</li>
</ul>
<p><code>jar tf build/libs/building-java-libraries.jar</code>命令查看jar包内容，其中<code>-f</code>指定jar文件名，<code>-t</code>列出包的内容</p>
<p>修改<code>build.gradle</code>文件在文件里添加版本好<code>version = &#39;0.1.0&#39;</code>，结果会修改打包的名称为<code>build/libs/demo-java-lib-0.1.0.jar</code></p>
<p>修改<code>build.gradle</code>文件在文件里添加<code>jar</code> task任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jar &#123;</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes(&#39;Implementation-Title&#39;: project.name,</span><br><span class="line">                   &#39;Implementation-Version&#39;: project.version)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会修改<code>build/libs/building-java-libraries-0.1.0.jar/META-INF/MANIFEST.MF</code>jar包文件的内容为</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Manifest-Version</span>: <span class="string">1.0</span></span><br><span class="line"><span class="meta">Implementation-Title</span>: <span class="string">demo-java-lib</span></span><br><span class="line"><span class="meta">Implementation-Version</span>: <span class="string">0.1.0</span></span><br></pre></td></tr></table></figure>

<p>java-library内置支持javadoc，执行<code>./gradlew javadoc</code>会生成<code>/build/docs/javadoc/index.html</code>文档</p>
<h2 id="build-java-application"><a href="#build-java-application" class="headerlink" title="build java-application"></a>build java-application</h2><p>java项目和library项目一样，只是多了tasks任务 run</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">e想行空</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>




<script>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/mermaid@8.9.1/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  




  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.1.0/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink.listen({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://blog.iexxk.com/page/10/',]
      });
      });
  </script>

<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"Knshftme94xEJM6dEEop4Qnq-gzGzoHsz","appKey":"UpNFcvVri9iYUjDznVdodui4","serverURLs":"https://knshftme.lc-cn-n1-shared.com","placeholder":"Just go go","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":true,"comment_count":true,"recordIP":true,"enableQQ":false,"requiredFields":[]}, {
      el: '#valine-comments',
      path: "/page/10/",
      serverURLs: "https://knshftme.lc-cn-n1-shared.com"
    }));
  }, window.Valine);
});
</script>

</body>
</html>
