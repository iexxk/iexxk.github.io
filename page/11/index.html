<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.iexxk.com","root":"/","images":"/images","scheme":"Muse","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="e想天开，天马行空">
<meta property="og:type" content="website">
<meta property="og:title" content="e想行空">
<meta property="og:url" content="https://blog.iexxk.com/page/11/index.html">
<meta property="og:site_name" content="e想行空">
<meta property="og:description" content="e想天开，天马行空">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="e想行空">
<meta property="article:tag" content="exxk,e想行空">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.iexxk.com/page/11/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>e想行空</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">e想行空</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="e想行空"
      src="/uploads/headimg.jpg">
  <p class="site-author-name" itemprop="name">e想行空</p>
  <div class="site-description" itemprop="description">e想天开，天马行空</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">239</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">311</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/iexxk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;iexxk" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:exxk.lx@gmail.com" title="E-Mail → mailto:exxk.lx@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/iexxk" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/11/tools-gradle-muilt-project-builds/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/11/tools-gradle-muilt-project-builds/" class="post-title-link" itemprop="url">Tools-Gradle-muilt-project-Builds</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-11 17:09:29" itemprop="dateCreated datePublished" datetime="2018-05-11T17:09:29+00:00">2018-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
    <span id="/2018/05/11/tools-gradle-muilt-project-builds/" class="post-meta-item leancloud_visitors" data-flag-title="Tools-Gradle-muilt-project-Builds" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="多项目构建"><a href="#多项目构建" class="headerlink" title="多项目构建"></a>多项目构建</h3><h5 id="初始化顶级项目"><a href="#初始化顶级项目" class="headerlink" title="初始化顶级项目"></a>初始化顶级项目</h5><ol>
<li><p>项目初始化</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir multi<span class="literal">-project</span></span><br><span class="line"><span class="built_in">cd</span> multi<span class="literal">-project</span></span><br><span class="line">gradle init</span><br></pre></td></tr></table></figure>
</li>
<li><p>顶级构建，也就是采用跟项目的配置，从而减少子项目的重复配置，可以把子项目的公共配置抽离到跟项目配置里。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跟项目build.gradle添加</span></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter() <span class="comment">//将jcenter仓库配置到所有项目</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">subprojects &#123;</span><br><span class="line">    version = <span class="string">&#x27;1.0&#x27;</span> <span class="comment">//设置版本号</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="添加Groovy-library子项目"><a href="#添加Groovy-library子项目" class="headerlink" title="添加Groovy library子项目"></a>添加Groovy library子项目</h5><ol>
<li><p>执行<code>mkdir multi-library</code>创建一个子项目名为<code>multi-library</code></p>
</li>
<li><p>进入<code>multi-library</code>子项目根目录，新建一个<code>build.gradle</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//multi-library/build.gradle</span></span><br><span class="line">apply <span class="attr">plugin :</span> <span class="string">&#x27;groovy&#x27;</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;org.codehaus.groovy:groovy:2.4.10&#x27;</span></span><br><span class="line">    testCompile <span class="string">&#x27;org.spockframework:spock-core:1.0-groovy-2.4&#x27;</span>, &#123;</span><br><span class="line">        exclude <span class="attr">module :</span> <span class="string">&#x27;groovy-all&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改顶级项目根项目的<code>settings.gradle</code>,添加<code>include &#39;multi-library&#39;</code></p>
</li>
<li><p>完善子项目，创建两个目录<code>mkdir -p multi-library/src/main/groovy/greeter</code>和<code>mkdir -p multi-library/src/test/groovy/greeter</code></p>
</li>
<li><p>在目录<code>src/main/groovy/greeter</code>新建<code>GreetingFormatter.groovy</code>文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//multi-library/src/main/groovy/greeter/GreetingFormatter.groovy</span></span><br><span class="line"><span class="keyword">package</span> greeter</span><br><span class="line"><span class="keyword">import</span> groovy.transform.CompileStatic</span><br><span class="line"><span class="meta">@CompileStatic</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetingFormatter</span> &#123;</span></span><br><span class="line">    <span class="keyword">static</span> String greeting(<span class="keyword">final</span> String name) &#123;</span><br><span class="line">        <span class="string">&quot;Hello, $&#123;name.capitalize()&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在目录<code>src/test/groovy/greeter</code>新建<code>GreetingFormatterSpec.groovy</code>文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//multi-library/src/test/groovy/greeter/GreetingFormatterSpec.groovy</span></span><br><span class="line"><span class="keyword">package</span> greeter</span><br><span class="line"><span class="keyword">import</span> spock.lang.Specification</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreetingFormatterSpec</span> <span class="keyword">extends</span> <span class="title">Specification</span> &#123;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="string">&#x27;Creating a greeting&#x27;</span>() &#123;</span><br><span class="line">        <span class="symbol">expect:</span> <span class="string">&#x27;The greeting to be correctly capitalized&#x27;</span></span><br><span class="line">        GreetingFormatter.greeting(<span class="string">&#x27;gradlephant&#x27;</span>) == <span class="string">&#x27;Hello, Gradlephant&#x27;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后在顶级项目的根目录运行<code>./gradlew build</code>，到此一个项目依赖一个子项目就完成了</p>
</li>
</ol>
<h5 id="添加一个java-子项目"><a href="#添加一个java-子项目" class="headerlink" title="添加一个java 子项目"></a>添加一个java 子项目</h5><ol>
<li><p>执行<code>mkdir java-demo</code>创建一个子项目名为<code>java-demo</code></p>
</li>
<li><p>进入<code>java-demo</code>子项目根目录，新建一个<code>build.gradle</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin :</span> <span class="string">&#x27;java&#x27;</span> </span><br><span class="line">apply <span class="attr">plugin :</span> <span class="string">&#x27;application&#x27;</span> </span><br></pre></td></tr></table></figure>
</li>
<li><p>完善子项目，创建目录<code>mkdir -p  java-demo/src/main/java/greeter</code></p>
</li>
<li><p>修改顶级项目根项目的<code>settings.gradle</code>,添加<code>include &#39;java-demo&#39;</code></p>
</li>
<li><p>在目录<code>java-demo/src/main/java/greeter</code>新建<code>Greeter.java</code>文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> greeter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String output = GreetingFormatter.greeting(args[<span class="number">0</span>]);</span><br><span class="line">        System.out.println(output);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入<code>java-demo</code>子项目根目录，修改<code>build.gradle</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apply plugin : &#39;java&#39; </span><br><span class="line">apply plugin : &#39;application&#39; </span><br><span class="line">mainClassName &#x3D; &#39;greeter.Greeter&#39;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后在顶级项目的根目录运行<code>./gradlew build</code>,会出现依赖错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* What went wrong:</span><br><span class="line">Execution failed for task &#39;:java-demo:compileJava&#39;.</span><br><span class="line">&gt; Compilation failed; see the compiler error output for details.</span><br></pre></td></tr></table></figure>
</li>
<li><p>解决，进入<code>java-demo</code>子项目根目录，修改<code>build.gradle</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apply plugin : &#39;java&#39; </span><br><span class="line">apply plugin : &#39;application&#39; </span><br><span class="line">mainClassName &#x3D; &#39;greeter.Greeter&#39;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile project(&#39;:multi-library&#39;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新执行<code>./gradlew build</code>，编译成功</p>
</li>
<li><p>添加test测试编译，进入<code>java-demo</code>子项目根目录，修改<code>build.gradle</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin :</span> <span class="string">&#x27;java&#x27;</span> </span><br><span class="line">apply <span class="attr">plugin :</span> <span class="string">&#x27;application&#x27;</span> </span><br><span class="line">apply <span class="attr">plugin :</span> <span class="string">&#x27;groovy&#x27;</span></span><br><span class="line">mainClassName = <span class="string">&#x27;greeter.Greeter&#x27;</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile project(<span class="string">&#x27;:multi-library&#x27;</span>) </span><br><span class="line">    testCompile <span class="string">&#x27;org.spockframework:spock-core:1.0-groovy-2.4&#x27;</span>, &#123;</span><br><span class="line">    	exclude <span class="attr">module :</span> <span class="string">&#x27;groovy-all&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建测试目录<code>mkdir -p  java-demo/src/test/groovy/greeter</code>，添加<code>GreeterSpec.groovy</code>文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//java-demo/src/test/groovy/greeter/GreeterSpec.groovy</span></span><br><span class="line"><span class="keyword">package</span> greeter</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> spock.lang.Specification</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreeterSpec</span> <span class="keyword">extends</span> <span class="title">Specification</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="string">&#x27;Calling the entry point&#x27;</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="symbol">setup:</span> <span class="string">&#x27;Re-route standard out&#x27;</span></span><br><span class="line">        <span class="keyword">def</span> buf = <span class="keyword">new</span> ByteArrayOutputStream(<span class="number">1024</span>)</span><br><span class="line">        System.out = <span class="keyword">new</span> PrintStream(buf)</span><br><span class="line"></span><br><span class="line">        <span class="symbol">when:</span> <span class="string">&#x27;The entrypoint is executed&#x27;</span></span><br><span class="line">        Greeter.main(<span class="string">&#x27;gradlephant&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span> <span class="string">&#x27;The correct greeting is output&#x27;</span></span><br><span class="line">        buf.toString() == <span class="string">&quot;Hello, Gradlephant\n&quot;</span>.denormalize()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>单项目编译，执行<code>./gradlew :java-demo:test</code> 其中java-demo为项目名，test为那种编译类型，也可以执行去子项目跟目录执行<code>../gradlew test</code>进行单模块编译</p>
</li>
</ol>
<h5 id="添加文档子项目"><a href="#添加文档子项目" class="headerlink" title="添加文档子项目"></a>添加文档子项目</h5><ol>
<li><p>在顶级项目的<code>build.gradle</code>添加插件<code>asciidoctor</code>该插件的作用主要是将文档生成网页文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">  <span class="comment">//apply false将插件添加到整个项目中，但不会将其添加到根项目中。</span></span><br><span class="line">  id <span class="string">&#x27;org.asciidoctor.convert&#x27;</span> version <span class="string">&#x27;1.5.6&#x27;</span> apply <span class="literal">false</span>  <span class="comment">//文档插件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建文档项目目录，在顶级项目跟目录，执行<code>mkdir docs</code></p>
</li>
<li><p>然后在docs目录新建个<code>build.gradle</code>，在里头添加如下内容</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin :</span> <span class="string">&#x27;org.asciidoctor.convert&#x27;</span>  <span class="comment">//将插件用于该子项目</span></span><br><span class="line"><span class="comment">//asciidoctor任务</span></span><br><span class="line">asciidoctor &#123;</span><br><span class="line">    sources &#123;</span><br><span class="line">        include <span class="string">&#x27;greeter.adoc&#x27;</span>  <span class="comment">//文档资源文件，需要自己新建</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将asciidoctor任务添加到构建生命周期中，以便如果为顶级项目执行构建，则也将构建文档。</span></span><br><span class="line">build.dependsOn <span class="string">&#x27;asciidoctor&#x27;</span> </span><br></pre></td></tr></table></figure>
</li>
<li><p>修改顶级项目根项目的<code>settings.gradle</code>,添加<code>include &#39;docs&#39;</code></p>
</li>
<li><p>然后新建个文档<code>docs/src/docs/asciidoc/greeter.adoc</code>,没有该目录创建就行,内容随便，后面会把此文件文档转为网页文件</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x3D; Greeter Command-line Application</span><br><span class="line"></span><br><span class="line">A simple application demonstrating the flexibility of a Gradle multi-project.</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D; Installation</span><br><span class="line"></span><br><span class="line">Unpack the ZIP or TAR file in a suitable location</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D; Usage</span><br><span class="line"></span><br><span class="line">[listing]</span><br><span class="line">----</span><br><span class="line">$ cd greeter-1.0</span><br><span class="line">$ .&#x2F;bin&#x2F;greeter gradlephant</span><br><span class="line"></span><br><span class="line">Hello, Gradlephant</span><br><span class="line">----</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后在顶级项目跟目录，运行task任务<code>asciidoctor</code>,执行<code>./gradlew asciidoctor</code></p>
</li>
<li><p>会在目录<code>docs/build/asciidoc/html5</code>目录生成网页文件<code>greeter.html</code></p>
</li>
</ol>
<h5 id="将文档包含到发布的项目"><a href="#将文档包含到发布的项目" class="headerlink" title="将文档包含到发布的项目"></a>将文档包含到发布的项目</h5><ol>
<li><p>要将文档包含到发布的项目的目录可以新建task任务即可，修改<code>java-demo</code>项目的配置文件<code>build.gradle</code>增加如下内容</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">distZip &#123;</span><br><span class="line">    from project(<span class="string">&#x27;:docs&#x27;</span>).asciidoctor, &#123; </span><br><span class="line">        into <span class="string">&quot;$&#123;project.name&#125;-$&#123;version&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">distTar &#123;</span><br><span class="line">    from project(<span class="string">&#x27;:docs&#x27;</span>).asciidoctor, &#123;</span><br><span class="line">        into <span class="string">&quot;$&#123;project.name&#125;-$&#123;version&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后重新编译文件即可，在顶级项目跟目录执行<code>./gradlew build</code></p>
</li>
<li><p>最后会在<code>java-demo//build/distributions</code>目录生成两个<code>greeter-1.0.zip</code> 和 <code>greeter-1.0.tar</code>，里面包含了编译好了的网页文件</p>
</li>
</ol>
<h5 id="整理顶级构建脚本"><a href="#整理顶级构建脚本" class="headerlink" title="整理顶级构建脚本"></a>整理顶级构建脚本</h5><p>在java-demo和muilt-library项目中有相同的配置，这里把他们抽到顶级项目里配置</p>
<ol>
<li><p>在顶级项目的<code>build.gradle</code>里添加公共配置</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">configure(subprojects.findAll &#123;it.name == <span class="string">&#x27;java-demo&#x27;</span> || it.name == <span class="string">&#x27;multi-library&#x27;</span>&#125; ) &#123; <span class="comment">//指定配置那些项目</span></span><br><span class="line"></span><br><span class="line">    apply <span class="attr">plugin :</span> <span class="string">&#x27;groovy&#x27;</span></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        testCompile <span class="string">&#x27;org.spockframework:spock-core:1.0-groovy-2.4&#x27;</span>, &#123;</span><br><span class="line">            exclude <span class="attr">module :</span> <span class="string">&#x27;groovy-all&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除子项目公有的配置，最终所有<code>build.gradle</code>配置如下</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//顶级项目build.gradle</span></span><br><span class="line">plugins &#123;</span><br><span class="line">  <span class="comment">//apply false将插件添加到整个项目中，但不会将其添加到根项目中。</span></span><br><span class="line">  id <span class="string">&#x27;org.asciidoctor.convert&#x27;</span> version <span class="string">&#x27;1.5.6&#x27;</span> apply <span class="literal">false</span>  <span class="comment">//文档插件</span></span><br><span class="line">&#125;</span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter() <span class="comment">//将jcenter仓库配置到所有项目</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">subprojects &#123;</span><br><span class="line">    version = <span class="string">&#x27;1.0&#x27;</span> <span class="comment">//设置版本号</span></span><br><span class="line">&#125;</span><br><span class="line">configure(subprojects.findAll &#123;it.name == <span class="string">&#x27;java-demo&#x27;</span> || it.name == <span class="string">&#x27;multi-library&#x27;</span>&#125; ) &#123; </span><br><span class="line"></span><br><span class="line">    apply <span class="attr">plugin :</span> <span class="string">&#x27;groovy&#x27;</span></span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        testCompile <span class="string">&#x27;org.spockframework:spock-core:1.0-groovy-2.4&#x27;</span>, &#123;</span><br><span class="line">            exclude <span class="attr">module :</span> <span class="string">&#x27;groovy-all&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//----------------------------------------------------------</span></span><br><span class="line"><span class="comment">//multi-library项目build.gradle</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">&#x27;org.codehaus.groovy:groovy:2.4.10&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//-----------------------------------------------------------</span></span><br><span class="line"><span class="comment">//java-demo项目build.gradle</span></span><br><span class="line">apply <span class="attr">plugin :</span> <span class="string">&#x27;java&#x27;</span> </span><br><span class="line">apply <span class="attr">plugin :</span> <span class="string">&#x27;application&#x27;</span> </span><br><span class="line">mainClassName = <span class="string">&#x27;greeter.Greeter&#x27;</span></span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile project(<span class="string">&#x27;:multi-library&#x27;</span>) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">distZip &#123;</span><br><span class="line">    from project(<span class="string">&#x27;:docs&#x27;</span>).asciidoctor, &#123; </span><br><span class="line">        into <span class="string">&quot;$&#123;project.name&#125;-$&#123;version&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">distTar &#123;</span><br><span class="line">    from project(<span class="string">&#x27;:docs&#x27;</span>).asciidoctor, &#123;</span><br><span class="line">        into <span class="string">&quot;$&#123;project.name&#125;-$&#123;version&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后执行<code>./gradlew clean build</code>重新构建</p>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p>子项目只需<code>build.gradle</code>配置即可，且子项目不能gradle init</p>
</li>
<li><p>要父项目包含子项目，需要在<code>setting.gradle</code>设置<code>include &#39;项目名&#39;</code></p>
</li>
<li><p>子项目依赖其他子项目只需要设置<code>compile project(&#39;:子项目名&#39;) </code></p>
</li>
<li><p>插件需要在最顶部定义</p>
</li>
<li><p>运行单模块执行<code>./gradlew :子项目名:构建命令</code>构建命令目前包括test、build、clean</p>
</li>
<li><p>抽离子项目共有配置到父项目用<code>configure</code></p>
</li>
<li><p>常用命令</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gradle :</span><span class="attr">eurekaserver:</span>build <span class="comment">//执行子项目eurekaserver构建build命令</span></span><br></pre></td></tr></table></figure>



</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/10/tools-gradle-base/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/10/tools-gradle-base/" class="post-title-link" itemprop="url">Tools-Gradle-Base</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-10 16:58:41" itemprop="dateCreated datePublished" datetime="2018-05-10T16:58:41+00:00">2018-05-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
    <span id="/2018/05/10/tools-gradle-base/" class="post-meta-item leancloud_visitors" data-flag-title="Tools-Gradle-Base" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="安装Gradle"><a href="#安装Gradle" class="headerlink" title="安装Gradle"></a><a target="_blank" rel="noopener" href="https://gradle.org/install/">安装Gradle</a></h2><ol>
<li>java环境必须</li>
<li>下载<a target="_blank" rel="noopener" href="https://gradle.org/releases/">Gradle</a>,其中binary-only为单独的安装包，complete为文档加安装包，然后解压</li>
<li>在path中添加系统环境变量<code>F:\xuan\gradle-4.7\bin</code></li>
<li>执行<code>gradle -v</code>检查是否安装成功</li>
</ol>
<h2 id="使用Gradle"><a href="#使用Gradle" class="headerlink" title="使用Gradle"></a>使用Gradle</h2><ol>
<li>进入一个Gradle项目,或者拉取一个<code> git clone git@github.com:gradle/gradle-build-scan-quickstart.git</code></li>
</ol>
<h3 id="Gradle-build-scans使用"><a href="#Gradle-build-scans使用" class="headerlink" title="Gradle build scans使用"></a>Gradle build scans使用</h3><blockquote>
<p>Build Scans是用于开发和维护Gradle构建的重要工具。它为你提供了构建的详细信息，并为你识别构建环境、依赖或性能上存在的问题，同时可以帮你更全面地理解并提升构建过程，也便于与他人的合作。</p>
</blockquote>
<p>大概理解就是该插件能把构建过程的数据分享出去，方便让别人查看分析构建信息。</p>
<ol>
<li><p>进入项目跟目录执行构建扫描命令<code>./gradlew build --scan</code>，有可能会提示<code>Do you accept these terms?</code>是否接受许可协议，输入yes即可，成功后日志会输出一个链接类似<a target="_blank" rel="noopener" href="https://scans.gradle.com/s/z5i6rmnpd4sbu%EF%BC%8C%E8%AE%BF%E9%97%AE%E8%AF%A5%E9%93%BE%E6%8E%A5%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8B%E6%9E%84%E5%BB%BA%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF%E4%BA%86%EF%BC%88%E6%9C%89%E7%9A%84%E6%89%93%E5%BC%80%E4%B9%9F%E8%AE%B8%E9%9C%80%E8%A6%81%E9%82%AE%E7%AE%B1%EF%BC%89%E3%80%82">https://scans.gradle.com/s/z5i6rmnpd4sbu，访问该链接就可以查看构建日志信息了（有的打开也许需要邮箱）。</a></p>
</li>
<li><p>上面虽然得到了链接，但是可以直接在<code>build.gradle</code>添加相关配置信息，构建扫描插件<a target="_blank" rel="noopener" href="https://plugins.gradle.org/plugin/com.gradle.build-scan">build-scan</a>,为了将构建扫码发布到<a target="_blank" rel="noopener" href="https://gradle.com/terms-of-service%E9%9C%80%E8%A6%81%E6%8E%A5%E5%8F%97%E5%8D%8F%E8%AE%AE">https://gradle.com/terms-of-service需要接受协议</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id &#39;com.gradle.build-scan&#39; version &#39;1.13.2&#39; &#x2F;&#x2F;如果是低版本一定要放到其他插件前面</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;配置扫描发送地址，以及同意协议</span><br><span class="line">buildScan &#123;</span><br><span class="line">    termsOfServiceUrl &#x3D; &#39;https:&#x2F;&#x2F;gradle.com&#x2F;terms-of-service&#39;</span><br><span class="line">    termsOfServiceAgree &#x3D; &#39;yes&#39;  &#x2F;&#x2F;同意协议</span><br><span class="line">	tag &#39;xuan test&#39;  &#x2F;&#x2F;打标签</span><br><span class="line">	&#x2F;&#x2F;项目的地址，这里需要是http地址，用git开头的地址编译报错</span><br><span class="line">	link &#39;GitHub&#39;,&#39;https:&#x2F;&#x2F;github.com&#x2F;gradle&#x2F;gradle-build-scan-quickstart&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行<code>gradle build -Dscan</code>运行得到链接，然后访问即可</p>
</li>
</ol>
<h3 id="Creating-New-Gradle-Builds"><a href="#Creating-New-Gradle-Builds" class="headerlink" title="Creating New Gradle Builds"></a>Creating New Gradle Builds</h3><h5 id="初始化gradle-项目"><a href="#初始化gradle-项目" class="headerlink" title="初始化gradle 项目"></a>初始化gradle 项目</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mkdir gradle<span class="literal">-demo</span> <span class="comment">#创建项目目录</span></span><br><span class="line"><span class="built_in">cd</span> gradle<span class="literal">-demo</span> <span class="comment">#进入项目目录</span></span><br><span class="line">gradle init <span class="comment">#初始化为gradle项目</span></span><br><span class="line"><span class="comment">#生成如下目录文件</span></span><br><span class="line">.</span><br><span class="line">├── build.gradle   <span class="comment">#项目配置脚本</span></span><br><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle<span class="literal">-wrapper</span>.jar  <span class="comment">#wrapper可执行jar</span></span><br><span class="line">│       └── gradle<span class="literal">-wrapper</span>.properties  <span class="comment">#wrapper 配置文件</span></span><br><span class="line">├── gradlew  <span class="comment"># unix systems（linux）系统下的脚本</span></span><br><span class="line">├── gradlew.bat  <span class="comment"># window 下的脚本</span></span><br><span class="line">└── settings.gradle  <span class="comment">#配置那些项目参与构建脚本</span></span><br></pre></td></tr></table></figure>

<h5 id="创建task任务名叫copy"><a href="#创建task任务名叫copy" class="headerlink" title="创建task任务名叫copy"></a>创建task任务名叫<code>copy</code></h5><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">task copy(<span class="attr">type:</span> Copy, <span class="attr">group:</span> <span class="string">&quot;Custom&quot;</span>, <span class="attr">description:</span> <span class="string">&quot;复制src目录到dest目录&quot;</span>) &#123;</span><br><span class="line">    from <span class="string">&quot;src&quot;</span>   <span class="comment">//前提需要有src目录</span></span><br><span class="line">    into <span class="string">&quot;dest&quot;</span>  <span class="comment">//不需要创建，会自动创建</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>命令行执行<code>./gradlew copy</code>代表执行task里的copy任务</p>
<h5 id="Gradle-应用插件"><a href="#Gradle-应用插件" class="headerlink" title="Gradle 应用插件"></a>Gradle 应用插件</h5><p><a target="_blank" rel="noopener" href="https://plugins.gradle.org/">插件仓库</a></p>
<p>这里以base插件，base插件功能主要是打包为zip文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;   <span class="comment">//这个代码快必须放顶部</span></span><br><span class="line">	id <span class="string">&quot;base&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">task copy(<span class="attr">type:</span> Copy, <span class="attr">group:</span> <span class="string">&quot;Custom&quot;</span>, <span class="attr">description:</span> <span class="string">&quot;复制src目录到dest目录&quot;</span>) &#123;</span><br><span class="line">    from <span class="string">&quot;src&quot;</span></span><br><span class="line">    into <span class="string">&quot;dest&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">task zip(<span class="attr">type:</span> Zip, <span class="attr">group:</span> <span class="string">&quot;Util&quot;</span>, <span class="attr">description:</span> <span class="string">&quot;压缩src目录文件&quot;</span>) &#123;</span><br><span class="line">	from <span class="string">&quot;src&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行<code>./gradlew zip</code>,然后在目录  <code>.\build\distributions</code>下就可以看到<code>gradle-demo.zip</code>文件了</p>
<h5 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./gradlew tasks <span class="comment">#查看可用的task任务</span></span><br><span class="line">./gradlew zip -<span class="literal">-scan</span>  <span class="comment">#结合scan执行zip，分析执行信息</span></span><br><span class="line">./gradlew properties <span class="comment">#查看可用的配置属性，类似环境变量(配置属性)的</span></span><br></pre></td></tr></table></figure>

<p>在<code>build.gradle</code>可以更改<code>properties</code>变量的值，但是不能新增，例如修改项目描述和版本号</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//放在build.gradle文件中，但是不能放在plugins前面，因为plugins这个必须在顶部</span></span><br><span class="line">description = <span class="string">&quot;该项目为测试学习用&quot;</span></span><br><span class="line">version = <span class="string">&quot;1.0&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="手册"><a href="#手册" class="headerlink" title="手册"></a>手册</h2><p><a target="_blank" rel="noopener" href="https://docs.gradle.org/4.7/userguide/command_line_interface.html">Gradle 命令手册</a></p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>不能在gradle项目的子目录执行<code>gradle init</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/09/android-recyclerview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/09/android-recyclerview/" class="post-title-link" itemprop="url">Android-RecyclerView</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-09 11:26:38" itemprop="dateCreated datePublished" datetime="2018-05-09T11:26:38+00:00">2018-05-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
    <span id="/2018/05/09/android-recyclerview/" class="post-meta-item leancloud_visitors" data-flag-title="Android-RecyclerView" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="RecyclerView-基本使用"><a href="#RecyclerView-基本使用" class="headerlink" title="RecyclerView 基本使用"></a>RecyclerView 基本使用</h3><ol>
<li><p>添加依赖v7包依赖，版本号和<code>compileSdkVersion</code>一致，不然报错</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.android.support:appcompat-v7:25.0.0&#x27;</span></span><br><span class="line">implementation <span class="string">&#x27;com.android.support:recyclerview-v7:25.0.0&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在layout里添加<code>RecyclerView</code>布局的引用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;android.support.v7.widget.RecyclerView</span><br><span class="line">    android:id=&quot;@+id/recyView1&quot;</span><br><span class="line">    android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加一个item的布局</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/recyNumberPhone&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;TextView&quot;</span><br><span class="line">        app:layout_constraintStart_toStartOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/recyNumberName&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;TextView&quot;</span><br><span class="line">        app:layout_constraintEnd_toEndOf=&quot;parent&quot;</span><br><span class="line">        app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建适配器<code>RecyNumberAdapter</code>继承<code> RecyclerView.Adapter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecyNumberAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">RecyNumberAdapter</span>.<span class="title">NumberHolder</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context context; <span class="comment">//上下文</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Map&lt;String,String&gt;&gt; mDatas;  <span class="comment">//数据源</span></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RecyNumberAdapter</span><span class="params">(Context context,List&lt;Map&lt;String,String&gt;&gt; mDatas)</span></span>&#123;</span><br><span class="line">        <span class="comment">//构造方法传入数据</span></span><br><span class="line">        <span class="keyword">this</span>.context=context;</span><br><span class="line">        <span class="keyword">this</span>.mDatas=mDatas;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> NumberHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 填充布局item</span></span><br><span class="line">        View view = LayoutInflater.from(context).inflate(R.layout.recy_number, <span class="keyword">null</span>);</span><br><span class="line">        NumberHolder holder = <span class="keyword">new</span> NumberHolder(view);</span><br><span class="line">        <span class="keyword">return</span> holder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(<span class="keyword">final</span> NumberHolder holder, <span class="keyword">final</span> <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//绑定view</span></span><br><span class="line">  holder.recyNumberName.setText(String.valueOf(mDatas.get(position).get(<span class="string">&quot;name&quot;</span>))); <span class="comment">//用户名</span></span><br><span class="line">  holder.recyNumberPhone.setText(String.valueOf(mDatas.get(position).get(<span class="string">&quot;id&quot;</span>))); <span class="comment">//电话号码  </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mDatas.size(); <span class="comment">//数据长度</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//类部类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span>  <span class="title">NumberHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span></span>&#123;</span><br><span class="line">        <span class="comment">//获取item子布局的控件</span></span><br><span class="line">        <span class="keyword">private</span> TextView recyNumberPhone;</span><br><span class="line">        <span class="keyword">private</span> TextView recyNumberName;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">NumberHolder</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(view);</span><br><span class="line">            recyNumberPhone=view.findViewById(R.id.recyNumberPhone);</span><br><span class="line">            recyNumberName=view.findViewById(R.id.recyNumberName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>调用测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RecyclerView recyNumberView=findViewById(R.id.personalNumber);</span><br><span class="line"><span class="comment">// 设置布局管理器有横向，表格等等</span></span><br><span class="line">GridLayoutManager gridLayoutManager=<span class="keyword">new</span> GridLayoutManager(<span class="keyword">this</span>,<span class="number">4</span>);</span><br><span class="line">recyNumberView.setLayoutManager(gridLayoutManager);</span><br><span class="line"><span class="comment">//测试数据</span></span><br><span class="line">List&lt;Map&lt;String,String&gt;&gt; datas=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Map&lt;String,String&gt; map=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;13432861290&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">datas.add(map);</span><br><span class="line"><span class="comment">//设置适配器</span></span><br><span class="line">recyNumberView.setAdapter(<span class="keyword">new</span> RecyNumberAdapter(<span class="keyword">this</span>,datas));</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加点击事件，在<code>RecyNumberAdapter</code>里添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> OnItemClickListener mItemClickListener;</span><br><span class="line"><span class="comment">//item的回调接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnItemClickListener</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(View view, <span class="keyword">int</span> Position)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义一个设置点击监听器的方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnItemClickListener</span><span class="params">(OnItemClickListener itemClickListener)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.mItemClickListener = itemClickListener;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在覆写的onBindViewHolder方法中添加</span></span><br><span class="line">  <span class="comment">//如果设置了回调，则设置点击事件</span></span><br><span class="line"><span class="keyword">if</span> (mItemClickListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">    holder.itemView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            mItemClickListener.onItemClick(holder.itemView, position);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>调用的时候只需要<code>recyNumberAdapter.setOnItemClickListener</code>即可</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/08/dubbo-basebuild/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/08/dubbo-basebuild/" class="post-title-link" itemprop="url">Dubbo-BaseBuild</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-08 15:46:14" itemprop="dateCreated datePublished" datetime="2018-05-08T15:46:14+00:00">2018-05-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Dubbo/" itemprop="url" rel="index"><span itemprop="name">Dubbo</span></a>
        </span>
    </span>

  
    <span id="/2018/05/08/dubbo-basebuild/" class="post-meta-item leancloud_visitors" data-flag-title="Dubbo-BaseBuild" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://dubbo.incubator.apache.org/">dubbo官网</a>/<a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/com.alibaba/dubbo">dubbo仓库地址</a></p>
<ol>
<li><p>环境准备新建一个空的project，分别三个model</p>
<table>
<thead>
<tr>
<th>model名称</th>
<th>model类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>common_interface</td>
<td>java类型空项目</td>
<td>用于存放服务提供者和服务消费者的公共接口，避免写两次而已</td>
</tr>
<tr>
<td>consumer</td>
<td>springboot空项目</td>
<td>消费者服务依赖<code>common_interface </code>  model</td>
</tr>
<tr>
<td>provider</td>
<td>springboot空项目</td>
<td>提供者服务依赖<code>common_interface </code>  model</td>
</tr>
</tbody></table>
</li>
<li><p>上面项目建立好，model依赖关系加好之后，下面开始引入dubbo框架</p>
</li>
<li><p>两个springboot项目都引入dubbo依赖这里用的gradle，仓库地址可以去<a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/com.alibaba/dubbo">dubbo仓库地址</a>查看</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="attr">group:</span> <span class="string">&#x27;com.alibaba&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;dubbo&#x27;</span>, <span class="attr">version:</span> <span class="string">&#x27;2.6.1&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>common_interface</code>项目中添加一个接口类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> exxk.dubbo.commonimpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">sayHello</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>provider</code>项目中实现<code>DemoService</code>接口，在java目录下新建impl包，并添加一个<code>DemoServiceImpl</code>实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> exxk.dubbo.provider.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> exxk.dubbo.commonimpl.DemoService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoServiceImpl</span> <span class="keyword">implements</span> <span class="title">DemoService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>+ name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>provider</code>项目中<code>resource</code>目录下添加一个dubbo配置文件<code>dubbo-provider.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--该提供者服务名称--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;dubbo-provider&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--组播模式的注册中心，推荐用zookeeper--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;multicast://224.5.6.7:1234&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--暴露的端口服务--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--声明暴露服务公共接口类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;exxk.dubbo.commonimpl.DemoService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;demoService&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--提供者实现类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;demoService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;exxk.dubbo.provider.impl.DemoServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>provider</code>项目中<code>java</code>目录下添加一个dubbo 启动类<code>Provider.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> exxk.dubbo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Provider</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">                <span class="keyword">new</span> String[]&#123;<span class="string">&quot;dubbo-provider.xml&quot;</span>&#125;); <span class="comment">//读取dubbo配置文件</span></span><br><span class="line">        context.start();</span><br><span class="line">        <span class="comment">//按任何键推出</span></span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>上面的服务提供者基本完成，然后启动服务提供者，直接运行<code>Provider.java</code>静态方法即可</p>
</li>
<li><p>在<code>consumer</code>项目中<code>resource</code>目录下添加一个dubbo配置文件<code>dubbo-consumer.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;dubbo-consumer&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册中心地址（多播）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;multicast://224.5.6.7:1234&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">&quot;demoService&quot;</span> <span class="attr">interface</span>=<span class="string">&quot;exxk.dubbo.commonimpl.DemoService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>consumer</code>项目中<code>java</code>目录下添加一个dubbo 启动类<code>Consumer.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> exxk.dubbo.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> exxk.dubbo.commonimpl.DemoService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        ClassPathXmlApplicationContext context=<span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">                <span class="keyword">new</span> String[]&#123;<span class="string">&quot;dubbo-consumer.xml&quot;</span>&#125;);</span><br><span class="line">        context.start();</span><br><span class="line">        DemoService demoService= (DemoService) context.getBean(<span class="string">&quot;demoService&quot;</span>);</span><br><span class="line">        String hello= demoService.sayHello(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">        System.out.print(hello);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动<code>consumer</code>服务消费者项目，这里用debug模式运行<code>Consumer.java</code>在里面打断点，主要是日志不好找，因此debug</p>
</li>
</ol>
<h3 id="基于springboot优化启动类"><a href="#基于springboot优化启动类" class="headerlink" title="基于springboot优化启动类"></a>基于springboot优化启动类</h3><p>在springboot启动类添加dubbo启动，去掉默认的dubbo启动</p>
<ol>
<li><p>最直接的是把dubbo启动类的配置xml内容直接放到application启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(ProviderApplication.class, args);</span><br><span class="line">		ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">                <span class="keyword">new</span> String[]&#123;<span class="string">&quot;dubbo-provider.xml&quot;</span>&#125;); <span class="comment">//读取dubbo配置文件</span></span><br><span class="line">        context.start();</span><br><span class="line">        <span class="comment">//同步锁，保持该线程一直运行</span></span><br><span class="line">        <span class="keyword">synchronized</span> (Provider.class)&#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Provider.class.wait();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;synchronized===:&quot;</span>+e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>这种当然不优雅，可以直接把xml配置文件配置到注解<code>@ImportResource</code>上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(ProviderApplication.class, args);</span><br><span class="line">        <span class="comment">//同步锁，保持该线程一直运行</span></span><br><span class="line">        <span class="keyword">synchronized</span> (Provider.class)&#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Provider.class.wait();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;synchronized===:&quot;</span>+e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码是少了，但是据说，dubbo包含web框架，会让springboot当成web程序运行，这里自定义<code>SpringApplicationBuilder</code>禁用web</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ApplicationContext context= <span class="keyword">new</span> SpringApplicationBuilder()</span><br><span class="line">				.sources(ProviderApplication.class)</span><br><span class="line">				.web(WebApplicationType.NONE)  <span class="comment">//禁用web服务</span></span><br><span class="line">				.run(args);</span><br><span class="line">        <span class="comment">//同步锁，保持该线程一直运行</span></span><br><span class="line">        <span class="keyword">synchronized</span> (Provider.class)&#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Provider.class.wait();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;synchronized===:&quot;</span>+e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>同步锁线程也换种方式实现,利用同步工具类<code>CountDownLatch</code>,该工具类的大概作用就是有等待指定线程（数）执行完了，再执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ImportResource(&#123;&quot;classpath:dubbo-provider.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> CountDownLatch <span class="title">closeLatch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		<span class="comment">//SpringApplication.run(ProviderApplication.class, args);</span></span><br><span class="line">		ApplicationContext context= <span class="keyword">new</span> SpringApplicationBuilder()</span><br><span class="line">				.sources(ProviderApplication.class)</span><br><span class="line">				.web(WebApplicationType.NONE)  <span class="comment">//禁用web服务</span></span><br><span class="line">				.run(args);</span><br><span class="line"></span><br><span class="line">		CountDownLatch closeLatch=context.getBean(CountDownLatch.class);</span><br><span class="line">		closeLatch.await(); <span class="comment">//等待所有子线程完成</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后删除旧的启动器，到此大功告成</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/07/springboot-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/07/springboot-note/" class="post-title-link" itemprop="url">SpringBoot-Note</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-07 16:14:45" itemprop="dateCreated datePublished" datetime="2018-05-07T16:14:45+00:00">2018-05-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
    <span id="/2018/05/07/springboot-note/" class="post-meta-item leancloud_visitors" data-flag-title="SpringBoot-Note" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Spring-Boot干货系列总纲-阅读笔记"><a href="#Spring-Boot干货系列总纲-阅读笔记" class="headerlink" title="Spring Boot干货系列总纲 阅读笔记"></a><a target="_blank" rel="noopener" href="http://tengj.top/2017/04/24/springboot0/">Spring Boot干货系列总纲</a> 阅读笔记</h2><h3 id="配置文件解析"><a href="#配置文件解析" class="headerlink" title="配置文件解析"></a>配置文件解析</h3><p>默认<code>src/main/resources</code>目录下，两种格式<code>application.properties</code>或<code>application.yml</code></p>
<p>自定义属性,在配置文件<code>application.properties</code>定义<code>diy.name=&quot;hello&quot; </code>,在使用的地方加上注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;diy.name&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span>  String name;</span><br></pre></td></tr></table></figure>

<p>自定义配置类,需要在springboot入口类添加<code>@EnableConfigurationProperties(&#123;ConfigBean.class&#125;)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;diy&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String want;</span><br><span class="line">    <span class="comment">// 省略getter和setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/03/script-nodejs-updateencode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/03/script-nodejs-updateencode/" class="post-title-link" itemprop="url">Script-nodejs-updateEncode</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-03 23:18:30" itemprop="dateCreated datePublished" datetime="2018-05-03T23:18:30+00:00">2018-05-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/script/" itemprop="url" rel="index"><span itemprop="name">script</span></a>
        </span>
    </span>

  
    <span id="/2018/05/03/script-nodejs-updateencode/" class="post-meta-item leancloud_visitors" data-flag-title="Script-nodejs-updateEncode" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>有bugbug。。。。。。。。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">批量修改文件编码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;开始修改文件编码&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> fs= <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">//---------同步----------------</span></span><br><span class="line"><span class="keyword">var</span> files =fs.readdirSync(<span class="string">&quot;./&quot;</span>);</span><br><span class="line">files.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">filename</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> stats=fs.statSync(filename);</span><br><span class="line">  <span class="built_in">console</span>.log(filename+<span class="string">&quot;文件状态&quot;</span>,stats);</span><br><span class="line">  <span class="comment">//if(stats.isDirectory()) filename +=&#x27;/&#x27;;</span></span><br><span class="line">  <span class="comment">//process.</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//----------异步------------------</span></span><br><span class="line">fs.readdir(<span class="string">&quot;./&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,files</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> len=files.length;</span><br><span class="line">  <span class="keyword">var</span> file=<span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">    file=files[i];</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;读取文件&quot;</span>,file);</span><br><span class="line">    <span class="keyword">var</span> stats=fs.stat(file);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;文件状态&quot;</span>,stats);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">批量修改文件编码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;开始修改文件编码&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> jschardet = <span class="built_in">require</span>(<span class="string">&quot;jschardet&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="string">&quot;node_modules/jschardet&quot;</span>;</span><br><span class="line">readDir(path);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">修改文件编码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readDir</span>(<span class="params">dirPath</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;目录:&quot;</span>,dirPath);</span><br><span class="line">    <span class="keyword">var</span> files = fs.readdirSync(dirPath);</span><br><span class="line">    files.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> filepath = dirPath +<span class="string">&quot;/&quot;</span>+file;</span><br><span class="line">        <span class="keyword">var</span> stats = fs.statSync(filepath);</span><br><span class="line">        <span class="comment">//console.log(filename+&quot;文件状态&quot;,stats);</span></span><br><span class="line">        <span class="keyword">if</span> (stats.isFile()) &#123;</span><br><span class="line">            <span class="keyword">var</span> buff = fs.readFileSync(file);</span><br><span class="line">            <span class="keyword">var</span> info = jschardet.detect(buff);</span><br><span class="line">            <span class="built_in">console</span>.log(filename + <span class="string">&quot;文件编码&quot;</span>, info);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (stats.isDirectory()) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;目录&quot;</span> + filepath);</span><br><span class="line">            readDir(filepath);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/05/02/javaee-tomcat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/05/02/javaee-tomcat/" class="post-title-link" itemprop="url">JavaEE-Tomcat</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-05-02 16:48:44" itemprop="dateCreated datePublished" datetime="2018-05-02T16:48:44+00:00">2018-05-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-03-09 14:20:58" itemprop="dateModified" datetime="2019-03-09T14:20:58+00:00">2019-03-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaEE/" itemprop="url" rel="index"><span itemprop="name">JavaEE</span></a>
        </span>
    </span>

  
    <span id="/2018/05/02/javaee-tomcat/" class="post-meta-item leancloud_visitors" data-flag-title="JavaEE-Tomcat" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="安装运行"><a href="#安装运行" class="headerlink" title="安装运行"></a>安装运行</h4><ol>
<li><p>tomcat 下载<a target="_blank" rel="noopener" href="http://tomcat.apache.org/download-80.cgi">apache-tomcat-8.5.12-windows-x64</a>然后解压安装</p>
</li>
<li><p>编辑<code>tomcat/conf/server.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 9301为自定义端口号,默认为8080 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;9301&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--复制或者修改host--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">&quot;localhost&quot;</span>  <span class="attr">appBase</span>=<span class="string">&quot;webapps&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">&quot;true&quot;</span> <span class="attr">autoDeploy</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 新加context  /app为url上下文,app为webapps下的app.war包--&gt;</span>	</span><br><span class="line">  <span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">&quot;/app&quot;</span> <span class="attr">docBase</span>=<span class="string">&quot;app&quot;</span> <span class="attr">reloadable</span>=<span class="string">&quot;false&quot;</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">source</span>=<span class="string">&quot;org.eclipse.jst.jee.server:tsj-spring&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">directory</span>=<span class="string">&quot;logs&quot;</span> <span class="attr">prefix</span>=<span class="string">&quot;localhost_access_log&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;.txt&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">pattern</span>=<span class="string">&quot;%h %l %u %t <span class="symbol">&amp;quot;</span>%r<span class="symbol">&amp;quot;</span> %s %b&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>运行tomcat,window下双击打开bin目录下的<code>startup.bat</code>启动app.war</p>
</li>
<li><p>访问为<code>ip:9301/app/</code></p>
</li>
</ol>
<h2 id="tomcat远程自动部署"><a href="#tomcat远程自动部署" class="headerlink" title="tomcat远程自动部署"></a>tomcat远程自动部署</h2><ol>
<li><p>安装<a target="_blank" rel="noopener" href="https://tomcat.apache.org/download-80.cgi">tomcat8.5.x</a></p>
</li>
<li><p>修改tomcat配置文件<code>conf/server.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">&quot;8019&quot;</span> <span class="attr">shutdown</span>=<span class="string">&quot;SHUTDOWN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.startup.VersionLoggerListener&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.core.AprLifecycleListener&quot;</span> <span class="attr">SSLEngine</span>=<span class="string">&quot;on&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.core.JreMemoryLeakPreventionListener&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.core.ThreadLocalLeakPreventionListener&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">&quot;UserDatabase&quot;</span> <span class="attr">auth</span>=<span class="string">&quot;Container&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">&quot;org.apache.catalina.UserDatabase&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">description</span>=<span class="string">&quot;User database that can be updated and saved&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">factory</span>=<span class="string">&quot;org.apache.catalina.users.MemoryUserDatabaseFactory&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">pathname</span>=<span class="string">&quot;conf/tomcat-users.xml&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">&quot;Catalina&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8005&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">connectionTimeout</span>=<span class="string">&quot;20010&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">redirectPort</span>=<span class="string">&quot;8454&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8021&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;AJP/1.3&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8454&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Engine</span> <span class="attr">name</span>=<span class="string">&quot;Catalina&quot;</span> <span class="attr">defaultHost</span>=<span class="string">&quot;H8005&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.realm.LockOutRealm&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.realm.UserDatabaseRealm&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">resourceName</span>=<span class="string">&quot;UserDatabase&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Realm</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">&quot;H8005&quot;</span>  <span class="attr">appBase</span>=<span class="string">&quot;webapps&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">unpackWARs</span>=<span class="string">&quot;true&quot;</span> <span class="attr">autoDeploy</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> <span class="attr">directory</span>=<span class="string">&quot;logs&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">prefix</span>=<span class="string">&quot;localhost_access_log&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;.txt&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">pattern</span>=<span class="string">&quot;%h %l %u %t <span class="symbol">&amp;quot;</span>%r<span class="symbol">&amp;quot;</span> %s %b&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改<code>conf/tomcat-users.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tomcat-users</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://tomcat.apache.org/xml&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line">              </span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;admin-gui&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;admin-script&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-script&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-jmx&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-status&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">&quot;admin&quot;</span> <span class="attr">password</span>=<span class="string">&quot;ideaadmin&quot;</span> <span class="attr">roles</span>=<span class="string">&quot;manager-gui,manager-script,manager-jmx,manager-status,admin-script,admin-gui&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">tomcat-users</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动tomcat执行<code>./bin/catalina.sh start | tail -f ./logs/catalina.out</code>,如果要修改启动内存，启动前提前修改<code>catalina.sh</code></p>
</li>
<li><p>在<code>conf/Catalina/h8005</code>添加<code>manager.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">privileged</span>=<span class="string">&quot;true&quot;</span> <span class="attr">antiResourceLocking</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">docBase</span>=<span class="string">&quot;$&#123;catalina.home&#125;/webapps/manager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span> <span class="attr">allow</span>=<span class="string">&quot;^.*$&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>然后打开<a target="_blank" rel="noopener" href="http://ip:8005/manager,%E8%BE%93%E5%85%A5%E7%94%A8%E6%88%B7%E5%90%8D%60admin%60%E5%AF%86%E7%A0%81%60idaeadmin%60,%E8%BF%9B%E5%85%A5%E4%B9%8B%E5%90%8E%E4%BF%9D%E7%95%99**manager**%E5%88%A0%E9%99%A4%E5%85%B6%E4%BB%96%E6%89%80%E6%9C%89applications">http://ip:8005/manager,输入用户名`admin`密码`idaeadmin`,进入之后保留**manager**删除其他所有applications</a></p>
</li>
<li><p>修改maven的<code>.m2/setting.xml</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>innerCs<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>ideaadmin<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">servers</span>&gt;</span>    </span><br></pre></td></tr></table></figure>
</li>
<li><p>在项目里面的<code>pom.xml</code>添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>InnerCS<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">...</span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ip:8005/manager/text<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">uriEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">uriEncoding</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">server</span>&gt;</span>innerCs<span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编译<code>Lifecyle-&gt;clean-&gt;install</code>部署<code>lifecyle-&gt;deploy</code>发布到maven私库</p>
</li>
<li><p>远程第一次部署<code>plugins-&gt;tomcat7-&gt;deploy</code>，会上传<code>ROOT.war</code>到<code>/webapps/</code>并解压运行生成<code>ROOT</code>因为我配置的path为<code>/</code>所以是ROOT</p>
</li>
</ol>
<h6 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h6><ol>
<li><p>第九步时，如果时maven多模块项目，需要在父项目，添加上传依赖jar的地址</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置maven地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus Snapshot Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.101.200:8081/repository/maven-snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>还需要在maven的<code>setting.xml</code>配置maven的用户名，才有权限上传</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>多模块项目需要在父级里面进行<code>clean-install-deploy</code>,注意勾选idea maven右侧菜单里面的<code>Profiles</code>，不然父级不知道编译那个子项目</p>
</li>
</ol>
<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><ol>
<li><p>tomcat启动时出现<code>java.lang.IllegalArgumentException: Illegal character(s) in message header field: Pragma:</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: Illegal character(s) in message header field: Pragma:</span><br><span class="line">2019-02-20 17:40:47 331 - 	at sun.net.www.protocol.http.HttpURLConnection.checkMessageHeader(HttpURLConnection.java:511)</span><br><span class="line">2019-02-20 17:40:47 331 - 	at sun.net.www.protocol.http.HttpURLConnection.isExternalMessageHeaderAllowed(HttpURLConnection.java:481)</span><br><span class="line">2019-02-20 17:40:47 331 - 	at sun.net.www.protocol.http.HttpURLConnection.setRequestProperty(HttpURLConnection.java:2895)</span><br><span class="line">2019-02-20 17:40:47 331 - 	at sun.net.www.protocol.https.HttpsURLConnectionImpl.setRequestProperty(HttpsURLConnectionImpl.java:325)</span><br><span class="line">2019-02-20 17:40:47 331 - 	at mmo.common.utils.HttpUtils.sendPost(HttpUtils.java:28)</span><br><span class="line">2019-02-20 17:40:47 331 - 	at com.surelive.app.server.service.QQGroupApiService$1.run(QQGroupApiService.java:169)</span><br><span class="line">2019-02-20 17:40:47 331 - 	at com.surelive.app.server.entities.ext.QueueThreadHandle.run(QueueThreadHandle.java:52)</span><br><span class="line">2019-02-20 17:40:47 331 - 	at com.surelive.app.server.service.QueueThreadPoolServer$1.run(QueueThreadPoolServer.java:26)</span><br><span class="line">2019-02-20 17:40:47 331 - 	at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure>

<p>解决：执行<code>env</code>检查环境变量中是否有<code>JAVA_HOME</code>,没有设置好这些环境变量</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/04/30/linux-tools-on-my-zsh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/04/30/linux-tools-on-my-zsh/" class="post-title-link" itemprop="url">Linux-Tools-on-my-zsh</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-04-30 09:42:41" itemprop="dateCreated datePublished" datetime="2018-04-30T09:42:41+00:00">2018-04-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/2018/04/30/linux-tools-on-my-zsh/" class="post-meta-item leancloud_visitors" data-flag-title="Linux-Tools-on-my-zsh" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ZSH"><a href="#ZSH" class="headerlink" title="ZSH"></a>ZSH</h2><p>zsh (Mac 系统自带，无需安装)。</p>
<p>安装<a target="_blank" rel="noopener" href="http://ohmyz.sh/"><strong>Oh-My-Zsh</strong></a>管理zsh的配置工具 <code>sh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</code></p>
<h3 id="常用功能"><a href="#常用功能" class="headerlink" title="常用功能"></a>常用功能</h3><p>配置文件<code>cat ~/.zshrc</code></p>
<h4 id="命令历史记录功能ctrl-r"><a href="#命令历史记录功能ctrl-r" class="headerlink" title="命令历史记录功能ctrl+r"></a>命令历史记录功能<code>ctrl+r</code></h4><p>历史记录存放在<code>cat ~/.zsh_history</code></p>
<p><code>ctrl+r</code>搜索命令历史记录,<code>!!</code>执行上一条命了</p>
<p>补全<code>TAB</code></p>
<h4 id="命令别名alias"><a href="#命令别名alias" class="headerlink" title="命令别名alias"></a>命令别名<code>alias</code></h4><p>在<code>~/.zshrc</code>中添加<code>alias name=command</code>即可</p>
<p>查看所有命令别名<code>alias</code></p>
<h4 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h4><p>git</p>
<h3 id="iterm2-修改配色"><a href="#iterm2-修改配色" class="headerlink" title="iterm2 修改配色"></a>iterm2 修改<a target="_blank" rel="noopener" href="https://github.com/mbadolato/iTerm2-Color-Schemes">配色</a></h3><h3 id="Solarized-Dark-Higher-Contrast"><a href="#Solarized-Dark-Higher-Contrast" class="headerlink" title="Solarized Dark Higher Contrast"></a>Solarized Dark Higher Contrast</h3><p>在这里找到自己<a target="_blank" rel="noopener" href="https://github.com/mbadolato/iTerm2-Color-Schemes/tree/master/schemes%E5%96%9C%E6%AC%A2%E7%9A%84">https://github.com/mbadolato/iTerm2-Color-Schemes/tree/master/schemes喜欢的</a></p>
<p>然后保存文件，双击安装，然后color-&gt;color下来框选择自己安装的</p>
<h4 id="item2-安装powerlevel9k主题"><a href="#item2-安装powerlevel9k主题" class="headerlink" title="item2 安装powerlevel9k主题"></a>item2 安装<a target="_blank" rel="noopener" href="https://github.com/bhilburn/powerlevel9k">powerlevel9k</a>主题</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/bhilburn/powerlevel9k.git ~/.oh<span class="literal">-my</span><span class="literal">-zsh</span>/custom/themes/powerlevel9k <span class="comment">#下载主题</span></span><br><span class="line">vim ~/.zshrc <span class="comment">#编辑配置文件设置主题ZSH_THEME=&quot;powerlevel9k/powerlevel9k&quot;，去用户名添加 DEFAULT_USER=&quot;your user name&quot;</span></span><br><span class="line">git clone https://github.com/supermarin/powerline<span class="literal">-fonts</span>.git <span class="comment">#下载字体</span></span><br></pre></td></tr></table></figure>

<p>安装字体，双击<code>/Monaco/Monaco for Powerline.otf</code>文件安装字体</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://gist.github.com/qhh0205/5570934d25a627dd9e9629a8ceeb415c">https://gist.github.com/qhh0205/5570934d25a627dd9e9629a8ceeb415c</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/04/28/docker-compose-file/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/04/28/docker-compose-file/" class="post-title-link" itemprop="url">Docker-Compose-file</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-04-28 09:36:44" itemprop="dateCreated datePublished" datetime="2018-04-28T09:36:44+00:00">2018-04-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-09-02 15:28:29" itemprop="dateModified" datetime="2020-09-02T15:28:29+00:00">2020-09-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
    <span id="/2018/04/28/docker-compose-file/" class="post-meta-item leancloud_visitors" data-flag-title="Docker-Compose-file" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Compos-file-版本3以上"><a href="#Compos-file-版本3以上" class="headerlink" title="Compos file 版本3以上"></a>Compos file 版本3以上</h2><p><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#compose-and-docker-compatibility-matrix">Compos file v3官网</a></p>
<h4 id="build"><a href="#build" class="headerlink" title="build"></a><a href="%E5%8D%95%E6%9C%BA%E6%A8%A1%E5%BC%8F">build</a></h4><p>只支持单机运行</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span> <span class="comment">#指明版本3，docker stack需要版本3以上</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">webapp:</span> </span><br><span class="line">    <span class="attr">build:</span>  <span class="comment">#集群部署会忽略构建镜像，stack只支持提前构建好镜像</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">./dir</span> <span class="comment">#构建上下文路径</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile-alternate</span>  <span class="comment">#构建文件</span></span><br><span class="line">      <span class="attr">args:</span>  <span class="comment">#构建参数</span></span><br><span class="line">        <span class="attr">buildno:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="configs-swarm模式"><a href="#configs-swarm模式" class="headerlink" title="configs (swarm模式)"></a><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/swarm/configs/#simple-example-get-started-with-configs">configs</a> (swarm模式)</h4><p>只支持集群模式运行</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:latest</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">my_config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">my_other_config</span></span><br><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">my_config:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">./my_config.txt</span></span><br><span class="line">  <span class="attr">my_other_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="command"><a href="#command" class="headerlink" title="command"></a><a href="">command</a></h4><p>会覆盖dockerfile里面的命令例如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">command:</span> <span class="string">bundle</span> <span class="string">exec</span> <span class="string">thin</span> <span class="string">-p</span> <span class="number">3000</span> <span class="comment">#docker-compose.yml覆盖dockerfile的命令</span></span><br><span class="line"><span class="attr">command:</span> [<span class="string">&quot;bundle&quot;</span>, <span class="string">&quot;exec&quot;</span>, <span class="string">&quot;thin&quot;</span>, <span class="string">&quot;-p&quot;</span>, <span class="string">&quot;3000&quot;</span>] <span class="comment">#dockerfile等效于上面的命令</span></span><br></pre></td></tr></table></figure>

<h4 id="deploy-swarm模式"><a href="#deploy-swarm模式" class="headerlink" title="deploy(swarm模式)"></a>deploy(swarm模式)</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.2&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:alpine</span></span><br><span class="line">    <span class="attr">labels:</span> <span class="comment">#容器上的标签</span></span><br><span class="line">       <span class="attr">com.example.description:</span> <span class="string">&quot; containers 上的标签&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">global</span> <span class="comment">#可选global(全局模式，每台机一个)/replicated(多台)</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">6</span> <span class="comment">#部署的总数量</span></span><br><span class="line">      <span class="attr">update_config:</span></span><br><span class="line">        <span class="attr">parallelism:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">      <span class="attr">endpoint_mode:</span> <span class="string">vip</span>  <span class="comment">#可选vip(默认)/dnsrr，主要是IP啥的</span></span><br><span class="line">      <span class="attr">labels:</span> <span class="comment">#服务器上的标签</span></span><br><span class="line">        <span class="attr">com.example.description:</span> <span class="string">&quot;This label will appear on the web service&quot;</span></span><br><span class="line">      <span class="attr">placement:</span> <span class="comment">#指定部署的信息</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.role</span> <span class="string">==</span> <span class="string">manager</span> <span class="comment">#只在管理节点运行</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">engine.labels.operatingsystem</span> <span class="string">==</span> <span class="string">ubuntu</span> <span class="number">14.04</span></span><br><span class="line">        <span class="attr">preferences:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">spread:</span> <span class="string">node.labels.zone</span></span><br><span class="line">      <span class="attr">resources:</span> <span class="comment">#资源限制</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line"><span class="comment">#cpu个数0.5指一个cpu的50%，2.00指2个cpu（猜测99%）其中docker stats命令可以查看cpu使用率和内存使用，其中cpu使用率是指单核的使用率，也就是如果cpus设置为2，使用率200%就代表2个核都使用达到了100%        </span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&#x27;0.50&#x27;</span>  </span><br><span class="line">          <span class="attr">memory:</span> <span class="string">50M</span></span><br><span class="line">        <span class="attr">reservations:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&#x27;0.25&#x27;</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">20M</span></span><br><span class="line">      <span class="attr">restart_policy:</span> <span class="comment">#重启策略</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">5s</span></span><br><span class="line">        <span class="attr">max_attempts:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">window:</span> <span class="string">120s</span></span><br><span class="line">      <span class="attr">update_config:</span> <span class="comment">#更新配置策略</span></span><br><span class="line">        <span class="attr">parallelism:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">order:</span> <span class="string">stop-first</span></span><br><span class="line">    <span class="attr">depends_on:</span>  <span class="comment">#依赖的服务模块，在db启动才启动服务，但是不能保证db启动完，如果要设置启动顺序见</span></span><br><span class="line">    <span class="comment">#https://docs.docker.com/compose/startup-order/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">healthcheck:</span> <span class="comment">#健康检查</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">1m30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">40s</span></span><br><span class="line">    <span class="attr">logging:</span> <span class="comment">#日志服务</span></span><br><span class="line">      <span class="attr">driver:</span> <span class="string">syslog</span></span><br><span class="line">      <span class="attr">options:</span></span><br><span class="line">        <span class="attr">syslog-address:</span> <span class="string">&quot;tcp://192.168.0.42:123&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment">#自定义挂在卷</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">volume</span></span><br><span class="line">      <span class="attr">source:</span> <span class="string">mydata</span></span><br><span class="line">      <span class="attr">target:</span> <span class="string">/data</span></span><br><span class="line">      <span class="attr">volume:</span></span><br><span class="line">      <span class="attr">nocopy:</span> <span class="literal">true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">bind</span></span><br><span class="line">      <span class="attr">source:</span> <span class="string">./static</span></span><br><span class="line">      <span class="attr">target:</span> <span class="string">/opt/app/static</span></span><br><span class="line">    <span class="attr">ports:</span>  <span class="comment">#自定义端口</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br></pre></td></tr></table></figure>



<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>错误<code>services.nginx.ports.0 must be a string or number</code>是因为自定义端口,只支持3.2以上</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.2&#x27;</span> </span><br><span class="line"> <span class="attr">ports:</span>  <span class="comment">#自定义端口</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">80</span></span><br><span class="line">     <span class="attr">published:</span> <span class="number">8080</span></span><br><span class="line">     <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">     <span class="attr">mode:</span> <span class="string">host</span></span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/04/24/android-webview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/04/24/android-webview/" class="post-title-link" itemprop="url">Android-WebView</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-04-24 13:35:30" itemprop="dateCreated datePublished" datetime="2018-04-24T13:35:30+00:00">2018-04-24</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
    <span id="/2018/04/24/android-webview/" class="post-meta-item leancloud_visitors" data-flag-title="Android-WebView" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>将一个html H5网页打包成一个apk</p>
<ol>
<li><p>在<code>MainActivity</code>初始化一个<code>webview</code>,启用JavaScript脚步，然后设置自定义<code>Webviewclient</code>,接着就是设置些缓存等，这些非必须，最后终哟啊的一个方法就是加载<code>webview.loadUrl</code>这里添加你的h5链接，如果是本地，直接是路径就可以了，最后设置<code>setContentView(webview);</code>,里面还加了<code>webview</code>返回是网页的返回，到返回完了，在返回就是退出应用提示<code>dialog</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> WebView webview;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//实例化WebView对象</span></span><br><span class="line">        webview = <span class="keyword">new</span> WebView(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//设置WebView属性，能够执行Javascript脚本</span></span><br><span class="line">        webview.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//重写WebViewClient</span></span><br><span class="line">        webview.setWebViewClient(<span class="keyword">new</span> WebViewClientDiy(<span class="keyword">this</span>));  </span><br><span class="line">        <span class="comment">//额外的设置，缓存等</span></span><br><span class="line">        webview.setScrollBarStyle(View.SCROLLBARS_INSIDE_OVERLAY);</span><br><span class="line">        webview.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</span><br><span class="line">        webview.getSettings().setDomStorageEnabled(<span class="keyword">true</span>);</span><br><span class="line">        webview.getSettings().setAppCacheMaxSize(<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">8</span>);</span><br><span class="line">        String appCachePath = <span class="keyword">this</span>.getApplicationContext().getCacheDir()</span><br><span class="line">                .getAbsolutePath();</span><br><span class="line">        webview.getSettings().setAppCachePath(appCachePath);</span><br><span class="line">        webview.getSettings().setAllowFileAccess(<span class="keyword">true</span>);</span><br><span class="line">        webview.getSettings().setAppCacheEnabled(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//加载需要显示的网页</span></span><br><span class="line">        <span class="comment">//webview.loadUrl(&quot;file:///android_asset/index.html&quot;);//显示本地网页</span></span><br><span class="line">        webview.loadUrl(<span class="string">&quot;http://dev.clothes.yaokexing.com/mobile/welcome&quot;</span>);<span class="comment">//显示远程网页</span></span><br><span class="line">        <span class="comment">//设置Web视图</span></span><br><span class="line">        setContentView(webview);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//设置回退</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((keyCode == KeyEvent.KEYCODE_BACK) &amp;&amp; webview.canGoBack()) &#123;</span><br><span class="line">            webview.goBack(); <span class="comment">//goBack()表示返回WebView的上一页面</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            AlertDialog exitDialog = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>).create();</span><br><span class="line">            exitDialog.setTitle(<span class="string">&quot;系统提示&quot;</span>);</span><br><span class="line">            exitDialog.setMessage(<span class="string">&quot;你确定要退出吗&quot;</span>);</span><br><span class="line">            exitDialog.setButton(DialogInterface.BUTTON_POSITIVE, <span class="string">&quot;确定&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                    finish();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            exitDialog.setButton(DialogInterface.BUTTON_NEGATIVE, <span class="string">&quot;取消&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;欢迎回来&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//onKeyListener用于设置监听手机back键的操作</span></span><br><span class="line">            exitDialog.setOnKeyListener(<span class="keyword">new</span> DialogInterface.OnKeyListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onKey</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> keyCode, KeyEvent event)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_BACK) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">// false时dialog会消失</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            exitDialog.show();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onKeyDown(keyCode, event);  <span class="comment">//退出程序</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义<code>WebViewClient</code>类,里面主要覆写<code>shouldOverrideUrlLoading</code>这个方法，因存在老版本和新版本，所以把判断是否用webview加载独立方法出来，一些第三方登录需要用系统的浏览器，所以这里就起到作用了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebViewClientDiy</span> <span class="keyword">extends</span> <span class="title">WebViewClient</span> </span>&#123;</span><br><span class="line">    Context context;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebViewClientDiy</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context=context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Uri uri = Uri.parse(url);  <span class="comment">//老版本</span></span><br><span class="line">        <span class="keyword">return</span> handleUri(uri,view);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TargetApi(Build.VERSION_CODES.N)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, WebResourceRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Uri uri = request.getUrl();  <span class="comment">//新版本</span></span><br><span class="line">        <span class="keyword">return</span> handleUri(uri,view);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">handleUri</span><span class="params">(<span class="keyword">final</span> Uri uri,WebView view)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">&quot;测试&quot;</span>, <span class="string">&quot;Uri =&quot;</span> + uri);</span><br><span class="line">        <span class="keyword">if</span> (uri.toString().contains(<span class="string">&quot;weixin://wap/pay?&quot;</span>))&#123;</span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">            intent.setAction(Intent.ACTION_VIEW);</span><br><span class="line">            intent.setData(Uri.parse(uri.toString()));</span><br><span class="line">            context.startActivity(intent);   <span class="comment">//系统默认加载方法</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        view.loadUrl(uri.toString());  <span class="comment">//调用webview的加载方法</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>AndroidMainfest.xml</code>添加网络权限<code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</code>,到此基本就可以用了</p>
</li>
<li><p>现在做一些优化关闭标题栏，修改<code>AndroidMainfest.xml</code>的them为自定义样式<code>android:theme=&quot;@style/AppTheme.NoActionBar&quot;&gt;</code></p>
<p>改样式需要在<code>styles.xml</code>添加如下内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;AppTheme.NoActionBar&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;Theme.AppCompat.Light.DarkActionBar&quot;</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;windowActionBar&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;windowNoTitle&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowFullscreen&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">e想行空</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>




<script>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/mermaid@8.9.1/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  




  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.1.0/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink.listen({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://blog.iexxk.com/page/11/',]
      });
      });
  </script>

<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"Knshftme94xEJM6dEEop4Qnq-gzGzoHsz","appKey":"UpNFcvVri9iYUjDznVdodui4","serverURLs":"https://knshftme.lc-cn-n1-shared.com","placeholder":"Just go go","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":true,"comment_count":true,"recordIP":true,"enableQQ":false,"requiredFields":[]}, {
      el: '#valine-comments',
      path: "/page/11/",
      serverURLs: "https://knshftme.lc-cn-n1-shared.com"
    }));
  }, window.Valine);
});
</script>

</body>
</html>
