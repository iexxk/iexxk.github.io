<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.iexxk.com","root":"/","images":"/images","scheme":"Muse","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="e想天开，天马行空">
<meta property="og:type" content="website">
<meta property="og:title" content="e想行空">
<meta property="og:url" content="https://blog.iexxk.com/page/14/index.html">
<meta property="og:site_name" content="e想行空">
<meta property="og:description" content="e想天开，天马行空">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="e想行空">
<meta property="article:tag" content="exxk,e想行空">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.iexxk.com/page/14/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>e想行空</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">e想行空</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="e想行空"
      src="/uploads/headimg.jpg">
  <p class="site-author-name" itemprop="name">e想行空</p>
  <div class="site-description" itemprop="description">e想天开，天马行空</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">239</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">311</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/iexxk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;iexxk" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:exxk.lx@gmail.com" title="E-Mail → mailto:exxk.lx@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/iexxk" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/04/04/db-redis-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/04/04/db-redis-install/" class="post-title-link" itemprop="url">DB-redis-install</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-04-04 17:02:11" itemprop="dateCreated datePublished" datetime="2018-04-04T17:02:11+00:00">2018-04-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
    </span>

  
    <span id="/2018/04/04/db-redis-install/" class="post-meta-item leancloud_visitors" data-flag-title="DB-redis-install" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="docker-swarm-安装-redis"><a href="#docker-swarm-安装-redis" class="headerlink" title="docker swarm 安装 redis"></a>docker swarm 安装 redis</h2><ol>
<li><p>创建redis挂载目录<code>/dockerdata/v-redis</code></p>
</li>
<li><p>并在该目录<code>vim redis.conf</code>新建配置文件，配置文件添加如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass &lt;登陆密码，最好64位以上&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>vim stack-redis.yml</code>,内容如下</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">14007</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;redis-server /data/redis.conf&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/dockerdata/v-redis:/data&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.hostname</span> <span class="string">==</span> <span class="string">xuanps</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行启动<code>docker stack deploy -c stack-redis.yml redis</code></p>
</li>
<li><p>测试命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#本地直接redis-cli不需要任何参数</span></span><br><span class="line">redis-cli -h host -p port -a password</span><br><span class="line"><span class="comment">#进入redis，用改名了进行密码登陆</span></span><br><span class="line">AUTH <span class="string">&quot;password&quot;</span></span><br><span class="line"><span class="comment">#查询所有key</span></span><br><span class="line">keys *</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="springboot-连接redis"><a href="#springboot-连接redis" class="headerlink" title="springboot 连接redis"></a>springboot 连接redis</h2><ol>
<li><p>添加<code>pom.xml</code>依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>application.yml</code>添加redis连接信息</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">112.74</span><span class="number">.51</span><span class="number">.136</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">14007</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&lt;你的密码&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testredis</span><span class="params">()</span></span>&#123;</span><br><span class="line">	stringRedisTemplate.opsForValue().set(<span class="string">&quot;testconnect&quot;</span>,<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">	String test= stringRedisTemplate.opsForValue().get(<span class="string">&quot;testconnect&quot;</span>);</span><br><span class="line">	log.info(test);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h4 id="idea-redis插件iedis"><a href="#idea-redis插件iedis" class="headerlink" title="idea redis插件iedis"></a>idea redis插件iedis</h4>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/03/30/javaee-sb-security-cors/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/03/30/javaee-sb-security-cors/" class="post-title-link" itemprop="url">Spring Boot Security cors跨域解决</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-30 15:42:12" itemprop="dateCreated datePublished" datetime="2018-03-30T15:42:12+00:00">2018-03-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-03-06 20:14:34" itemprop="dateModified" datetime="2019-03-06T20:14:34+00:00">2019-03-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaEE/" itemprop="url" rel="index"><span itemprop="name">JavaEE</span></a>
        </span>
    </span>

  
    <span id="/2018/03/30/javaee-sb-security-cors/" class="post-meta-item leancloud_visitors" data-flag-title="Spring Boot Security cors跨域解决" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="springboot-security解决cors"><a href="#springboot-security解决cors" class="headerlink" title="springboot security解决cors"></a>springboot security解决cors</h3><p>添加配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>WebSecurityConfig extends WebSecurityConfigurerAdapter</code>类里面添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">CorsConfigurationSource <span class="title">corsConfigurationSource</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    CorsConfiguration configuration = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">    configuration.setAllowedOrigins(Arrays.asList(<span class="string">&quot;https://example.com&quot;</span>));</span><br><span class="line">    configuration.setAllowedMethods(Arrays.asList(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;POST&quot;</span>));</span><br><span class="line">    UrlBasedCorsConfigurationSource source = <span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">    source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, configuration);</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.cors().and()....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="tomcat配置cors（废弃）"><a href="#tomcat配置cors（废弃）" class="headerlink" title="tomcat配置cors（废弃）"></a>tomcat配置cors（废弃）</h3><p><a target="_blank" rel="noopener" href="https://tomcat.apache.org/tomcat-8.5-doc/config/filter.html#CORS_Filter">官网</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/data/tomcat/bin/catalina.sh version</span><br><span class="line">&gt;Using CATALINA_HOME:   /data/tomcat/</span><br><span class="line">vim /data/tomcat/conf/web.xml</span><br></pre></td></tr></table></figure>

<p>添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CorsFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.catalina.filters.CorsFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.allowed.origins<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 如果设置*，cors.support.credentials不能设置true不然会启动报错 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--设置成前端的访问地址例如 访问http://192.168.101.210:8006,这里就可以设置成该地址 --&gt;</span>      </span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.allowed.methods<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>GET,POST,HEAD,OPTIONS,PUT<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.allowed.headers<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>Content-Type,X-Requested-With,accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.exposed.headers<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>Access-Control-Allow-Origin,Access-Control-Allow-Credentials<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.support.credentials<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.preflight.maxage<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CorsFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>err:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at &#x27;http:<span class="comment">//192.168.101.210:8005/fun/login.do?loginName=admin&amp;pwd=a123456&amp;yzm=2giu&amp;userType=1&#x27; from origin &#x27;http://127.0.0.1:32768&#x27; has been blocked by CORS policy: No &#x27;Access-Control-Allow-Origin&#x27; header is present on the requested resource.</span></span><br></pre></td></tr></table></figure>

<p>其中<code>from origin</code>后面的地址设置到<code>cors.allowed.origins</code>,多个地址<code>,</code>分割</p>
<p>问题：这个经测试，发现option一直提示跨域</p>
<h3 id="filter解决跨域"><a href="#filter解决跨域" class="headerlink" title="filter解决跨域"></a>filter解决跨域</h3><p>新建一个<code>CorsFilter</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxx.controller.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line"></span><br><span class="line">        String currentOrigin = request.getHeader(<span class="string">&quot;Origin&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, currentOrigin);   <span class="comment">//  允许所有域名的请求</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;GET, POST, PUT, DELETE, OPTIONS, HEAD&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>,</span><br><span class="line">                <span class="string">&quot;User-Agent,Origin,Cache-Control,Content-type,Date,Server,withCredentials,AccessToken&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="string">&quot;CUSTOMSESSIONID&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Request-Headers&quot;</span>, <span class="string">&quot;CUSTOMSESSIONID&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Max-Age&quot;</span>, <span class="string">&quot;3600&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;x-auth-token,Origin,Access-Token,X-Requested-With,Content-Type,Accept&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (request.getMethod().equals(<span class="string">&quot;OPTIONS&quot;</span>)) &#123;</span><br><span class="line">            response.setStatus(<span class="number">200</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        chain.doFilter(req, res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在<code>src\main\webapp\WEB-INF\web.xml</code>里配置,配成第一个过滤器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>corsFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.xxx.controller.innercs.filter.CorsFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>corsFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个和tomcat不能同时配置，会导致同时设置两个跨域地址</p>
<h3 id="跨域测试"><a href="#跨域测试" class="headerlink" title="跨域测试"></a>跨域测试</h3><p>chrome console输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://192.168.1.230:14083/app/geography/painting/&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>

<p>在network查看结果</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/fAIl6IYugLb2p6E-4oBJTQ">九种跨域方式实现原理</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/03/29/javaee-springboot-thymeleaf-layui/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/03/29/javaee-springboot-thymeleaf-layui/" class="post-title-link" itemprop="url">JavaEE-SpringBoot-thymeleaf-layui</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-29 09:04:55" itemprop="dateCreated datePublished" datetime="2018-03-29T09:04:55+00:00">2018-03-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaEE/" itemprop="url" rel="index"><span itemprop="name">JavaEE</span></a>
        </span>
    </span>

  
    <span id="/2018/03/29/javaee-springboot-thymeleaf-layui/" class="post-meta-item leancloud_visitors" data-flag-title="JavaEE-SpringBoot-thymeleaf-layui" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="SpringBoot-thymelef的使用以及模版"><a href="#SpringBoot-thymelef的使用以及模版" class="headerlink" title="SpringBoot thymelef的使用以及模版"></a>SpringBoot thymelef的使用以及模版</h3><p>thymelef模版配置,可以不用配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">cache:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">classpath:/templates/</span></span><br><span class="line">    <span class="attr">check-template-location:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">.html</span></span><br><span class="line">    <span class="attr">encoding:</span> <span class="string">UTF-8</span></span><br><span class="line">    <span class="attr">content-type:</span> <span class="string">text/html</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">HTML5</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>thymelef添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>resource/templates</code>添加网页</p>
<p><code>$&#123;error&#125;</code>接收参数，<code>th:action=&quot;@&#123;/userLogin&#125;&quot;</code>表单提交地址</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;error&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-danger&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;error&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">class</span>=<span class="string">&quot;layui-form&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/userLogin&#125;&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">lay-verify</span>=<span class="string">&quot;required&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span> <span class="attr">id</span>=<span class="string">&quot;login&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加<code>controller</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginControl</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(Model model)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;error&quot;</span>,<span class="string">&quot;跳转而已&quot;</span>);  <span class="comment">//设置往网页传参数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>; <span class="comment">//跳转login.html,并接受上面的参数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/userLogin&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">userLogin</span><span class="params">(User user, Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;出现异常&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>; <span class="comment">//更新网页返回值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="layui前端样式模版"><a href="#layui前端样式模版" class="headerlink" title="layui前端样式模版"></a>layui前端样式模版</h4><p>直接复制到<code>resource/static</code>资源目录即可</p>
<ol>
<li><p>layui简单的post请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;layui-btn&quot;</span>  <span class="attr">lay-submit</span>=<span class="string">&quot;&quot;</span> <span class="attr">lay-filter</span>=<span class="string">&quot;addsort&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        layui.use([<span class="string">&#x27;layer&#x27;</span>, <span class="string">&#x27;form&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> layer = layui.layer <span class="comment">//引用layer模块</span></span></span><br><span class="line"><span class="javascript">                , form = layui.form;<span class="comment">//引用form模块</span></span></span><br><span class="line"><span class="javascript">            form.on(<span class="string">&#x27;submit(addsort)&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123; <span class="comment">//addsort监听提交按钮</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(data.elem) <span class="comment">//被执行事件的元素DOM对象，一般为button对象</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(data.form) <span class="comment">//被执行提交的form对象，一般在存在form标签时才会返回</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(data.field) <span class="comment">//当前容器的全部表单字段，名值对形式：&#123;name: value&#125;</span></span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                    url: <span class="string">&#x27;/img/addSort&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                    dataType: <span class="string">&#x27;json&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                    contentType: <span class="string">&#x27;application/json&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                    data: <span class="built_in">JSON</span>.stringify(data.field),</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                       <span class="built_in">console</span>.log(result);</span></span><br><span class="line">                        if (result.code==200)&#123;</span><br><span class="line"><span class="javascript">                            layer.msg(<span class="string">&#x27;添加成功&#x27;</span>);</span></span><br><span class="line"><span class="javascript">                        &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line">                            layer.msg(result.msg);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//阻止表单跳转。如果需要表单跳转，去掉这段即可。</span></span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>表单数据加载</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/feedback&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">feedback</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;feedBacks&quot;</span>,feedBacks);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;feedback&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;layui-table&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;feedBack:$&#123;feedBacks&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;feedBack.feedbackid&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;feedBack.user.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>含文件图片的表单混合一起提交,原理首先使用layui绑定按钮提交</p>
<p>上传图片按钮设置不自动<code>  auto: false</code>提交，然后存到文件里，然后表单提交的时候触发图片上传，以及绑定表单参数,设计时最好避免一起提交，设计可以先传好图片，然后填图片地址，分两次请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> uploadInst;</span><br><span class="line">    <span class="keyword">var</span> pathObj; <span class="comment">//存文件</span></span><br><span class="line">    layui.use([<span class="string">&#x27;layer&#x27;</span>, <span class="string">&#x27;form&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> layer = layui.layer</span><br><span class="line">            , form = layui.form;</span><br><span class="line">        form.on(<span class="string">&#x27;submit(addpaper)&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (pathObj == <span class="literal">undefined</span>) &#123;</span><br><span class="line">                layer.msg(<span class="string">&quot;没有选择壁纸&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> sortid= $(<span class="string">&quot;select option:checked&quot;</span>).attr(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="comment">//选了文件直接改参数上传</span></span><br><span class="line">            uploadInst.config.data = &#123;</span><br><span class="line">                paperdetail:data.field.paperdetail,</span><br><span class="line">                sortid:sortid,</span><br><span class="line">                papername:data.field.papername</span><br><span class="line">            &#125;;</span><br><span class="line">            uploadInst.config.auto = <span class="literal">true</span>;</span><br><span class="line">            uploadInst.upload();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">//阻止表单跳转。如果需要表单跳转，去掉这段即可。</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    layui.use([<span class="string">&#x27;layer&#x27;</span>, <span class="string">&#x27;upload&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> layer = layui.layer</span><br><span class="line">            , upload = layui.upload;</span><br><span class="line">        <span class="comment">//普通图片上传</span></span><br><span class="line">        uploadInst = upload.render(&#123;</span><br><span class="line">            elem: <span class="string">&#x27;#post-photo&#x27;</span></span><br><span class="line">            , <span class="attr">url</span>: <span class="string">&#x27;/img/uploadpaper&#x27;</span></span><br><span class="line">            , <span class="attr">auto</span>: <span class="literal">false</span></span><br><span class="line">            , <span class="attr">before</span>: <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">                <span class="comment">//预读本地文件示例，不支持ie8</span></span><br><span class="line">                obj.preview(<span class="function"><span class="keyword">function</span> (<span class="params">index, file, result</span>) </span>&#123;</span><br><span class="line">                    $(<span class="string">&#x27;#demo1&#x27;</span>).attr(<span class="string">&#x27;src&#x27;</span>, result); <span class="comment">//图片链接（base64）</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            choose: <span class="function"><span class="keyword">function</span> (<span class="params">object</span>) </span>&#123;</span><br><span class="line">                pathObj = object;</span><br><span class="line">            &#125;</span><br><span class="line">            , <span class="attr">done</span>: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (res.code == <span class="number">200</span>) &#123;</span><br><span class="line">                    layer.msg(<span class="string">&quot;添加壁纸成功&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    layer.msg(<span class="string">&quot;添加壁纸失败：&quot;</span> + res.msg);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//上传成功</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/uploadpaper&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Msg <span class="title">singleFileUpload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file, <span class="meta">@RequestParam(&quot;sortid&quot;)</span> <span class="keyword">int</span> sortid, <span class="meta">@RequestParam(&quot;paperdetail&quot;)</span> String paperdetail, <span class="meta">@RequestParam(&quot;papername&quot;)</span> String papername)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; urls = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ResultUtil.error(-<span class="number">300</span>, <span class="string">&quot;上传文件为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Paper paper = <span class="keyword">new</span> Paper();</span><br><span class="line">    paper.setSortid(sortid);</span><br><span class="line">    paper.setPapername(papername);</span><br><span class="line">    paper.setPaperdetail(paperdetail);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Files.write(Paths.get(uploadPath + file.getOriginalFilename()), file.getBytes());</span><br><span class="line">        paper.setPaperurl(imgUrl + file.getOriginalFilename());</span><br><span class="line">        paperMapper.insertPaper(paper);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> ResultUtil.error(-<span class="number">301</span>, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResultUtil.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>动态读取下拉框</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;sortid&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sortid&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:each</span>=<span class="string">&quot;arrayS:$&#123;sorts&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;arrayS.sortname&#125;&quot;</span> <span class="attr">th:id</span>=<span class="string">&quot;$&#123;arrayS.sortid&#125;&quot;</span>&gt;</span>默认选项<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/addwallpaper&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addwallpaper</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">    List&lt;Sort&gt; sorts;</span><br><span class="line">    sorts = paperMapper.selectSort();</span><br><span class="line">    model.addAttribute(<span class="string">&quot;sorts&quot;</span>,sorts);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;addwallpaper&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/03/28/springboot-base/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/03/28/springboot-base/" class="post-title-link" itemprop="url">SpringBoot-base</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-28 18:51:50" itemprop="dateCreated datePublished" datetime="2018-03-28T18:51:50+00:00">2018-03-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
    <span id="/2018/03/28/springboot-base/" class="post-meta-item leancloud_visitors" data-flag-title="SpringBoot-base" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="springboot-基础"><a href="#springboot-基础" class="headerlink" title="springboot 基础"></a>springboot 基础</h2><h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p><code>@CrossOrigin</code> 跨域处理</p>
<h3 id="json处理"><a href="#json处理" class="headerlink" title="json处理"></a>json处理</h3><p>springboot集成<code>jackson</code>工具</p>
<p>简单使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//忽略编译该参数为json    </span></span><br><span class="line"><span class="meta">@JsonIgnore</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//bean to json</span></span><br><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">User user=<span class="keyword">new</span> User();</span><br><span class="line">String jsonstr=mapper.writeValueAsString(user);</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span> <span class="comment">//返回实体类自动转json</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserControl</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;register&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Msg <span class="title">userReg</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123; <span class="comment">//@RequestBody 请求参数为json自动转换实体类</span></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/03/28/springboot-vue-springsecurity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/03/28/springboot-vue-springsecurity/" class="post-title-link" itemprop="url">SpringBoot前后端分离架构</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-28 10:32:34" itemprop="dateCreated datePublished" datetime="2018-03-28T10:32:34+00:00">2018-03-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
    <span id="/2018/03/28/springboot-vue-springsecurity/" class="post-meta-item leancloud_visitors" data-flag-title="SpringBoot前后端分离架构" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="架构模型（Spring-boot-vue-Spring-Security）"><a href="#架构模型（Spring-boot-vue-Spring-Security）" class="headerlink" title="架构模型（Spring boot+vue+Spring Security）"></a>架构模型（<strong>Spring boot+vue+Spring Security</strong>）</h3><h4 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a><a target="_blank" rel="noopener" href="https://vincentmi.gitbooks.io/spring-security-reference-zh/content/1_introduction.html">SpringSecurity</a></h4><p>是一个安全认证权限控制等spring框架依赖注入原理(ioc)</p>
<h5 id="简单用于登陆校验"><a href="#简单用于登陆校验" class="headerlink" title="简单用于登陆校验"></a>简单用于登陆校验</h5><ol>
<li><p>添加maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="2">
<li><p>新建<code>User</code>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">UserDetails</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> userid;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">//get,set省略</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">//改为true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">//改为true，不然账号是锁定的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">//改为true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">//改为true，不然账号是禁用的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建<code>UserMapper</code>接口连接数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from user where username=#&#123;username&#125;&quot;)</span></span><br><span class="line">    <span class="function">User <span class="title">loadUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建<code>UserService</code>用户服务,注意实现<code>UserDetailsService</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        User user = userMapper.loadUserByUsername(s);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">&quot;用户名不对&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建<code>UserUtil</code>工具类用户获取登陆后的用户信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">getCurrentHr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (User) SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最重要的一步继承该类<code>WebSecurityConfigurerAdapter</code>，并配置,添加注解标明是配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//解决静态资源被拦截的问题，下面的忽略拦截，下面的路径不会走安全验证</span></span><br><span class="line">        web.ignoring().antMatchers(<span class="string">&quot;/index.html&quot;</span>, <span class="string">&quot;/static/**&quot;</span>, <span class="string">&quot;/login_p&quot;</span>,<span class="string">&quot;/user/register&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.userDetailsService(userService).passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder());<span class="comment">//配置用户登陆服务，并配置密码加密方式，这里可以自定义加密方式</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/admin/**&quot;</span>)..hasRole(<span class="string">&quot;超级管理员&quot;</span>)<span class="comment">//改地址需要超管</span></span><br><span class="line">            .anyRequest().authenticated()<span class="comment">//其他地址的访问均需验证权限</span></span><br><span class="line">            .and().formLogin()</span><br><span class="line">            .loginPage(<span class="string">&quot;/login_p&quot;</span>)<span class="comment">//指定登录页是&quot;/login_p&quot;，输入其他地址会替跳转到该页面</span></span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">            .usernameParameter(<span class="string">&quot;username&quot;</span>).passwordParameter(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">            .permitAll() <span class="comment">//指定登陆接口，只能用表单，如果要json请求要添加过滤器</span></span><br><span class="line">            .failureHandler(<span class="keyword">new</span> AuthenticationFailureHandler()) <span class="comment">//登陆失败回调</span></span><br><span class="line">            .successHandler(<span class="keyword">new</span> AuthenticationSuccessHandler()) <span class="comment">//登陆成功回调</span></span><br><span class="line">            .and().logout().permitAll()</span><br><span class="line">            .and().csrf().disable(); <span class="comment">//解决非thymeleaf的form表单提交被拦截问题</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>登陆成功会自动有cookie返回，清除cookie然后测试都成功了</p>
</li>
</ol>
<h5 id="角色权限控制"><a href="#角色权限控制" class="headerlink" title="角色权限控制"></a>角色权限控制</h5><p>这里简单实用，没有添加角色表，user表机构</p>
<table>
<thead>
<tr>
<th>username</th>
<th>password</th>
<th>role</th>
</tr>
</thead>
<tbody><tr>
<td>admin</td>
<td>***</td>
<td>admin</td>
</tr>
<tr>
<td>zhangsan</td>
<td>***</td>
<td>user</td>
</tr>
</tbody></table>
<ol start="8">
<li><p>在用户实体类重写<code>getAuthorities</code>该方法，该方法读取用户角色并存储返回到角色数组，如果是分表，role可以存储多个依次添加即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">    List&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">     	<span class="comment">//“ROLE_”由于数据库未添加，所以这里手动添加</span></span><br><span class="line">        authorities.add(<span class="keyword">new</span> SimpleGrantedAuthority(<span class="string">&quot;ROLE_&quot;</span> + role));</span><br><span class="line">    <span class="keyword">return</span> authorities;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后在配置里添加,意思是<code>antMatchers</code>里的地址只能是<code>admin</code>角色返回</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/flower/imgUpload&quot;</span>, <span class="string">&quot;/flower/ddClass&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>) <span class="comment">//这两个地址需要管理员角色</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>现在已经能控制角色权限了，但是权限不足返回不友好，这里设置权限不足，返回提示信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.exceptionHandling().accessDeniedHandler(<span class="keyword">new</span> AccessDeniedHandler() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;权限不足&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="菜单角色管理"><a href="#菜单角色管理" class="headerlink" title="菜单角色管理"></a>菜单角色管理</h5><p>主要方法是设置过滤器</p>
<ol start="11">
<li><p>在配置文件添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.withObjectPostProcessor(<span class="keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="function">O <span class="title">postProcess</span><span class="params">(O o)</span> </span>&#123;</span><br><span class="line">   	o.setSecurityMetadataSource(urlFilterInvocationSecurityMetadataSource);</span><br><span class="line">       o.setAccessDecisionManager(urlAccessDecisionManager);</span><br><span class="line">       <span class="keyword">return</span> o;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加<code>urlFilterInvocationSecurityMetadataSource</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UrlFilterInvocationSecurityMetadataSource</span> <span class="keyword">implements</span> <span class="title">FilterInvocationSecurityMetadataSource</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MenuService menuService;</span><br><span class="line">    AntPathMatcher antPathMatcher = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title">getAttributes</span><span class="params">(Object o)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        <span class="comment">//获取请求地址</span></span><br><span class="line">        String requestUrl = ((FilterInvocation) o).getRequestUrl();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;/login_p&quot;</span>.equals(requestUrl)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Menu&gt; allMenu = menuService.getAllMenu();</span><br><span class="line">        <span class="keyword">for</span> (Menu menu : allMenu) &#123;</span><br><span class="line">            <span class="keyword">if</span> (antPathMatcher.match(menu.getUrl(), requestUrl)&amp;&amp;menu.getRoles().size()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                List&lt;Role&gt; roles = menu.getRoles();</span><br><span class="line">                <span class="keyword">int</span> size = roles.size();</span><br><span class="line">                String[] values = <span class="keyword">new</span> String[size];</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                    values[i] = roles.get(i).getName();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> SecurityConfig.createList(values);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//没有匹配上的资源，都是登录访问</span></span><br><span class="line">        <span class="keyword">return</span> SecurityConfig.createList(<span class="string">&quot;ROLE_LOGIN&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title">getAllConfigAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; aClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> FilterInvocation.class.isAssignableFrom(aClass);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加<code>urlAccessDecisionManager</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UrlAccessDecisionManager</span> <span class="keyword">implements</span> <span class="title">AccessDecisionManager</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">decide</span><span class="params">(Authentication authentication, Object o, Collection&lt;ConfigAttribute&gt; collection)</span> <span class="keyword">throws</span> AccessDeniedException, AuthenticationException </span>&#123;</span><br><span class="line">        Iterator&lt;ConfigAttribute&gt; iterator = collection.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            ConfigAttribute ca = iterator.next();</span><br><span class="line">            <span class="comment">//当前请求需要的权限</span></span><br><span class="line">            String needRole = ca.getAttribute();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;ROLE_LOGIN&quot;</span>.equals(needRole)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (authentication <span class="keyword">instanceof</span> AnonymousAuthenticationToken) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(<span class="string">&quot;未登录&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//当前用户所具有的权限</span></span><br><span class="line">            Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();</span><br><span class="line">            <span class="keyword">for</span> (GrantedAuthority authority : authorities) &#123;</span><br><span class="line">                <span class="keyword">if</span> (authority.getAuthority().equals(needRole)) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AccessDeniedException(<span class="string">&quot;权限不足!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(ConfigAttribute configAttribute)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; aClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
</ol>
<h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><ol>
<li><p>输出错误<code>User account is locked</code>。</p>
<p>解决：用户类设置返回true，原因自带安全机制，如果需要实现登陆错误次数，此处根据逻辑修改，并在user表添加该字段，通过数据库记录设置是否锁定。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"> public boolean isAccountNonLocked() &#123;</span><br><span class="line">     return true;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>错误<code>No AuthenticationProvider found for org.springframework.security.authentication.UsernamePasswordAuthenticationToken</code></p>
<p>解决:<code>WebSecurityConfigurerAdapter</code>没有配置注册userService，而且必须对密码加密，这里必须设置加密方式，可以<code>new PasswordEncoder</code>实现自定加密</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">auth.userDetailsService(userService).passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>错误<code>Encoded password does not look like BCrypt</code>原因不识别数据库密码，有可能密码字段太短，或者被截断，另一种就是通过网页手动加密，复制进数据库也有可能不识别，解决通过代码加密插入解决</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BCryptPasswordEncoder encoder = <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">String encode = encoder.encode(user.getPassword());</span><br></pre></td></tr></table></figure>

<p>​</p>
</li>
</ol>
<h5 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h5><p><a target="_blank" rel="noopener" href="https://github.com/lenve/vhr">lenve/vhr</a></p>
<h6 id="详情"><a href="#详情" class="headerlink" title="详情"></a>详情</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/flower/imgUpload&quot;</span>, <span class="string">&quot;/flower/ddClass&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>) <span class="comment">//这两个地址需要管理员角色</span></span><br><span class="line">                <span class="comment">//其他地址的访问均需验证权限</span></span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and().formLogin()</span><br><span class="line">                <span class="comment">//指定登录页是&quot;/login&quot;</span></span><br><span class="line">                .loginPage(<span class="string">&quot;/login_p&quot;</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>).usernameParameter(<span class="string">&quot;username&quot;</span>).passwordParameter(<span class="string">&quot;password&quot;</span>).permitAll()</span><br><span class="line">                .failureHandler(<span class="keyword">new</span> AuthenticationFailureHandler() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationFailure</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                        log.info(<span class="string">&quot;登陆失败&quot;</span>);</span><br><span class="line">                        httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                        PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">                        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">                        String jsonResult;</span><br><span class="line">                        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> UsernameNotFoundException )&#123;</span><br><span class="line">                            jsonResult=e.getMessage();</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>( e <span class="keyword">instanceof</span> BadCredentialsException) &#123;</span><br><span class="line">                            jsonResult=<span class="string">&quot;密码输入错误，登录失败!&quot;</span>;</span><br><span class="line">                        &#125;  <span class="keyword">else</span> &#123;</span><br><span class="line">                            jsonResult=<span class="string">&quot;登录失败!&quot;</span>;</span><br><span class="line">                            log.error(e.getMessage());</span><br><span class="line">                        &#125;</span><br><span class="line">                        jsonResult=mapper.writeValueAsString(ResultUtil.error(-<span class="number">201</span>,jsonResult));</span><br><span class="line">                        out.write(jsonResult);</span><br><span class="line">                        out.flush();</span><br><span class="line">                        out.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).successHandler(<span class="keyword">new</span> AuthenticationSuccessHandler() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                        log.info(<span class="string">&quot;登陆成功&quot;</span>);</span><br><span class="line">                        httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                        PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">                        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">                        String jsonResult=mapper.writeValueAsString(ResultUtil.success(UserUtils.getCurrentHr()));</span><br><span class="line">                        out.write(jsonResult);</span><br><span class="line">                        out.flush();</span><br><span class="line">                        out.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .and().logout().permitAll()</span><br><span class="line">                .and().csrf().disable() <span class="comment">//解决非thymeleaf的form表单提交被拦截问题</span></span><br><span class="line">                .exceptionHandling().accessDeniedHandler(<span class="keyword">new</span> AccessDeniedHandler() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                        log.info(<span class="string">&quot;登陆失败&quot;</span>);</span><br><span class="line">                        httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                        PrintWriter out = httpServletResponse.getWriter();</span><br><span class="line">                        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">                        String jsonResult;</span><br><span class="line">                        jsonResult=<span class="string">&quot;权限不足&quot;</span>;</span><br><span class="line">                        jsonResult=mapper.writeValueAsString(ResultUtil.error(-<span class="number">201</span>,jsonResult));</span><br><span class="line">                        out.write(jsonResult);</span><br><span class="line">                        out.flush();</span><br><span class="line">                        out.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/03/22/tools-k2-breed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/03/22/tools-k2-breed/" class="post-title-link" itemprop="url">Tools-k2-breed</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-22 23:15:32" itemprop="dateCreated datePublished" datetime="2018-03-22T23:15:32+00:00">2018-03-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-09-09 17:00:37" itemprop="dateModified" datetime="2020-09-09T17:00:37+00:00">2020-09-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
    <span id="/2018/03/22/tools-k2-breed/" class="post-meta-item leancloud_visitors" data-flag-title="Tools-k2-breed" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="斐讯K2-22-4-6-3-非telnet-页面直刷-Breed-详细方法（图文）"><a href="#斐讯K2-22-4-6-3-非telnet-页面直刷-Breed-详细方法（图文）" class="headerlink" title="斐讯K2 22.4.6.3 非telnet 页面直刷 Breed 详细方法（图文）"></a><a target="_blank" rel="noopener" href="http://www.right.com.cn/forum/forum.php?mod=viewthread&tid=204435&highlight=k2%252B22.4.6.3">斐讯K2 22.4.6.3 非telnet 页面直刷 Breed 详细方法（图文）</a></h4><ol>
<li><p>用网线连接电脑和路由器的lan口</p>
</li>
<li><p>保持路由器与internet的连通(桥接，有线都可以)</p>
</li>
<li><p>进入k2管理页面（p.to）</p>
</li>
<li><p>进入网页调试模式(chrome按F12)，找到定时重启下拉05分的标签</p>
</li>
<li><p>在05的标签右键编辑</p>
</li>
<li><p>将“05”修改成为“05 | wget <a target="_blank" rel="noopener" href="http://breed.hackpascal.net/breed-mt7620-phicomm-psg1208.bin%E2%80%9D%E4%B9%8B%E5%90%8E%EF%BC%8C%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8%E5%88%B0%E9%BB%91%E6%A1%86%E5%A4%96%E7%9A%84%E7%A9%BA%E7%99%BD%E5%A4%84%E7%82%B9%E5%87%BB%E9%BC%A0%E6%A0%87%E5%B7%A6%E9%94%AE%EF%BC%8C%E7%BB%93%E6%9D%9F%E7%BC%96%E8%BE%91%E3%80%82">http://breed.hackpascal.net/breed-mt7620-phicomm-psg1208.bin”之后，鼠标移动到黑框外的空白处点击鼠标左键，结束编辑。</a></p>
</li>
<li><p>回到页面重新选择05，05后面多了刚刚加的，然后保存。</p>
</li>
<li><p>继续将“05”修改成“05 | mtd unlock Bootloader”，然后回到页面选择05保存。</p>
</li>
<li><p>继续将“05”修改成“05 | mtd -r write breed-mt7620-phicomm-psg1208.bin Bootloader”，然后回到页面选择05保存，等待重启，如果未重启代表失败。</p>
</li>
<li><p>拔除K2上Wan口的网线，路由器断电，持续按住路由器上的reset按钮，接通路由器电源，3秒后松开reset按钮。</p>
</li>
<li><p>在浏览器地址栏输入“<a target="_blank" rel="noopener" href="http://192.168.1.1”访问breed/">http://192.168.1.1”访问Breed</a> Web。</p>
<h4 id="注意：下次刷机只需进入brend-，步骤为"><a href="#注意：下次刷机只需进入brend-，步骤为" class="headerlink" title="注意：下次刷机只需进入brend ，步骤为"></a>注意：下次刷机只需进入brend ，步骤为</h4><ol>
<li>路由器断电，持续按住路由器上的reset按钮，接通路由器电源，3秒后松开reset按钮。</li>
<li>在浏览器地址栏输入“<a target="_blank" rel="noopener" href="http://192.168.1.1”访问breed/">http://192.168.1.1”访问Breed</a> Web。</li>
</ol>
<p>[RT-AC54U-GPIO-1-PSG1218-64M_3.4.3.9-099.trx](F:\xuan install.Back\K2.Back)  访问ip:<a target="_blank" rel="noopener" href="http://192.168.123.1/">http://192.168.123.1/</a> 管理账号：admin/admin wifi密码:1234567890</p>
<p>高级设置-外部网络-外网连接类型pppoe拨号，用户名密码输入宽带账号密码，闪讯拨号插件选择重庆，其他默认，然后应用本页设置<br>高级设置-系统管理-ntp服务器 分别填入红岩网校的ntp服务器202.202.43.120 202.202.43.131 手动设置时间 应用本页设置<br>网络地图-点击地球的图标-重新连接 应该可以上网了</p>
<p>参考<a target="_blank" rel="noopener" href="http://www.tieba.com/p/5015549863">http://www.tieba.com/p/5015549863</a></p>
</li>
</ol>
<h6 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h6><p><a target="_blank" rel="noopener" href="http://www.right.com.cn/forum/thread-208753-1-1.html">斐讯K2 V22.5.9.163官方固件定制版,集成breed,支持官版直刷【V1.4】</a></p>
<p>直接手动升级<code>k2_163_v14_breed.bin</code>然后进入breed</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/03/22/springboot-properties-and-configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/03/22/springboot-properties-and-configuration/" class="post-title-link" itemprop="url">Springboot配置文件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-22 13:07:49" itemprop="dateCreated datePublished" datetime="2018-03-22T13:07:49+00:00">2018-03-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
    <span id="/2018/03/22/springboot-properties-and-configuration/" class="post-meta-item leancloud_visitors" data-flag-title="Springboot配置文件" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>配置文件路径<code>resuources\application.properties</code>或者<code>resuources\application.yml</code>二者存一</p>
<ol>
<li><p><code>application.properties</code>与<code>application.yml</code>区别</p>
<p>一个是树形目录，一个是单行配置。eg：<code>server.port=8080</code>等效于</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置环境变量</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">diy:</span></span><br><span class="line">  <span class="attr">parmars:</span> <span class="string">hello</span></span><br><span class="line"><span class="comment">#配置文件引用say=hello</span></span><br><span class="line"><span class="attr">say:</span> <span class="string">$&#123;diy.parmars&#125;</span></span><br></pre></td></tr></table></figure>

<p>代码里面引用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;diy.parmars&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String imgUrl;​</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h4 id="常见配置"><a href="#常见配置" class="headerlink" title="常见配置"></a>常见配置</h4><ol>
<li><p>数据库连接配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">     <span class="attr">url:</span> <span class="string">jdbc:mysql://10.14.0.1:3306/sqlname?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">     <span class="attr">username:</span> <span class="string">xxx</span></span><br><span class="line">     <span class="attr">password:</span> <span class="string">xxxx</span></span><br><span class="line">     <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>springboot访问端口配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>静态文件路径映射配置,如果配置了<code>spring.resources.static-location</code>会覆盖原来默认的静态文件设置<code>classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/</code>，<code>file</code>路径指本地磁盘路径，window/Mac/linux的真实目录路径，例如window为<code>C:\\windos\\</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">     <span class="attr">static-locations:</span> <span class="string">&lt;原来的静态文件配置&gt;,file:/Users/xuanleung/Pictures/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>文件上传大小限制(-1不限制)（128KB）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="number">-1</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<h4 id="application-yml与bootstrap-yml区别"><a href="#application-yml与bootstrap-yml区别" class="headerlink" title="application.yml与bootstrap.yml区别"></a><code>application.yml</code>与<code>bootstrap.yml</code>区别</h4><p>加载顺序<code>bootstrap.yml </code>-&gt;<code>bootstrap-xxx.yml</code>-&gt;<code>application.yml</code>-&gt;<code>application-xxx.yml</code></p>
<p>注意：多个配置文件，相同替换，不同并集</p>
<p><code>bootstrap.yml</code>常用于一些系统级别参数，不被更改</p>
<p><code>application.yml</code> 应用级别，可以被更改，通过config service服务</p>
<p><code>bootstrap.yml</code>常用于应用程序引导阶段例如</p>
<ul>
<li>spring config server配置</li>
<li>application.name配置</li>
</ul>
<p>使用config server时，<code>bootstrap.yml</code>常用配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-a</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://127.0.0.1:8888</span></span><br><span class="line">      <span class="attr">fail-fast:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">$&#123;CONFIG_SERVER_PASSWORD:password&#125;</span></span><br><span class="line">      <span class="attr">retry:</span></span><br><span class="line">        <span class="attr">initial-interval:</span> <span class="number">2000</span></span><br><span class="line">        <span class="attr">max-interval:</span> <span class="number">10000</span></span><br><span class="line">        <span class="attr">multiplier:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">max-attempts:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>在不考虑加载顺序，两个配置是可以通用的</p>
<h3 id="多环境配置"><a href="#多环境配置" class="headerlink" title="多环境配置"></a>多环境配置</h3><p>可以在配置文件(application/bootstrap)名后加上dev、test等后缀以<code>-</code>分开。使用环境时加上参数<code>--spring.profiles.active=peer1</code>即可</p>
<p>eg: 新建个<code>application-xxx.yml</code>，运行时执行<code>java -jar app.jar --spring.profiles.active=xxx</code></p>
<p><strong>注意</strong>：</p>
<p>这里如果存在多个环境配置文件，且有<code>application/bootstrap</code>没有后缀的原文件时会优先加载它，然后再用指定环境的配置覆盖没有后缀的，这样就会导致，如果没有后缀的文件指定了某个配置，但是有后缀的却没有设置改配置，覆盖的情况，就是取并集，导致某些设置不生效。</p>
<h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><ol>
<li><p>springboot存储中文到mysql数据库乱码</p>
<p>解决：在配置文件连接数据库地方添加<code>url: jdbc:mysql://&lt;ip&gt;:&lt;端口&gt;/&lt;数据库名字&gt;?useUnicode=true&amp;characterEncoding=utf-8</code></p>
</li>
<li><p><code>application.yml</code>添加注释报错，提示找不到<code>Failed to load property source from location &#39;classpath:/application.yml&#39;</code></p>
<p>解决：检查文件编码格式，不是<code>utf-8</code>修改为<code>utf-8</code></p>
</li>
<li><p>eureka高可用时 提示不可用<code>unavailable-replicas </code>，原因是存在<code>application.yml</code>,且里面设置了</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>  <span class="comment">#Eureka默认也会作为客户端尝试注册，因此需禁用注册行为</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>然后<code>application-peer.yml</code>并没有设置改属性，取并集之后导致，禁止注册了</p>
<p>解决：</p>
<ol>
<li><p>修改<code>application-peer.yml</code>里的属性,并设置为<code>true</code>(未测试)</p>
</li>
<li><p>删除或重命名<code>application-peer.yml</code>(采用)</p>
</li>
<li><p>在<code>application-peer.yml</code>覆写配置，并设置为<code>true</code>（测试，能注册，但是还是<code>unavailable-replicas</code>）</p>
<p>解决：检查是否<code>application.name</code>是否设置了不一样的值，一定要设置一样的名字</p>
</li>
</ol>
</li>
</ol>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/zsl129/article/details/52906762">Springboot 之 静态资源路径配置</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012470019/article/details/77973156">spring cloud unavailable-replicas</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/03/12/docker-volume-use/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/03/12/docker-volume-use/" class="post-title-link" itemprop="url">docker-volume-use</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-12 10:58:46" itemprop="dateCreated datePublished" datetime="2018-03-12T10:58:46+00:00">2018-03-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-04-18 17:21:52" itemprop="dateModified" datetime="2019-04-18T17:21:52+00:00">2019-04-18</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
    <span id="/2018/03/12/docker-volume-use/" class="post-meta-item leancloud_visitors" data-flag-title="docker-volume-use" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="docker-挂载卷应用"><a href="#docker-挂载卷应用" class="headerlink" title="docker 挂载卷应用"></a>docker 挂载卷应用</h2><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><blockquote>
<p>官网说明<a target="_blank" rel="noopener" href="https://docs.docker.com/storage/bind-mounts/">Use bind mounts</a></p>
<p>官网compose文件：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">Compose file version 3 reference</a></p>
</blockquote>
<p>bind 挂载，就是宿主机路径对应容器路径，该挂载需要先创建目录，简称<code>/path:/path</code></p>
<p>volume挂载，不需要提前创建目录，他是以volume形式，简称<code>volume-name:/path</code></p>
<p>其中<code>z</code>和<code>Z</code>的使用,eg:<code>/path:/path:z</code></p>
<p><code>z</code>小写的是可以容器共享</p>
<p><code>Z</code>大写的是私有，容器不可共享</p>
<p><code>ro</code>只读挂载</p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>利用gluterfs作为分布式文件系统做同步用，利用虚拟机挂载一个volume专门的存储硬盘</p>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><h5 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l <span class="comment">#查看磁盘</span></span><br><span class="line"><span class="comment">#mount [-参数] [设备名称] [挂载点]</span></span><br><span class="line">mount /dev/sdb /mnt/<span class="built_in">test</span></span><br><span class="line"><span class="comment">#umount [设备名称或挂载点]</span></span><br><span class="line">umount mnt/<span class="built_in">test</span></span><br><span class="line"><span class="comment">#gluster卷状态[status\start\stop\delete]</span></span><br><span class="line">gluster volume status v-portainer</span><br><span class="line"><span class="comment">#节点添加与删除[probe\detach]</span></span><br><span class="line">gluster peer detach home</span><br><span class="line"><span class="comment">#节点连接状态，没有卷的情况容易端口连接，删除添加节点可解决</span></span><br><span class="line">gluster peer status</span><br></pre></td></tr></table></figure>

<h5 id="单步步骤"><a href="#单步步骤" class="headerlink" title="单步步骤"></a>单步步骤</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mkdir /dockerdata <span class="comment">#创建数据存储盘</span></span><br><span class="line"><span class="comment">#虚拟机挂载该磁盘，作为存储，因为阿里云没有多余磁盘，所有不挂载，直接存到/dockerdata</span></span><br><span class="line">mount /dev/sdb /dockerdata </span><br><span class="line">df -h <span class="comment">#查看是否挂载成功</span></span><br><span class="line"><span class="comment">#设置开机自动挂在该目录</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;dev/sdb /dockerdata ext4 defaults 0 0&quot;</span>&gt;&gt;/etc/fstab</span><br><span class="line">mkdir /dockerdata/v-portainer</span><br><span class="line"><span class="comment">#创建分布式存储卷，force忽略在root目录创建挂在卷的警告</span></span><br><span class="line">gluster volume create v-portainer replica 2 home:/dockerdata/v-portainer xuanps:/dockerdata/v-portainer force</span><br><span class="line"><span class="comment">#启动分布式存储卷</span></span><br><span class="line">gluster volume start v-portainer</span><br><span class="line"><span class="comment">#创建挂载目录</span></span><br><span class="line">mkdir /volume/v-portainer</span><br><span class="line"><span class="comment">#挂载存储卷目录，似乎挂载才会同步</span></span><br><span class="line">mount -t glusterfs home:/v-portainer /volume/v-portainer</span><br><span class="line"><span class="comment">#设置开机挂载,两台单独设置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;home:/v-portainer /volume/v-portainer glusterfs defaults 0 1&quot;</span> &gt;&gt; /etc/fstab</span><br><span class="line"><span class="comment">#部署应用</span></span><br><span class="line">docker stack deploy -c docker-compose.yml gitlab</span><br></pre></td></tr></table></figure>

<h5 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h5><ol>
<li>使用之后，存储数据受网络印象，导致部分应用因为长时间连接不上而导致，不能启动，因此搁置</li>
<li>如果出现节点disconnect，在disconnect节点执行<code>systemctl restart glusterd</code>重启</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/03/07/linux-install-glusterfs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/03/07/linux-install-glusterfs/" class="post-title-link" itemprop="url">centos7 安装 GlusterFS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-07 15:45:22" itemprop="dateCreated datePublished" datetime="2018-03-07T15:45:22+00:00">2018-03-07</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span id="/2018/03/07/linux-install-glusterfs/" class="post-meta-item leancloud_visitors" data-flag-title="centos7 安装 GlusterFS" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>**<a target="_blank" rel="noopener" href="https://www.gluster.org/">Gluster</a>**是一个大尺度文件系统。</p>
<h5 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h5><h6 id="简单卷"><a href="#简单卷" class="headerlink" title="简单卷"></a>简单卷</h6><ol>
<li>distribute volume 分布式卷，两台主机的磁盘融合一个磁盘</li>
<li>stripe volume 条带卷，一个文件分成数据块存储到不同的地方</li>
<li>replica volume 复制卷，一个文件分别保存到两台主机</li>
</ol>
<h6 id="复合卷"><a href="#复合卷" class="headerlink" title="复合卷"></a>复合卷</h6><p>1+2，1+3，2+3，1+2+3</p>
<h4 id="总结常用命令"><a href="#总结常用命令" class="headerlink" title="总结常用命令"></a>总结常用命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">gluster peer status     <span class="comment">#查看集群各主机连接状态</span></span><br><span class="line">gluster volume list    <span class="comment">#查看挂载卷信息</span></span><br><span class="line">gluster volume list <span class="comment">#查看卷列表</span></span><br><span class="line"><span class="comment">#创建挂在卷，force忽略在root目录创建挂在卷的警告</span></span><br><span class="line">gluster volume create swarm-volume replica 3 worker:/xuan/docker/gluster-volume home:/xuan/docker/gluster-volume xuanps:/xuan/docker/gluster-volume force</span><br><span class="line">gluster volume start swarm-volume <span class="comment">#启动</span></span><br><span class="line">gluster volume stop swarm-volume <span class="comment">#停止</span></span><br><span class="line">gluster volume delete swarm-volume <span class="comment">#删除 ，了文件还会保留</span></span><br><span class="line"><span class="comment">#挂载本地目录到glusterfs卷（swarm-volume），在本地目录添加的会自动同步到其他挂载卷</span></span><br><span class="line"><span class="comment">#eg在本机mnt添加文件，其他volume-name目录也会添加mount [-参数] [设备名称] [挂载点]</span></span><br><span class="line">mount -t glusterfs worker:/swarm-volume /mnt/</span><br><span class="line">umount worker:/swarm-volume  <span class="comment">#卸载了就不会同步了</span></span><br><span class="line"><span class="comment">#重置，删除所有数据</span></span><br><span class="line">systemctl stop glusterd</span><br><span class="line">rm -rf /var/lib/glusterd/</span><br><span class="line">systemctl start glusterd</span><br><span class="line"><span class="comment">#删除节点</span></span><br><span class="line">gluster peer detach home</span><br></pre></td></tr></table></figure>

<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>准备工作：</p>
<p>三台局域网主机（<a target="_blank" rel="noopener" href="http://jingyan.baidu.com/article/29697b915a5376ab20de3cc2.html">centos7 修改主机名 </a>）</p>
<table>
<thead>
<tr>
<th>hostname</th>
<th>ip</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>xuanps</td>
<td>10.14.0.1</td>
<td></td>
</tr>
<tr>
<td>worker</td>
<td>10.14.0.4</td>
<td></td>
</tr>
<tr>
<td>home</td>
<td>10.14.0.5</td>
<td></td>
</tr>
</tbody></table>
<p>三台都需要安装GlusterFS</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#搜索glusterfs可安装的版本</span></span><br><span class="line">yum search centos-release-gluster</span><br><span class="line"><span class="comment">#安装最新长期稳定版本(Long Term Stable)的gluster软件</span></span><br><span class="line">yum -y install centos-release-gluster</span><br><span class="line"><span class="comment">#安装glusterfs-server</span></span><br><span class="line">yum --enablerepo=centos-gluster*-<span class="built_in">test</span> install glusterfs-server</span><br><span class="line">glusterfs -V <span class="comment">#测试</span></span><br><span class="line">systemctl <span class="built_in">enable</span> glusterd <span class="comment">#开机启动</span></span><br><span class="line">systemctl start glusterd <span class="comment">#启动</span></span><br><span class="line">systemctl status glusterd <span class="comment">#查看是否正常运行</span></span><br><span class="line"><span class="comment">#修改hosts不然不能通过主机名连接到对方</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line"><span class="comment">#----------三台都要添加如下设置--------------------------</span></span><br><span class="line">10.14.0.1 xuanps</span><br><span class="line">10.14.0.4 worker</span><br><span class="line">10.14.0.5 home</span><br><span class="line"><span class="comment">#------------------------------------------------------</span></span><br><span class="line"><span class="comment">#从xuanps上执行下面两条，其他主机不用执行</span></span><br><span class="line">gluster peer probe worker</span><br><span class="line">gluster peer probe home</span><br><span class="line"><span class="comment">#三台都执行该命令是否都是connected</span></span><br><span class="line">gluster peer status</span><br><span class="line"><span class="comment">#查看挂载卷信息</span></span><br><span class="line">gluster volume info</span><br><span class="line"><span class="comment">#创建挂在卷，force忽略在root目录创建挂在卷的警告</span></span><br><span class="line">gluster volume create volume-name replica 3 worker:/xuan/docker/gluster-volume/<span class="built_in">test</span> home:/xuan/docker/gluster-volume/<span class="built_in">test</span> xuanps:/xuan/docker/gluster-volume/<span class="built_in">test</span> force</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">gluster volume start volume-name</span><br><span class="line"><span class="comment">#启动nfs同步，测试需验证，这里要不要开启</span></span><br><span class="line">gluster volume <span class="built_in">set</span> volume-name nfs.disable off</span><br><span class="line"><span class="comment">#挂载本地目录到glusterfs卷（volume-name），在本地目录添加的会自动同步到其他挂载卷</span></span><br><span class="line"><span class="comment">#eg在本机mnt添加文件，其他volume-name目录也会添加</span></span><br><span class="line">mount -t glusterfs worker:/volume-name /mnt/</span><br></pre></td></tr></table></figure>

<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p>官网：<a target="_blank" rel="noopener" href="https://www.gluster.org/">https://www.gluster.org/</a></p>
<p><a target="_blank" rel="noopener" href="http://docs.gluster.org/en/latest/Quick-Start-Guide/Quickstart/">文档</a></p>
<p><a target="_blank" rel="noopener" href="https://wiki.centos.org/SpecialInterestGroup/Storage/gluster-Quickstart">centos官方安装手册</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/opensource/os-cn-glusterfs-docker-volume/index.html">基于 GlusterFS 实现 Docker 集群的分布式存储</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2018/03/04/docker-volume-plugin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/03/04/docker-volume-plugin/" class="post-title-link" itemprop="url">Docker-volume-plugin</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-04 22:30:39" itemprop="dateCreated datePublished" datetime="2018-03-04T22:30:39+00:00">2018-03-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-12 10:47:58" itemprop="dateModified" datetime="2018-12-12T10:47:58+00:00">2018-12-12</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
    <span id="/2018/03/04/docker-volume-plugin/" class="post-meta-item leancloud_visitors" data-flag-title="Docker-volume-plugin" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="docker-安装docker-volume-glusterfs"><a href="#docker-安装docker-volume-glusterfs" class="headerlink" title="docker 安装docker-volume-glusterfs"></a>docker 安装docker-volume-glusterfs</h2><p>前提，首先安装好GlusterFS分布式文件系统，可以参考<a href="">centos7 安装 GlusterFS</a></p>
<h4 id="sapk-docker-volume-gluster安装-弃"><a href="#sapk-docker-volume-gluster安装-弃" class="headerlink" title="sapk/docker-volume-gluster安装(弃)"></a><a target="_blank" rel="noopener" href="https://github.com/sapk/docker-volume-gluster">sapk/docker-volume-gluster</a>安装(弃)</h4><p>不足：无法删除volume，且无法复用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装插件，三台主机都安装（保险起见）</span></span><br><span class="line">docker plugin install sapk/plugin-gluster</span><br><span class="line"><span class="comment"># docker volume create --driver sapk/plugin-gluster --opt voluri=&quot;&lt;volumeserver&gt;,&lt;otherserver&gt;,&lt;otheroptionalserver&gt;:&lt;volumename&gt;&quot; --name test</span></span><br><span class="line"><span class="comment">#volumeserver 主机名，可以指定多个，volumenam是 GlusterFS文件系统的挂载劵名，test是swarm挂载卷名</span></span><br><span class="line">docker volume create --driver sapk/plugin-gluster --opt voluri=<span class="string">&quot;worker,home,xuanps:swarm-volume&quot;</span> --name <span class="built_in">test</span></span><br><span class="line"><span class="comment">#运行ubuntu容器进行测试</span></span><br><span class="line">docker run -v <span class="built_in">test</span>:/mnt --rm -ti ubuntu</span><br><span class="line"><span class="comment">#进去之后创建文件，其他系统盘也能看到该文件了， 但是其他系统不会创建挂载卷</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span>&gt;/mnt/testfile</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>docker-compose 使用</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes</span>:<span class="string"></span></span><br><span class="line">  <span class="attr">some_vol</span>:<span class="string"></span></span><br><span class="line">    <span class="attr">driver</span>: <span class="string">sapk/plugin-gluster</span></span><br><span class="line">    <span class="attr">driver_opts</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">voluri</span>: <span class="string">&quot;&lt;volumeserver&gt;:&lt;volumename&gt;&quot;</span></span><br></pre></td></tr></table></figure>



<h4 id="calavera-docker-volume-glusterfs官方安装（-废弃-测试时发现运行找不到插件，太老了，换新插件）"><a href="#calavera-docker-volume-glusterfs官方安装（-废弃-测试时发现运行找不到插件，太老了，换新插件）" class="headerlink" title="calavera/docker-volume-glusterfs官方安装（**废弃**   测试时发现运行找不到插件，太老了，换新插件）"></a><a target="_blank" rel="noopener" href="https://github.com/calavera/docker-volume-glusterfs">calavera/docker-volume-glusterfs</a>官方安装（**<em>废弃**</em>   测试时发现运行找不到插件，太老了，换新插件）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#---------------------------废弃，网络原因下载不下来--------------------------------</span></span><br><span class="line"><span class="comment">#为了环境干净，安装docker golang容器工具（--rm参数，运行后销毁容器）</span></span><br><span class="line">docker run -v /tmp/bin:/go/bin \</span><br><span class="line">--rm golang go get github.com/golang/example/hello/...</span><br><span class="line"><span class="comment">#测试，执行该命令会输出Hello, Go examples!，如果没输出，说明容器环境和主机环境不一致</span></span><br><span class="line">/tmp/bin/hello</span><br><span class="line"><span class="comment">#----------------准备工作完成正式开始安装---------------------------------------------------------</span></span><br><span class="line"><span class="comment">#通过golang容器工具下载插件，下载到/tmp/bin目录</span></span><br><span class="line">docker run -v /tmp/bin:/go/bin --rm golang go get github.com/calavera/docker-volume-glusterfs</span><br></pre></td></tr></table></figure>

<p>手动去<a target="_blank" rel="noopener" href="https://github.com/calavera/docker-volume-glusterfs/releases">下载</a>,通过sftp等工具传到服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mv docker-volume-glusterfs_linux_amd64 docker-volume-glusterfs   <span class="comment">#重命名</span></span><br><span class="line">cp ./docker-volume-glusterfs /usr/bin <span class="comment">#放到bin目录</span></span><br><span class="line">chmod 777 /usr/bin/docker-volume-glusterfs <span class="comment">#添加权限</span></span><br><span class="line"><span class="comment">#其他两台主机，然后复制到其他服务器上</span></span><br><span class="line">scp root@10.14.0.1:~/docker-volume-glusterfs ~</span><br><span class="line"><span class="comment">#依次放到bin目录添加权限</span></span><br><span class="line">cp ~/docker-volume-glusterfs /usr/bin </span><br><span class="line">chmod 777 /usr/bin/docker-volume-glusterfs</span><br><span class="line"><span class="comment"># 三台主机都执行该命令，该命令会前端运行</span></span><br><span class="line">docker-volume-glusterfs -servers xuanps:worker:home</span><br><span class="line"><span class="comment"># 测试使用</span></span><br><span class="line">sudo docker run --volume-driver glusterfs --volume swarm-volume:/data alpine ash</span><br><span class="line">touch /data/helo</span><br></pre></td></tr></table></figure>

<h3 id="额外的-docker-卷插件"><a href="#额外的-docker-卷插件" class="headerlink" title="额外的 docker 卷插件"></a>额外的 docker 卷插件</h3><p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/extend/legacy_plugins/#volume-plugins">官方插件列表</a></p>
<p><a target="_blank" rel="noopener" href="https://store.docker.com/search?category=volume&q=&type=plugin">官方插件商店</a></p>
<h4 id="rancher-convoy"><a href="#rancher-convoy" class="headerlink" title="rancher/convoy"></a><a target="_blank" rel="noopener" href="https://github.com/rancher/convoy">rancher/convoy</a></h4><p>主要功能快照、备份、还原</p>
<p>总结：适用于单节点，单主机，的本地卷管理</p>
<h4 id="calavera-docker-volume-glusterfs"><a href="#calavera-docker-volume-glusterfs" class="headerlink" title="calavera/docker-volume-glusterfs"></a><a target="_blank" rel="noopener" href="https://github.com/calavera/docker-volume-glusterfs">calavera/<strong>docker-volume-glusterfs</strong></a></h4><p>看<a href="">centos7 安装 GlusterFS</a></p>
<h4 id="Pure-Storage-Docker-Volume-Plugin"><a href="#Pure-Storage-Docker-Volume-Plugin" class="headerlink" title="Pure Storage Docker Volume Plugin"></a><a target="_blank" rel="noopener" href="https://store.docker.com/plugins/pure-docker-volume-plugin?tab=description">Pure Storage Docker Volume Plugin</a></h4><h4 id="Hedvig-Docker-Volume-Plugin"><a href="#Hedvig-Docker-Volume-Plugin" class="headerlink" title="Hedvig Docker Volume Plugin"></a><a target="_blank" rel="noopener" href="https://store.docker.com/plugins/hedvig-docker-volume-plugin">Hedvig Docker Volume Plugin</a></h4><p>依赖于hedvig cluster</p>
<h4 id="REX-Ray"><a href="#REX-Ray" class="headerlink" title="REX-Ray"></a><a target="_blank" rel="noopener" href="https://rexray.readthedocs.io/en/stable/user-guide/schedulers/docker/plug-ins/">REX-Ray</a></h4><p>github: <a target="_blank" rel="noopener" href="https://github.com/rexray/rexray">rexray/rexray</a></p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/community/blogs/132cfa78-44b0-4376-85d0-d3096cd30d3f/entry/Swarm_%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE_%E6%AF%8F%E5%A4%A95%E5%88%86%E9%92%9F%E7%8E%A9%E8%BD%AC_Docker_%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF_103?lang=en">每天5分钟玩转 OpenStack <strong>Rex-Ray</strong></a></p>
<p>………..居然没找到一个合适的提供者</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rexray/csi-nfs">rexray/cis-nfs</a>  待测试，NFS似乎不满足需求</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/225444">Docker与Golang的巧妙结合</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/opensource/os-cn-glusterfs-docker-volume/index.html">基于 GlusterFS 实现 Docker 集群的分布式存储</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/13/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/15/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">e想行空</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>




<script>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/mermaid@8.9.1/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  




  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.1.0/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink.listen({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://blog.iexxk.com/page/14/',]
      });
      });
  </script>

<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"Knshftme94xEJM6dEEop4Qnq-gzGzoHsz","appKey":"UpNFcvVri9iYUjDznVdodui4","serverURLs":"https://knshftme.lc-cn-n1-shared.com","placeholder":"Just go go","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":true,"comment_count":true,"recordIP":true,"enableQQ":false,"requiredFields":[]}, {
      el: '#valine-comments',
      path: "/page/14/",
      serverURLs: "https://knshftme.lc-cn-n1-shared.com"
    }));
  }, window.Valine);
});
</script>

</body>
</html>
