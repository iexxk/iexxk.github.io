<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.iexxk.com","root":"/","images":"/images","scheme":"Muse","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="e想天开，天马行空">
<meta property="og:type" content="website">
<meta property="og:title" content="e想行空">
<meta property="og:url" content="https://blog.iexxk.com/page/2/index.html">
<meta property="og:site_name" content="e想行空">
<meta property="og:description" content="e想天开，天马行空">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="e想行空">
<meta property="article:tag" content="exxk,e想行空">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.iexxk.com/page/2/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>e想行空</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">e想行空</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="e想行空"
      src="/uploads/headimg.jpg">
  <p class="site-author-name" itemprop="name">e想行空</p>
  <div class="site-description" itemprop="description">e想天开，天马行空</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">239</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">311</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/iexxk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;iexxk" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:exxk.lx@gmail.com" title="E-Mail → mailto:exxk.lx@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/iexxk" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/11/30/docker-leaning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/11/30/docker-leaning/" class="post-title-link" itemprop="url">docker入门学习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-30 10:44:15" itemprop="dateCreated datePublished" datetime="2020-11-30T10:44:15+00:00">2020-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-05 16:35:36" itemprop="dateModified" datetime="2021-03-05T16:35:36+00:00">2021-03-05</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
    <span id="/2020/11/30/docker-leaning/" class="post-meta-item leancloud_visitors" data-flag-title="docker入门学习" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="docker-名词解释"><a href="#docker-名词解释" class="headerlink" title="docker 名词解释"></a>docker 名词解释</h1><p>下面简单解释下名词的含义，后面会详细介绍：</p>
<ul>
<li>docker：docker代表这一个技术的名词，下面<strong>一个docker</strong>代表一台机器上装的一个docker服务</li>
<li>container：docker容器，相当于一个轻量的沙盒系统（可以暂时理解一个运行好的虚拟机系统）一个容器只运行一个服务</li>
<li>images：docker镜像，相当于一个安装包（可以暂时理解成一个系统iso镜像）</li>
<li>service：docker服务，多个相同的容器组成的一个服务，相当于容器的多个复制，提高了扩展性</li>
<li>swarm：docker集群，将一个docker或多个docker组成的一个资源集合，包含了网络、负载均衡、多个服务节点、服务发现、服务伸缩</li>
<li>node：docker节点，一台实际机器上的一个docker算一个节点，节点只有在docker初始化为集群才存在该概念</li>
<li>docker-compose.yml：服务编排脚本，该脚本只支持单机docker服务编排，相当于服务的启动参数，服务数量都在该脚本配置</li>
<li>stack：docker集群服务编排模式,stack.yml为集群部署模式的配置文件，文件name可以自定义，这个是多节点服务编排部署模式，在单机的基础上面多支持了容器在那个节点运行，及运行个数等</li>
<li>DockerFile：docker镜像编排脚本</li>
<li><a target="_blank" rel="noopener" href="https://hub.docker.com/search?q=&type=image">Docker-hub</a>：官方docker仓库</li>
<li>registry：可搭建的私有镜像仓库</li>
<li>集群-无状态服务vs有状态服务(共享存储/NAS)</li>
<li>分布式集群</li>
</ul>
<p>docker swarm服务关系</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6VVz11"><img src="https://s3.ax1x.com/2021/03/04/6VVz11.png" alt="6VVz11.png"></a></p>
<p>docker编排部署流程</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6VZP0O"><img src="https://s3.ax1x.com/2021/03/04/6VZP0O.png" alt="6VZP0O.png"></a></p>
<h1 id="docker简介"><a href="#docker简介" class="headerlink" title="docker简介"></a><a target="_blank" rel="noopener" href="https://www.docker.com/resources/what-container">docker简介</a></h1><p>容器是打包代码及其所有依赖项的软件的标准单元，因此应用程序可以从一个计算环境快速可靠地运行到另一个计算环境。Docker容器映像是一个轻量级的，独立的，可执行的软件软件包，其中包含运行应用程序所需的一切：代码，运行时，系统工具，系统库和设置。</p>
<h4 id="优势："><a href="#优势：" class="headerlink" title="优势："></a>优势：</h4><ul>
<li><strong>标准：</strong> Docker创建了容器的行业标准，因此它们可以在任何地方移植</li>
<li><strong>轻巧：</strong>容器共享计算机的OS系统内核，因此不需要每个应用程序都具有OS，从而提高了服务器效率，并降低了服务器和许可成本</li>
<li><strong>安全：</strong>容器中的应用程序更安全，Docker提供业界最强大的默认隔离功能</li>
</ul>
<h4 id="虚机vs容器"><a href="#虚机vs容器" class="headerlink" title="虚机vs容器"></a>虚机vs容器</h4><p>容器虚化的是操作系统而不是硬件，容器更加便携和高效</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6VJ3LQ"><img src="https://s3.ax1x.com/2021/03/04/6VJ3LQ.png" alt="6VJ3LQ.png"></a></p>
<h1 id="docker安装部署"><a href="#docker安装部署" class="headerlink" title="docker安装部署"></a><a href="https://blog.iexxk.com/2017/10/10/docker-install-base/?highlight=docker">docker安装部署</a></h1><h4 id="centos安装"><a href="#centos安装" class="headerlink" title="centos安装"></a><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">centos安装</a></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">systemctl start docker.service</span><br><span class="line"><span class="comment"># 开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<h4 id="docker-swarm-初始化"><a href="#docker-swarm-初始化" class="headerlink" title="docker swarm 初始化"></a><a href="https://blog.iexxk.com/2017/09/14/docker-install-swarm/?highlight=docker+swarm">docker swarm 初始化</a></h4><h1 id="DockerFile镜像编排"><a href="#DockerFile镜像编排" class="headerlink" title="DockerFile镜像编排"></a><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">DockerFile镜像编排</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 镜像编排命令</span></span><br><span class="line">docker build -t image-name:tag .</span><br></pre></td></tr></table></figure>

<p>dockerfile常见命令说明</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#基础镜像选择alpine 小巧安全流行方便</span></span><br><span class="line"><span class="keyword">FROM</span> exxk/tomcat:<span class="number">8</span>-alpine-cst-font</span><br><span class="line"><span class="comment">#指定用户</span></span><br><span class="line"><span class="keyword">USER</span> patrick</span><br><span class="line"><span class="comment">#指定工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /path/to/workdir</span></span><br><span class="line"><span class="comment">#编译时的环境参数</span></span><br><span class="line"><span class="keyword">ARG</span> DOCKER_MACHINE_VERSION</span><br><span class="line"><span class="comment">#暴露的端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/udp</span><br><span class="line"><span class="comment">#拷贝文件到镜像的指定目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> geoserver /usr/<span class="built_in">local</span>/tomcat/webapps/geoserver</span></span><br><span class="line"><span class="comment">#拷贝文件，但是add功能比copy多，压缩文件会自动解压，不建议用高级的add</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> geoserver /usr/<span class="built_in">local</span>/tomcat/webapps/geoserver</span></span><br><span class="line"><span class="comment">#设置环境变量，启动时可以通过参数进行覆盖</span></span><br><span class="line"><span class="keyword">ENV</span> GEOSERVER_HOME=/usr/local/tomcat/webapps/geoserver/data</span><br><span class="line"><span class="comment">#运行编译时的命令</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /usr/bin/gitlab-runner</span></span><br><span class="line"><span class="comment">#健康检查/类似心跳，前面命令执行的时间，cmd后面为心跳检测的命令</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="bash"> --interval=5m --timeout=3s CMD curl -f http://localhost/ || <span class="built_in">exit</span> 1</span></span><br><span class="line"><span class="comment">#设置挂在卷</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/etc/gitlab-runner&quot;</span>, <span class="string">&quot;/home/gitlab-runner&quot;</span>]</span></span><br><span class="line"><span class="comment">#启动时容器时，初始化容器的命令脚本</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/usr/bin/dumb-init&quot;</span>, <span class="string">&quot;/entrypoint&quot;</span>]</span></span><br><span class="line"><span class="comment">#入口启动命令</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker-hub-和-registry"><a href="#Docker-hub-和-registry" class="headerlink" title="Docker-hub 和 registry"></a><a target="_blank" rel="noopener" href="https://hub.docker.com/?ref=login">Docker-hub</a> 和 <a href="https://blog.iexxk.com/2018/01/24/docker-install-registry/?highlight=regis">registry</a></h2><h1 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a><a href="https://blog.iexxk.com/2018/04/28/docker-compose-file/?highlight=compose">docker-compose</a></h1><p><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">官方文档</a></p>
<h1 id="docker-swarm-VS-k8s-Kubernetes"><a href="#docker-swarm-VS-k8s-Kubernetes" class="headerlink" title="docker swarm VS k8s(Kubernetes)"></a><a href="https://blog.iexxk.com/2017/09/14/docker-install-swarm/?highlight=swarm">docker swarm</a> VS k8s(Kubernetes)</h1><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6eAkhd"><img src="https://s3.ax1x.com/2021/03/05/6eAkhd.jpg" alt="6eAkhd.jpg"></a></p>
<h2 id="平台安装部署流程"><a href="#平台安装部署流程" class="headerlink" title="平台安装部署流程"></a>平台安装部署流程</h2><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6e1abd"><img src="https://s3.ax1x.com/2021/03/05/6e1abd.png" alt="6e1abd.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6e1UDH"><img src="https://s3.ax1x.com/2021/03/05/6e1UDH.png" alt="6e1UDH.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6e1NKe"><img src="https://s3.ax1x.com/2021/03/05/6e1NKe.png" alt="6e1NKe.png"></a></p>
<h2 id="springboot和docker-环境变量"><a href="#springboot和docker-环境变量" class="headerlink" title="springboot和docker 环境变量"></a>springboot和docker 环境变量</h2><p>springboot 支持系统环境变量<br>docker 支持容器环境变量设置</p>
<p>设计原理，不改变基础镜像的情况下，适应不同的环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">优先级由高到低</span><br><span class="line">1	启动命令中指定的配置项；</span><br><span class="line">2	操作系统配置项；</span><br><span class="line">3	环境变量</span><br><span class="line">4	配置中心中的配置文件；</span><br><span class="line">5	本地的application.properties(yml)</span><br><span class="line">5	本地boostrap.properties（yml）</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/6eGvIs"><img src="https://s3.ax1x.com/2021/03/05/6eGvIs.png" alt="6eGvIs.png"></a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/09/24/python-base/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/24/python-base/" class="post-title-link" itemprop="url">python-base</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-09-24 14:12:20" itemprop="dateCreated datePublished" datetime="2020-09-24T14:12:20+00:00">2020-09-24</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-03-02 17:33:04" itemprop="dateModified" datetime="2021-03-02T17:33:04+00:00">2021-03-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
    <span id="/2020/09/24/python-base/" class="post-meta-item leancloud_visitors" data-flag-title="python-base" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="python-pip-国内仓库代理"><a href="#python-pip-国内仓库代理" class="headerlink" title="python pip 国内仓库代理"></a>python pip 国内仓库代理</h2><p>在改配置文件 <code>vim ~/.pip/pip.conf</code>添加如下内容，没有该文件创建该文件及目录</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[global]</span></span><br><span class="line"><span class="meta">index-url</span> = <span class="string">https://mirrors.aliyun.com/pypi/simple/</span></span><br><span class="line"><span class="attr">[install]</span></span><br><span class="line"><span class="meta">trusted-host</span> = <span class="string">mirrors.aliyun.com</span></span><br></pre></td></tr></table></figure>

<h2 id="python-版本切换工具-pyenv"><a href="#python-版本切换工具-pyenv" class="headerlink" title="python 版本切换工具-pyenv"></a>python 版本切换工具-<a target="_blank" rel="noopener" href="https://github.com/pyenv/pyenv">pyenv</a></h2><p>常用命令<a target="_blank" rel="noopener" href="https://github.com/pyenv/pyenv/blob/master/COMMANDS.md">commands</a></p>
<p>常见问题<a target="_blank" rel="noopener" href="https://github.com/pyenv/pyenv/issues/1643">issues</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更新安装</span></span><br><span class="line">brew update</span><br><span class="line">brew install pyenv</span><br><span class="line"><span class="comment">#添加补齐</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;if command -v pyenv 1&gt;/dev/null 2&gt;&amp;1; then\n  eval &quot;$(pyenv init -)&quot;\nfi&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="comment">#重启shell</span></span><br><span class="line"><span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$SHELL</span>&quot;</span></span><br><span class="line"><span class="comment"># 可选，但建议安装python依赖项</span></span><br><span class="line">brew install openssl readline sqlite3 xz zlib bzip2 libiconv libzip</span><br><span class="line"><span class="comment">#查看支持的版本</span></span><br><span class="line">pyenv install --list</span><br><span class="line"><span class="comment">#安装指定版本</span></span><br><span class="line">pyenv install 2.7.15</span><br><span class="line"><span class="comment">#如遇安装问题，升级Xcode command line tools和配置下面的环境变量，上面可选变必选</span></span><br><span class="line">vim ~/.zshenv</span><br><span class="line"></span><br><span class="line"><span class="comment">#zlib</span></span><br><span class="line"><span class="comment">#For compilers to find zlib you may need to set:</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;-L/usr/local/opt/zlib/lib&quot;</span></span><br><span class="line"><span class="built_in">export</span> CPPFLAGS=<span class="string">&quot;-I/usr/local/opt/zlib/include&quot;</span></span><br><span class="line"><span class="comment">#For pkg-config to find zlib you may need to set:</span></span><br><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH=<span class="string">&quot;/usr/local/opt/zlib/lib/pkgconfig&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#bzip2</span></span><br><span class="line"><span class="comment">#If you need to have bzip2 first in your PATH, run:</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/usr/local/opt/bzip2/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="comment">#For compilers to find bzip2 you may need to set:</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;-L/usr/local/opt/bzip2/lib&quot;</span></span><br><span class="line"><span class="built_in">export</span> CPPFLAGS=<span class="string">&quot;-I/usr/local/opt/bzip2/include&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#libiconv</span></span><br><span class="line"><span class="comment">#If you need to have libiconv first in your PATH, run:</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/usr/local/opt/libiconv/bin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="comment">#For compilers to find libiconv you may need to set:</span></span><br><span class="line"><span class="built_in">export</span> LDFLAGS=<span class="string">&quot;-L/usr/local/opt/libiconv/lib&quot;</span></span><br><span class="line"><span class="built_in">export</span> CPPFLAGS=<span class="string">&quot;-I/usr/local/opt/libiconv/include&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="python包管理工具"><a href="#python包管理工具" class="headerlink" title="python包管理工具"></a>python包管理工具</h2><p>包管理工具是指类似maven/gradle的管理工具，和maven包管理不同的是，python还要考虑虚拟环境，有了虚拟环境，才能在不同的虚拟环境安装不同版本的包，就相当于一个项目对应一个虚拟环境，一个虚拟环境安装不同的包</p>
<h2 id="名词介绍"><a href="#名词介绍" class="headerlink" title="名词介绍"></a>名词介绍</h2><p><code>pip</code>包管理</p>
<p><code>virtualenv</code>虚拟环境</p>
<h3 id="不同的管理工具及方案"><a href="#不同的管理工具及方案" class="headerlink" title="不同的管理工具及方案"></a>不同的管理工具及方案</h3><h4 id="方案一：传统模式pip-virtualenv"><a href="#方案一：传统模式pip-virtualenv" class="headerlink" title="方案一：传统模式pip+virtualenv"></a>方案一：传统模式<code>pip</code>+<code>virtualenv</code></h4><p>包依赖管理文件<code>requirements.txt</code></p>
<p>问题：在pycharm中莫名其妙的找不到已经安装的包(eg:pandas_bokeh)</p>
<h4 id="方案二：pipenv"><a href="#方案二：pipenv" class="headerlink" title="方案二：pipenv"></a>方案二：<code>pipenv</code></h4><p>包依赖管理文件<code>Pipfile</code></p>
<p>问题：网上说依赖慢，依赖乱</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew install pipenv</span><br><span class="line"><span class="comment">#设置虚拟环境默认建立在项目目录</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PIPENV_VENV_IN_PROJECT=true&#x27;</span> &gt;&gt; ~/.zshenv</span><br></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="https://my.oschina.net/u/4274818/blog/3236481">PyCharm+Pipenv虚拟环境作开发和依赖管理</a></p>
<h4 id="方案三：poetry"><a href="#方案三：poetry" class="headerlink" title="方案三：poetry"></a><del>方案三：<a target="_blank" rel="noopener" href="https://github.com/python-poetry/poetry">poetry</a></del></h4><p>问题：放弃有各种bug，对PyCharm兼容差，安装依赖经常失败，pycharm不能自动识别poetry</p>
<p><a target="_blank" rel="noopener" href="https://python-poetry.org/docs/">官方文档</a></p>
<p>包依赖管理文件<code>pyproject.toml</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mac zsh安装步骤,注意后面用python3安装</span></span><br><span class="line">curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python3</span><br><span class="line"><span class="comment"># 当前终端临时生效</span></span><br><span class="line"><span class="built_in">source</span> <span class="variable">$HOME</span>/.poetry/env</span><br><span class="line"><span class="comment"># 终端永久生效</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=&quot;$PATH:$HOME/.poetry/bin&quot;&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="comment"># 设置虚拟环境安装到项目目录，如果设置改设置，所有项目的虚拟目录都默认到了~/Library/Caches/pypoetry/virtualenvs该路径下面</span></span><br><span class="line">poetry config virtualenvs.in-project <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">brew update</span><br><span class="line">brew install pyenv</span><br><span class="line"></span><br><span class="line"><span class="comment">#卸载</span></span><br><span class="line">wget https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py</span><br><span class="line">python3 get-poetry.py --uninstall</span><br><span class="line">rm get-poetry.py</span><br></pre></td></tr></table></figure>

<p>PyCharm安装插件<code>Poetry</code></p>
<p>poetry虚拟环境目录<code>~/Library/Caches/pypoetry/virtualenvs</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看虚拟环境</span></span><br><span class="line">poetry env list </span><br><span class="line"><span class="comment">#移除虚拟环境</span></span><br><span class="line">poetry env remove python3</span><br></pre></td></tr></table></figure>



<h3 id="pyproject-toml-配置文件详解"><a href="#pyproject-toml-配置文件详解" class="headerlink" title="pyproject.toml 配置文件详解"></a>pyproject.toml 配置文件详解</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tool.poetry]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;pythonleaning&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;xuanleung &lt;exxk.lx@gmail.com&gt;&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[tool.poetry.dependencies]</span></span><br><span class="line"><span class="attr">python</span> = <span class="string">&quot;^3.8&quot;</span></span><br><span class="line"><span class="attr">pandas</span> = <span class="string">&quot;^1.1.4&quot;</span></span><br><span class="line"><span class="attr">nupy</span> = <span class="string">&quot;^0.1.1&quot;</span></span><br><span class="line"><span class="attr">pymongo</span> = <span class="string">&quot;^3.11.1&quot;</span></span><br><span class="line"><span class="attr">matplotlib</span> = <span class="string">&quot;^3.3.3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.poetry.dev-dependencies]</span></span><br><span class="line"></span><br><span class="line"><span class="section">[build-system]</span></span><br><span class="line"><span class="attr">requires</span> = [<span class="string">&quot;poetry-core&gt;=1.0.0&quot;</span>]</span><br><span class="line"><span class="attr">build-backend</span> = <span class="string">&quot;poetry.core.masonry.api&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置代理仓库</span></span><br><span class="line"><span class="section">[[tool.poetry.source]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;aliyun&quot;</span></span><br><span class="line"><span class="attr">url</span> = <span class="string">&quot;https://mirrors.aliyun.com/pypi/simple/&quot;</span></span><br></pre></td></tr></table></figure>





<h2 id="python使用数据库"><a href="#python使用数据库" class="headerlink" title="python使用数据库"></a>python使用数据库</h2><h3 id="python与mongodb"><a href="#python与mongodb" class="headerlink" title="python与mongodb"></a>python与mongodb</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="comment">#连接数据库</span></span><br><span class="line">fund = pymongo.MongoClient(<span class="string">&#x27;mongodb://ip.cn:14011/&#x27;</span>)[<span class="string">&quot;db_name&quot;</span>]</span><br><span class="line"><span class="comment">#条件查询数据，0代表不返回该字段，1代表返回该字段,sort第二个参数1升序，-1降序</span></span><br><span class="line">result = fund[<span class="string">&quot;tb_name&quot;</span>].find(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;, &#123;<span class="string">&quot;_id&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="number">1</span>&#125;).sort(<span class="string">&quot;name&quot;</span>,-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h2 id="python之pandas"><a href="#python之pandas" class="headerlink" title="python之pandas"></a>python之pandas</h2><h3 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h3><h4 id="loc"><a href="#loc" class="headerlink" title="loc"></a><a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html">loc</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#返回为&#x27;列标&#x27;的那列数据</span></span><br><span class="line">Series=df[<span class="string">&#x27;col&#x27;</span>]</span><br><span class="line"><span class="comment">#给满足条件的行row和列col赋新值</span></span><br><span class="line">df.loc[<span class="string">&#x27;row&#x27;</span>,<span class="string">&#x27;col&#x27;</span>]=<span class="string">&#x27;赋新值&#x27;</span></span><br><span class="line"><span class="comment">#单列计算，该列全部乘以2</span></span><br><span class="line">df[<span class="string">&#x27;col2&#x27;</span>] = df[<span class="string">&#x27;col1&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x*<span class="number">2</span>)</span><br><span class="line"><span class="comment">#不用lambda表达式为下方写法</span></span><br><span class="line">define square(x):</span><br><span class="line">    <span class="keyword">return</span> (x * <span class="number">2</span>)</span><br><span class="line">df[<span class="string">&#x27;col2&#x27;</span>] = df[<span class="string">&#x27;col1&#x27;</span>].<span class="built_in">map</span>(square)</span><br><span class="line"><span class="comment">#多列计算用apply,例如col3 = col1 + 2 * col2:</span></span><br><span class="line">df[<span class="string">&#x27;col3&#x27;</span>] = df.apply(<span class="keyword">lambda</span> x: x[<span class="string">&#x27;col1&#x27;</span>] + <span class="number">2</span> * x[<span class="string">&#x27;col2&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#图表分开展示</span></span><br><span class="line">df.plot.line(subplots=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有列</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_columns&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment"># 显示所有行</span></span><br><span class="line"><span class="comment"># pd.set_option(&#x27;display.max_rows&#x27;, None)</span></span><br><span class="line"><span class="comment"># 设置value的显示长度为100，默认为50</span></span><br><span class="line"><span class="comment"># pd.set_option(&#x27;max_colwidth&#x27;,100)</span></span><br><span class="line"><span class="comment"># 设置显示的宽度</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.width&#x27;</span>, <span class="number">5000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://www.modb.pro/db/31508">一款让Python开发效率提升50%的工具包</a></p>
<p><a target="_blank" rel="noopener" href="https://lenciel.com/2020/07/python-in-2020-part1-env-setup/">Python in 2020 (1) - 环境搭建</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/09/24/python-dataview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/24/python-dataview/" class="post-title-link" itemprop="url">python-dataview</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-09-24 11:46:46" itemprop="dateCreated datePublished" datetime="2020-09-24T11:46:46+00:00">2020-09-24</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-21 11:09:53" itemprop="dateModified" datetime="2020-10-21T11:09:53+00:00">2020-10-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
    <span id="/2020/09/24/python-dataview/" class="post-meta-item leancloud_visitors" data-flag-title="python-dataview" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="python数据可视化"><a href="#python数据可视化" class="headerlink" title="python数据可视化"></a>python数据可视化</h1><p>Pandas支持的<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/dev/ecosystem.html#visualization">可视化后端</a>:matplotlib、bokeh、plotly等</p>
<h2 id="Pandas-matplotlib"><a href="#Pandas-matplotlib" class="headerlink" title="Pandas-matplotlib"></a>Pandas-matplotlib</h2><p>老版绘图工具，不支持交互，但是资料较多，支持图表多，pandas的默认绘图后端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">x = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">y = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">plt.figure()</span><br><span class="line">plt.plot(x, y)</span><br><span class="line">plt.savefig(<span class="string">&quot;test.jpg&quot;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"><span class="comment">#--pandas使用--</span></span><br><span class="line">df = pd.DataFrame(result)</span><br><span class="line">df.plot()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<h2 id="Pandas-Bokeh"><a href="#Pandas-Bokeh" class="headerlink" title="Pandas-Bokeh"></a><a target="_blank" rel="noopener" href="https://github.com/PatrikHlobil/Pandas-Bokeh">Pandas-Bokeh</a></h2><p>首先安装<code>pip install pandas-bokeh</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> pandas_bokeh</span><br><span class="line">pd.set_option(<span class="string">&#x27;plotting.backend&#x27;</span>, <span class="string">&#x27;pandas_bokeh&#x27;</span>)</span><br><span class="line">df = pd.DataFrame(result)</span><br><span class="line">df.plot_bokeh()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<h2 id="Pandas-plotly"><a href="#Pandas-plotly" class="headerlink" title="Pandas-plotly"></a>Pandas-plotly</h2><h2 id="Pandas-hvplot"><a href="#Pandas-hvplot" class="headerlink" title="Pandas-hvplot"></a>Pandas-<a target="_blank" rel="noopener" href="https://hvplot.holoviz.org/">hvplot</a></h2><p>hvPlot提供了基于HoloViews和Bokeh的高级绘图API</p>
<h2 id="Pyecharts"><a href="#Pyecharts" class="headerlink" title="Pyecharts"></a>Pyecharts</h2><p><a target="_blank" rel="noopener" href="https://github.com/pyecharts">pyecharts</a>/<strong><a target="_blank" rel="noopener" href="https://github.com/pyecharts/pyecharts">pyecharts</a></strong></p>
<p>支持交互，基于Echarts，运行后会生成个html在项目目录，要在浏览器打开就可以看到图标了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyecharts.options <span class="keyword">as</span> opts</span><br><span class="line"><span class="keyword">from</span> pyecharts.charts <span class="keyword">import</span> Line</span><br><span class="line">    x = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    y = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    line = (</span><br><span class="line">        Line()</span><br><span class="line">        .add_xaxis(x)</span><br><span class="line">        .add_yaxis(<span class="string">&quot;y&quot;</span>, y)</span><br><span class="line">    )</span><br><span class="line">    line.render()</span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a target="_blank" rel="noopener" href="https://www.pythonf.cn/read/36686">09-选择适合你的Python可视化工具</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/09/19/tools-autosub/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/19/tools-autosub/" class="post-title-link" itemprop="url">tools-autosub</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-09-19 21:42:41 / 修改时间：23:39:06" itemprop="dateCreated datePublished" datetime="2020-09-19T21:42:41+00:00">2020-09-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
    <span id="/2020/09/19/tools-autosub/" class="post-meta-item leancloud_visitors" data-flag-title="tools-autosub" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="AI字幕"><a href="#AI字幕" class="headerlink" title="AI字幕"></a>AI字幕</h2><p>参考<a target="_blank" rel="noopener" href="https://github.com/BingLingGroup">BingLingGroup</a>/<strong><a target="_blank" rel="noopener" href="https://github.com/BingLingGroup/autosub">autosub</a></strong></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#一定要使用http代理，不能用socke5代理，错误详细信息见常见错误1</span></span><br><span class="line"><span class="built_in">export</span> all_proxy=http://127.0.0.1:58591</span><br><span class="line"><span class="comment">#一定要用pip3</span></span><br><span class="line"><span class="comment">#(废除有bug见错误2)pip3 install git+https://github.com/BingLingGroup/autosub.git@alpha ffmpeg-normalize langcodes</span></span><br><span class="line">pip3 install git+https://github.com/BingLingGroup/autosub.git@dev ffmpeg-normalize langcodes</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#dcy1.wmv视频日语(ja-jp)生成中文(zh-cn)字幕</span></span><br><span class="line">autosub -i dcy1.wmv  -S ja-jp -D zh-cn</span><br><span class="line"><span class="comment">#-o指定输出路径，不指定要卡住</span></span><br><span class="line">autosub -i dcy1.wmv  -S ja-jp -D zh-cn -o /Users/xuanleung/Downloads/worldvideo/dcy1.zh-cn.srt</span><br></pre></td></tr></table></figure>



<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h3 id="错误1："><a href="#错误1：" class="headerlink" title="错误1："></a>错误1：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Could not install packages due to an EnvironmentError: Missing dependencies <span class="keyword">for</span> SOCKS support.</span><br></pre></td></tr></table></figure>

<p>解决：原因是安装包不支持socks代理，两种解决方法，一是让它支持，二是采用http代理，这里用第二种方法解决，执行<code>export all_proxy=http://127.0.0.1:58591</code></p>
<h3 id="错误2："><a href="#错误2：" class="headerlink" title="错误2："></a>错误2：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    <span class="built_in">return</span> value.encode(encoding or <span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">AttributeError: <span class="string">&#x27;NoneType&#x27;</span> object has no attribute <span class="string">&#x27;encode&#x27;</span></span><br></pre></td></tr></table></figure>

<p>解决：原因环境变量编码的问题，执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export LANG&#x3D;en_US.UTF-8</span><br><span class="line">export LC_ALL&#x3D;en_US.UTF-8</span><br></pre></td></tr></table></figure>

<p>上述还无法解决见<a target="_blank" rel="noopener" href="https://github.com/BingLingGroup/autosub/issues/127">https://github.com/BingLingGroup/autosub/issues/127</a>上面解决是在dev分支<a target="_blank" rel="noopener" href="https://github.com/BingLingGroup/autosub/commit/d1133b37fcfc3ea03458063f73841dcbe732b483">2020.07.02</a>提交的当时还没修复到alpha分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#升级dev分支</span></span><br><span class="line">pip3 install --upgrade git+https://github.com/BingLingGroup/autosub.git@dev</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/09/09/tools-ffmpeg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/09/tools-ffmpeg/" class="post-title-link" itemprop="url">tools-ffmpeg</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-09-09 16:58:53" itemprop="dateCreated datePublished" datetime="2020-09-09T16:58:53+00:00">2020-09-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-09-10 15:03:21" itemprop="dateModified" datetime="2020-09-10T15:03:21+00:00">2020-09-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
        </span>
    </span>

  
    <span id="/2020/09/09/tools-ffmpeg/" class="post-meta-item leancloud_visitors" data-flag-title="tools-ffmpeg" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>视频转换</p>
<p><a target="_blank" rel="noopener" href="https://www.ffmpeg.org/">官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2020/01/ffmpeg.html">FFmpeg 视频处理入门教程</a></p>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看视频信息</span></span><br><span class="line">ffprobe 1.mkv</span><br><span class="line"><span class="comment">#播放视频</span></span><br><span class="line">ffplay 1.mkv</span><br><span class="line"><span class="comment">#将字幕封装到mkv视频容器中</span></span><br><span class="line">ffmpeg -i 1.mkv -i 1.ass -c copy 11.mkv</span><br><span class="line"><span class="comment">#设置视频源数据里面的标题</span></span><br><span class="line">ffmpeg -i 1.mkv -metadata title=<span class="string">&#x27;标题&#x27;</span> -c copy 11.mkv</span><br><span class="line"><span class="comment">#复制所有的0开头的流（各种音频字幕流）</span></span><br><span class="line">ffmpeg -i 1.mkv -c copy -map 0 11.mkv</span><br><span class="line"><span class="comment">#复制metadata里面的数据</span></span><br><span class="line">ffmpeg -i 1.mkv -c copy -map_metadata 0 11.mkv</span><br><span class="line"><span class="comment">#整合</span></span><br><span class="line">ffmpeg -i 1.mkv -i 1.ass -metadata title=<span class="string">&#x27;标题&#x27;</span> -c copy -map 0 -map_metadata 0 11.mkv</span><br><span class="line">ffmpeg -i 1.mkv -i 1.ass -metadata title=<span class="string">&#x27;小公女セーラ 第01話「ミンチン女子学院」&#x27;</span> -c copy -map 0 -map_metadata 0 111.mkv</span><br></pre></td></tr></table></figure>

<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#基础格式</span></span><br><span class="line">ffmpeg &#123;全局参数&#125; &#123;输入文件参数&#125; -i &#123;输入文件&#125; &#123;输出文件参数&#125; &#123;输出文件&#125;</span><br><span class="line"><span class="comment"># eg:</span></span><br><span class="line">ffmpeg \</span><br><span class="line">-y \ <span class="comment"># 全局参数</span></span><br><span class="line">-c:a libfdk_aac -c:v libx264 \ <span class="comment"># 输入文件参数</span></span><br><span class="line">-i input.mp4 \ <span class="comment"># 输入文件</span></span><br><span class="line">-c:v libvpx-vp9 -c:a libvorbis \ <span class="comment"># 输出文件参数</span></span><br><span class="line">output.webm <span class="comment"># 输出文件</span></span><br><span class="line">ffmpeg -i input.avi output.mp4  <span class="comment">#简写</span></span><br><span class="line"><span class="comment">#常用命令行参数</span></span><br><span class="line">-c：指定编码器</span><br><span class="line">-c copy：直接复制，不经过重新编码（这样比较快）</span><br><span class="line">-c:v：指定视频编码器</span><br><span class="line">-c:a：指定音频编码器</span><br><span class="line">-i：指定输入文件</span><br><span class="line">-an：去除音频流</span><br><span class="line">-vn： 去除视频流</span><br><span class="line">-preset：指定输出的视频质量，会影响文件的生成速度，有以下几个可用的值 ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow。</span><br><span class="line">-y：不经过确认，输出时直接覆盖同名文件。</span><br></pre></td></tr></table></figure>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mac</span></span><br><span class="line">brew install ffmpeg</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/09/03/spring-logback/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/03/spring-logback/" class="post-title-link" itemprop="url">spring logback</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-09-03 15:50:23" itemprop="dateCreated datePublished" datetime="2020-09-03T15:50:23+00:00">2020-09-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-04-13 10:27:30" itemprop="dateModified" datetime="2021-04-13T10:27:30+00:00">2021-04-13</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
    <span id="/2020/09/03/spring-logback/" class="post-meta-item leancloud_visitors" data-flag-title="spring logback" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="spring-logback-简介"><a href="#spring-logback-简介" class="headerlink" title="spring logback 简介"></a>spring logback 简介</h1><h3 id="依赖图"><a href="#依赖图" class="headerlink" title="依赖图"></a>依赖图</h3><p>可以发现logback在<code>spring-boot-starter</code>依赖里面，所以引入了springboot都自带logback</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">logback--&gt;spring-boot-starter-logging--&gt;spring-boot-starter</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">+---</span> <span class="string">org.springframework.boot:spring-boot-starter</span> <span class="string">-&gt;</span> <span class="number">2.2</span><span class="number">.2</span><span class="string">.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">+---</span> <span class="string">org.springframework.boot:spring-boot:2.2.2.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">+---</span> <span class="string">org.springframework:spring-core:5.2.2.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">|</span>    <span class="string">\---</span> <span class="string">org.springframework:spring-jcl:5.2.2.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">\---</span> <span class="string">org.springframework:spring-context:5.2.2.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>         <span class="string">+---</span> <span class="string">org.springframework:spring-aop:5.2.2.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>         <span class="string">|</span>    <span class="string">+---</span> <span class="string">org.springframework:spring-beans:5.2.2.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>         <span class="string">|</span>    <span class="string">|</span>    <span class="string">\---</span> <span class="string">org.springframework:spring-core:5.2.2.RELEASE</span> <span class="string">(*)</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>         <span class="string">|</span>    <span class="string">\---</span> <span class="string">org.springframework:spring-core:5.2.2.RELEASE</span> <span class="string">(*)</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>         <span class="string">+---</span> <span class="string">org.springframework:spring-beans:5.2.2.RELEASE</span> <span class="string">(*)</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>         <span class="string">+---</span> <span class="string">org.springframework:spring-core:5.2.2.RELEASE</span> <span class="string">(*)</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>         <span class="string">\---</span> <span class="string">org.springframework:spring-expression:5.2.2.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>              <span class="string">\---</span> <span class="string">org.springframework:spring-core:5.2.2.RELEASE</span> <span class="string">(*)</span></span><br><span class="line"><span class="string">|</span>    <span class="string">+---</span> <span class="string">org.springframework.boot:spring-boot-autoconfigure:2.2.2.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">\---</span> <span class="string">org.springframework.boot:spring-boot:2.2.2.RELEASE</span> <span class="string">(*)</span></span><br><span class="line"><span class="string">|</span>    <span class="string">+---</span> <span class="string">org.springframework.boot:spring-boot-starter-logging:2.2.2.RELEASE</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">+---</span> <span class="string">ch.qos.logback:logback-classic:1.2.3</span> <span class="comment">#可以看到在springboot里面自带</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">|</span>    <span class="string">+---</span> <span class="string">ch.qos.logback:logback-core:1.2.3</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">|</span>    <span class="string">\---</span> <span class="string">org.slf4j:slf4j-api:1.7.25</span> <span class="string">-&gt;</span> <span class="number">1.7</span><span class="number">.29</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">+---</span> <span class="string">org.apache.logging.log4j:log4j-to-slf4j:2.12.1</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">|</span>    <span class="string">+---</span> <span class="string">org.slf4j:slf4j-api:1.7.25</span> <span class="string">-&gt;</span> <span class="number">1.7</span><span class="number">.29</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">|</span>    <span class="string">\---</span> <span class="string">org.apache.logging.log4j:log4j-api:2.12.1</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>    <span class="string">\---</span> <span class="string">org.slf4j:jul-to-slf4j:1.7.29</span></span><br><span class="line"><span class="string">|</span>    <span class="string">|</span>         <span class="string">\---</span> <span class="string">org.slf4j:slf4j-api:1.7.29</span></span><br><span class="line"><span class="string">|</span>    <span class="string">+---</span> <span class="string">jakarta.annotation:jakarta.annotation-api:1.3.5</span></span><br><span class="line"><span class="string">|</span>    <span class="string">+---</span> <span class="string">org.springframework:spring-core:5.2.2.RELEASE</span> <span class="string">(*)</span></span><br><span class="line"><span class="string">|</span>    <span class="string">\---</span> <span class="string">org.yaml:snakeyaml:1.25</span></span><br></pre></td></tr></table></figure>

<h2 id="logback-spring-xml介绍"><a href="#logback-spring-xml介绍" class="headerlink" title="logback-spring.xml介绍"></a><code>logback-spring.xml</code>介绍</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Logback configuration. See http://logback.qos.ch/manual/index.html --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">scan：当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true。</span></span><br><span class="line"><span class="comment">scanPeriod：设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒当scan为true时，此属性生效。默认的时间间隔为1分钟。</span></span><br><span class="line"><span class="comment">debug：当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为false。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;10 seconds&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--服务名称，通过读取spring配置项spring.application.name--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;APP_NAME&quot;</span> <span class="attr">source</span>=<span class="string">&quot;spring.application.name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志输出类型,可在配置文件通过spring.cloud.config.logback-profile进行设置日志输出类型   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;LOG_TYPE&quot;</span> <span class="attr">source</span>=<span class="string">&quot;spring.cloud.config.logback-profile&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义日志的目录，logs为项目根目录下logs目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_PATH&quot;</span> <span class="attr">value</span>=<span class="string">&quot;logs&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义日志的文件名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;LOG_PATH&#125;/$&#123;APP_NAME&#125;.log&quot;</span> <span class="attr">name</span>=<span class="string">&quot;LOG_FILE_NAME&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- %d&#123;yyyy-MM-dd&#125;：按天进行日志滚动 %i：当文件大小超过maxFileSize时，按照i进行文件滚动   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;LOG_PATH&#125;/$&#123;APP_NAME&#125;-%d&#123;yyyy-MM-dd&#125;-%i.log&quot;</span> <span class="attr">name</span>=<span class="string">&quot;LOG_FILE_NAME_PATTERN&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义日志的格式化标准 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_FORMAT&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [ %thread ] - [ %-5level ] [ %logger&#123;50&#125; : %line ] - %msg%n&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 文件输出： 滚动记录文件，先将日志记录到指定文件，当符合某个条件时，将日志记录到其他文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定日志文件的名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_FILE_NAME&#125;<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件分割机制--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;LOG_FILE_NAME_PATTERN&#125;<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--当天日志当大于100M进行分割--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志输出格式： --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;LOG_FORMAT&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--控制台输出:也就是前端显示输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;stdout&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;LOG_FORMAT&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义不同的包，不同的日志级别(TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR),additivity生效级别true都有效(所有日志输出类型，包含默认的)，false只是当前（当前配置的输出日志类型）有效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.exxk&quot;</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--选择那个日志输出类型，对应上面的appender，支持多个同时选择 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--stdout设置为默认输出类型，不需要的输出类型可以直接注释--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;stdout&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--通过application配置文件的spring.cloud.config.logback-profile配置项进行指定加载那个日志输出类型，值为appender的name  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;$&#123;LOG_TYPE&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>application.properties</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.application.name</span>=<span class="string">testDemo</span></span><br><span class="line"><span class="comment">#指定那个输出类型</span></span><br><span class="line"><span class="meta">spring.cloud.config.logback-profile</span>=<span class="string">FILE</span></span><br></pre></td></tr></table></figure>

<h1 id="log-日志脱敏和超长日志处理"><a href="#log-日志脱敏和超长日志处理" class="headerlink" title="log 日志脱敏和超长日志处理"></a>log 日志脱敏和超长日志处理</h1><h4 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h4><p>因为日志里面含有大量的base64的图片数据，各处都有打印，导致日志过大，日志不美观排查问题不方便</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6f093b0b0c8a">logback-spring.xml</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1650600">一般人不敢动系列之—基于logback的日志“规范”和“脱敏”</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/09/01/spring-internationalization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/09/01/spring-internationalization/" class="post-title-link" itemprop="url">spring 国际化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-09-01 10:34:53" itemprop="dateCreated datePublished" datetime="2020-09-01T10:34:53+00:00">2020-09-01</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-09-08 11:44:07" itemprop="dateModified" datetime="2020-09-08T11:44:07+00:00">2020-09-08</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
    <span id="/2020/09/01/spring-internationalization/" class="post-meta-item leancloud_visitors" data-flag-title="spring 国际化" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="国际化配置"><a href="#国际化配置" class="headerlink" title="国际化配置"></a>国际化配置</h2><p>spring自带，所以不需要添加任何依赖</p>
<ol>
<li><p>在<code>resources</code>目录添加</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建message.properties文件并添加</span></span><br><span class="line"><span class="meta">user.name</span>=<span class="string">userName</span></span><br><span class="line"><span class="attr">----------------------------</span></span><br><span class="line"><span class="comment">#创建message_en.properties文件并添加</span></span><br><span class="line"><span class="meta">user.name</span>=<span class="string">user name</span></span><br><span class="line"><span class="attr">---------------------------</span></span><br><span class="line"><span class="comment">#创建message_zh.properties文件并添加</span></span><br><span class="line"><span class="meta">user.name</span>=<span class="string">用户名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>spring配置文件添加配置<code>spring.messages.basename=message</code>其中message为国际化的文件，就是上面添加的文件名，如果有文件夹包裹，从<code>resources</code>带上文件相对路径</p>
</li>
<li><p>添加测试类,关键类<code>MessageSource</code>是读取国际化文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.MessageSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.i18n.LocaleContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestControl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MessageSource messageSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/glob&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">glob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String userNmae = messageSource.getMessage(<span class="string">&quot;user.name&quot;</span>, <span class="keyword">null</span>, LocaleContextHolder.getLocale());</span><br><span class="line">        logger.info(<span class="string">&quot;glob :&quot;</span> + userNmae);</span><br><span class="line">        <span class="keyword">return</span> userNmae;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试，使用postman请求该接口，然后请求<code>headers</code>里面添加<code>Accept-Language:ch</code>或<code>Accept-Language:en</code>就能返回对应的翻译了</p>
</li>
</ol>
<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><ol>
<li><p>出现<code>No message found under code &#39;user.name&#39; for locale &#39;ch&#39;.</code>错误</p>
<p>解决：在配置文件<code>application.properties</code>配置<code>#spring.messages.basename=&lt;你的国际化文件&gt;</code>，或者检查国际化文件是否存在和配置的文件是否匹配</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/08/24/spring-maven-package/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/24/spring-maven-package/" class="post-title-link" itemprop="url">springboot打包套壳</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-24 11:13:54" itemprop="dateCreated datePublished" datetime="2020-08-24T11:13:54+00:00">2020-08-24</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-09-08 11:43:49" itemprop="dateModified" datetime="2020-09-08T11:43:49+00:00">2020-09-08</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
    <span id="/2020/08/24/spring-maven-package/" class="post-meta-item leancloud_visitors" data-flag-title="springboot打包套壳" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>客户需要git自动化部署，但是又不能提供源码，所以打包成jar包，然后在套壳，依赖jar进行部署</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(springboot源项目)--&gt;G(打包发布成jar,含main class)--做为依赖--&gt;L[springboot套壳项目]--&gt;E[自动部署]</span><br></pre></td></tr></table></figure>

<h2 id="利用maven仓库打包步骤"><a href="#利用maven仓库打包步骤" class="headerlink" title="利用maven仓库打包步骤"></a>利用maven仓库打包步骤</h2><ol>
<li><p>删除源项目<code>pom.xml</code>里面的<code>&lt;build&gt;&lt;/build&gt;</code>标签及里面的内容</p>
</li>
<li><p>如果项目里面有公共项目本地依赖(common等)，都要上传，因为打包jar不会打包依赖到jar包里面，上传需要在<code>pom.xml</code>里面添加，然后执行mave lifecycle  里面的 deploy</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--这里的id要和maven里的的settings.xml的id一致--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus Release Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://ipaddress/repository/maven-third/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意:</p>
<ol>
<li><p>上传报错的话，检查依赖包是否设置<code>&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</code>需要改成<code>&lt;version&gt;0.0.1&lt;/version&gt;</code>因为<code>SNAPSHOT</code>上传需要特殊权限</p>
</li>
<li><p>上传没有权限，需要添加nexus中仓库的角色权限<code>nx-repository-view-*-*-edit</code></p>
</li>
<li><p>检查maven的设置文件<code>setting.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>read<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>read***<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果是多项目结构，外面的父项目框架，不需要deploy，在<code>pom.xml</code>添加下面这个设置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.deploy.skip</span>&gt;</span>true<span class="tag">&lt;/<span class="name">maven.deploy.skip</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>新建个maven空项目，其中pom.xml如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- 这个千万不能添加，添加会提示找不到main class--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--	&lt;parent&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--		&lt;version&gt;2.1.12.RELEASE&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--	&lt;/parent&gt;--&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- id不能和原项目一样，不然会提示自己依赖自己--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bpf_pf_router_zy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>bpf_pf_router_zy<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 源项目打包成的jar--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.nantian<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bpf_pf_router<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">		<span class="comment">&lt;!-- 添加主类，主类在原项目，也就是第一步里面删除的那部分里面有--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.nantian.bpf.router.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="利用maven-dependency-plugin进行本地打包"><a href="#利用maven-dependency-plugin进行本地打包" class="headerlink" title="利用maven-dependency-plugin进行本地打包"></a>利用maven-dependency-plugin进行本地打包</h2><ol>
<li><p>在壳项目pom.xml添加如下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.......</span><br><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>lib<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>file:$&#123;project.basedir&#125;/lib<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        ........</span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
</li>
<li><p>把maven本地库里面的原项目的依赖放到壳项目的lib目录里面</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">├──</span> <span class="string">README.md</span></span><br><span class="line"><span class="meta">├──</span> <span class="string">lib</span></span><br><span class="line"><span class="meta">│  </span> <span class="string">└── com</span></span><br><span class="line"><span class="meta">│  </span>     <span class="string">└── nantian</span></span><br><span class="line"><span class="meta">│  </span>         <span class="string">└── bpf_pf_router</span></span><br><span class="line"><span class="meta">│  </span>             <span class="string">├── 1.0.0</span></span><br><span class="line"><span class="meta">│  </span>             <span class="string">│   ├── _remote.repositories</span></span><br><span class="line"><span class="meta">│  </span>             <span class="string">│   ├── bpf_pf_router-1.0.0.jar</span></span><br><span class="line"><span class="meta">│  </span>             <span class="string">│   └── bpf_pf_router-1.0.0.pom</span></span><br><span class="line"><span class="meta">│  </span>             <span class="string">├── maven-metadata-local.xml</span></span><br><span class="line"><span class="meta">│  </span>             <span class="string">├── maven-metadata-nexus.xml</span></span><br><span class="line"><span class="meta">│  </span>             <span class="string">└── resolver-status.properties</span></span><br><span class="line"><span class="meta">├──</span> <span class="string">pom.xml</span></span><br><span class="line"><span class="meta">├──</span> <span class="string">src</span></span><br><span class="line"><span class="meta">│  </span> <span class="string">└── main</span></span><br><span class="line"><span class="meta">│  </span>     <span class="string">├── java</span></span><br><span class="line"><span class="meta">│  </span>     <span class="string">└── resources</span></span><br><span class="line"><span class="meta">│  </span>         <span class="string">└── bootstrap.properties</span></span><br><span class="line"><span class="meta">└──</span> <span class="string">target</span></span><br><span class="line">    <span class="meta">└──</span> <span class="string">cnpc_dj_business_facerouter-1.0.0.jar</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>更新时将jar更新到lib目录时，如果只更新了jar，需要注意清除maven本地库(lib 加载到 maven本地库，本地库在打包进jar)，否则就更新lib里面的其他文件，这样就能识别出来lib发生了更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">a[lib]--&gt;b[maven本地库]--&gt;c[jar]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="利用lib打包步骤-废弃暂时不能解决"><a href="#利用lib打包步骤-废弃暂时不能解决" class="headerlink" title="利用lib打包步骤(废弃暂时不能解决)"></a>利用lib打包步骤(废弃暂时不能解决)</h2><ol>
<li><p>改造壳项目pom.xml,修改依赖为本地依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.nantian<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">  		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bpf_pf_router<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">  		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/src/libs/bpf_pf_router-1.0.0.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>把原项目jar包放到项目src目录</p>
</li>
<li><p>改造壳项目pom.xml,修改打包参数，不修改，不会把lib打包进jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--添加下面这句 --&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">includeSystemScope</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeSystemScope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>     </span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ol>
<li>jar包里面包含依赖，利用本地jar包打包时，依赖不自动打入(暂时未能解决)</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/08/20/docker-elk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/20/docker-elk/" class="post-title-link" itemprop="url">docker-ELK</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-20 16:17:51" itemprop="dateCreated datePublished" datetime="2020-08-20T16:17:51+00:00">2020-08-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-09-07 10:26:44" itemprop="dateModified" datetime="2020-09-07T10:26:44+00:00">2020-09-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
    <span id="/2020/08/20/docker-elk/" class="post-meta-item leancloud_visitors" data-flag-title="docker-ELK" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ELK-EFK简介"><a href="#ELK-EFK简介" class="headerlink" title="ELK/EFK简介"></a><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/">ELK/EFK简介</a></h2><p>E(Elasticsearch)+L(Logstash)+K(Kibana)</p>
<p>E(Elasticsearch)+F(Filebeat)+K(Kibana)</p>
<p>Redis/Mq/kafka大数据高提高弹性时候可选</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">B(beats数据采集)-.-&gt;G([redis&#x2F;mq&#x2F;kafka])-.-&gt;L[Logstash数据管道&#x2F;处理]--&gt;E[Elasticsearch数据存储&#x2F;索引]--&gt;K[Kibana数据分析&#x2F;显示]</span><br><span class="line">B--&gt;L</span><br></pre></td></tr></table></figure>

<h2 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h2><p>输入支持：tcp,http,file,beats,kafka,rabbitmq,redis,log4j,elasticsearch,jdbc,websocket</p>
<p>过滤器支持：grok,ruby,mutate,json</p>
<p>输出支持：elasticsearch,File,Emial,http,Kafka,Redis,MongoDB,Rabbitmq,Syslog,Tcp,Websocket,Zabbix,Stdout,Csv</p>
<h2 id="Filebeat-vs-fluent"><a href="#Filebeat-vs-fluent" class="headerlink" title="Filebeat vs fluent"></a>Filebeat vs fluent</h2><p>Filebeat主要用于数据采集，轻量对应用服务器消耗较小，虽然Logstash也可以采集数据，但Logstash占用应用服务器性能比Filebeat大</p>
<p>fluent是Filebeat的高级版，支持很多其他日志输入模式</p>
<h2 id="springboot-log框架包"><a href="#springboot-log框架包" class="headerlink" title="springboot log框架包"></a>springboot log框架包</h2><ul>
<li>/<strong><a target="_blank" rel="noopener" href="https://github.com/logstash/logstash-logback-encoder">logstash-logback-encoder</a></strong> Star 1.7k</li>
<li>/<strong><a target="_blank" rel="noopener" href="https://github.com/danielwegener/logback-kafka-appender">logback-kafka-appender</a></strong> Star 472</li>
<li>/<strong><a target="_blank" rel="noopener" href="https://github.com/sndyuk/logback-more-appenders">logback-more-appenders</a></strong> Star 87</li>
<li><a target="_blank" rel="noopener" href="https://github.com/kmtong">kmtong</a>/<strong><a target="_blank" rel="noopener" href="https://github.com/kmtong/logback-redis-appender">logback-redis-appender</a></strong> Star 103</li>
</ul>
<h2 id="架构选型"><a href="#架构选型" class="headerlink" title="架构选型"></a>架构选型</h2><h3 id="方案一-EFK-docker-log模式"><a href="#方案一-EFK-docker-log模式" class="headerlink" title="方案一 EFK(docker log模式)"></a>方案一 EFK(docker log模式)</h3><p>利用Filebeat采集docker日志，从而监控docker上所有或指定服务的日志，实现SpringCloud的日志监听</p>
<p>优点: 对现有服务侵入无，不需要改造现有服务</p>
<p>缺点：强依赖于docker，只能监听docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">B(Filebeat收集docker日志)--&gt;E[Elasticsearch]--&gt;K[Kibana]</span><br></pre></td></tr></table></figure>

<h3 id="方案二-Logstash采用"><a href="#方案二-Logstash采用" class="headerlink" title="方案二  Logstash采用"></a>方案二  Logstash采用</h3><p>优点：简洁，搭建快速</p>
<p>缺点：没缓冲，可能会有瓶颈</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">B(Logstash收集本地log文件)--&gt;E[Elasticsearch]--&gt;K[Kibana]</span><br></pre></td></tr></table></figure>

<h3 id="方案三-Logstash-redis-Logstash-未验证"><a href="#方案三-Logstash-redis-Logstash-未验证" class="headerlink" title="方案三 Logstash+redis+Logstash(未验证)"></a>方案三 Logstash+redis+Logstash(未验证)</h3><p>参考：<a target="_blank" rel="noopener" href="https://developer.ibm.com/zh/articles/build-elk-and-use-it-for-springboot-and-nginx/">搭建 ELK 实时日志平台并在 Spring Boot 和 Nginx 项目中使用</a></p>
<p>优点：</p>
<ol>
<li>直接读取日志文件，对原来的系统入侵无，</li>
<li>支持所有服务，例如nginx,springboot等只要能生成日志文件的</li>
</ol>
<p>缺点：</p>
<ol>
<li>需要在读取日志文件的服务器都安装Logstash(shipper角色)</li>
<li>采用docker部署的时候，springboot需要映射日志目录</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">B(Logstash收集本地log文件&#x2F;Shipper)--写入--&gt;G([redis])--读取--&gt;L[Logstash&#x2F;Indexer角色]--&gt;E[Elasticsearch]--&gt;K[Kibana]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="方案四-kafka-logstash-未验证"><a href="#方案四-kafka-logstash-未验证" class="headerlink" title="方案四 kafka+logstash(未验证)"></a>方案四 kafka+logstash(未验证)</h3><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zjx2016/article/details/104311744">Spring Cloud集成ELK完成日志收集实战（elasticsearch、logstash、kibana</a></p>
<p>优点：</p>
<ol>
<li>不需要在应用服务器安装额外的服务</li>
<li>支持docker部署，不需要额外映射服务目录</li>
</ol>
<p>缺点：</p>
<ol>
<li>需要改造springboot</li>
<li>不支持nginx、数据库等服务</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">B(springboot)--写入--&gt;G([kafka])--读取--&gt;L[Logstash]--&gt;E[Elasticsearch]--&gt;K[Kibana]</span><br></pre></td></tr></table></figure>

<h3 id="方案五-EFK-logback-more-appenders"><a href="#方案五-EFK-logback-more-appenders" class="headerlink" title="方案五 EFK+logback-more-appenders"></a>方案五 EFK+<a target="_blank" rel="noopener" href="https://github.com/sndyuk/logback-more-appenders">logback-more-appenders</a></h3><p>参考：<a target="_blank" rel="noopener" href="https://github.com/sndyuk">sndyuk</a>/<strong><a target="_blank" rel="noopener" href="https://github.com/sndyuk/logback-more-appenders">logback-more-appenders</a></strong></p>
<p>优点：直接通过jar集成logback框架，干净</p>
<p>缺点：只适合于springboot</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A(springboot依赖logback-more-appenders)--&gt;B(fluent)--&gt;E[Elasticsearch]--&gt;K[Kibana]</span><br></pre></td></tr></table></figure>

<p>步骤：</p>
<ol>
<li><p>Docker安装<code>fluent</code>,fluent镜像需要自己制作<a target="_blank" rel="noopener" href="https://github.com/iexxk/dockerbuild-fluent">exxk/fluent-elasticsearch:latest</a><br>参考<a target="_blank" rel="noopener" href="https://docs.fluentd.org/container-deployment/docker-compose">fluentd/container-deployment/docker-compose</a></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fluentd/Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> fluent/fluentd:v1.<span class="number">6</span>-debian-<span class="number">1</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">&quot;gem&quot;</span>, <span class="string">&quot;install&quot;</span>, <span class="string">&quot;fluent-plugin-elasticsearch&quot;</span>, <span class="string">&quot;--no-document&quot;</span>, <span class="string">&quot;--version&quot;</span>, <span class="string">&quot;3.5.2&quot;</span>]</span></span><br><span class="line"><span class="keyword">USER</span> fluent</span><br></pre></td></tr></table></figure>
</li>
<li><p>springboot引入maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// https://mvnrepository.com/artifact/com.sndyuk/logback-more-appenders</span><br><span class="line">compile group: &#x27;com.sndyuk&#x27;, name: &#x27;logback-more-appenders&#x27;, version: &#x27;1.4.2&#x27;</span><br><span class="line">compile group: &#x27;org.fluentd&#x27;, name: &#x27;fluent-logger&#x27;, version: &#x27;0.3.4&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p>springboot在logback.xml添加fluentd的日志输出模式(具体见logback的配置)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">&lt;!--EFK ip --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fluentHost&quot;</span> <span class="attr">source</span>=<span class="string">&quot;logback.fluent.host&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--EFK 端口 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fluentPort&quot;</span> <span class="attr">source</span>=<span class="string">&quot;logback.fluent.port&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--FLUENT输出    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FLUENT&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.more.appenders.FluentLogbackAppender&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tag</span>&gt;</span>$&#123;APP_NAME&#125;<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">remoteHost</span>&gt;</span>$&#123;fluentHost&#125;<span class="tag">&lt;/<span class="name">remoteHost</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">port</span>&gt;</span>$&#123;fluentPort&#125;<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">layout</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;LOG_FORMAT&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>动态配置<code>application</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.cloud.config.logback-profile</span>=<span class="string">FLUENT</span></span><br><span class="line"><span class="meta">logback.fluent.host</span>=<span class="string">$&#123;LOGBACK_FLUENT_HOST:xxx.cn&#125;</span></span><br><span class="line"><span class="meta">logback.fluent.port</span>=<span class="string">$&#123;LOGBACK_FLUENT_PORT:14021&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>然后运行springboot触发日志</p>
</li>
<li><p>然后去页面配置见<a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/c45ad29ce31262441753e2c0.html">日志EFK框架中elastic的配置使用</a></p>
</li>
</ol>
<h2 id="EFK-ELK部署"><a href="#EFK-ELK部署" class="headerlink" title="EFK/ELK部署"></a>EFK/ELK部署</h2><p>参考<a target="_blank" rel="noopener" href="https://github.com/deviantony/docker-elk">deviantony/docker-elk</a></p>
<p><code>docker-stack.yml</code>内容如下</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.9.0</span></span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">elastic_config</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/usr/share/elasticsearch/config/elasticsearch.yml</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ES_JAVA_OPTS:</span> <span class="string">&quot;-Xmx256m -Xms256m&quot;</span></span><br><span class="line">      <span class="attr">ELASTIC_PASSWORD:</span> <span class="string">changeme</span></span><br><span class="line">      <span class="attr">discovery.type:</span> <span class="string">single-node</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.hostname</span> <span class="string">==</span> <span class="string">me</span>]</span><br><span class="line">  <span class="attr">logstash:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/logstash/logstash:7.9.0</span>    </span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">logstash_config</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/usr/share/logstash/config/logstash.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">logstash_pipeline</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/usr/share/logstash/pipeline/logstash.conf</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">LS_JAVA_OPTS:</span> <span class="string">&quot;-Xmx256m -Xms256m&quot;</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.hostname</span> <span class="string">==</span> <span class="string">me</span>]</span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/kibana/kibana:7.9.0</span>  </span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">    <span class="comment">#无效，但是似乎不重要</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span>      </span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;14020:5601&quot;</span></span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">kibana_config</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/usr/share/kibana/config/kibana.yml</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.hostname</span> <span class="string">==</span> <span class="string">me</span>]</span><br><span class="line">  <span class="attr">filebeat:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/beats/filebeat:7.9.0</span>    </span><br><span class="line">    <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">filebeat</span> <span class="string">-e</span> <span class="string">-strict.perms=false</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span>    </span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">filebeat_config</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/usr/share/filebeat/filebeat.yml</span></span><br><span class="line">    <span class="attr">volumes:</span>   </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/lib/docker/containers:/var/lib/docker/containers:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock:ro</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.hostname</span> <span class="string">==</span> <span class="string">me</span>]</span><br><span class="line">  <span class="attr">fluent:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">exxk/fluent-elasticsearch:latest</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span>     </span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;14021:24224&quot;</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;14021:24224/udp&quot;</span></span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">source:</span> <span class="string">fluent_config</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">/fluentd/etc/fluent.conf</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.hostname</span> <span class="string">==</span> <span class="string">me</span>]        </span><br><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">elastic_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">logstash_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">logstash_pipeline:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">kibana_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">filebeat_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">fluent_config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>各个配置文件配置内容如下:</p>
<p><code>elastic_config</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">## Default Elasticsearch configuration from Elasticsearch base image.</span></span><br><span class="line"><span class="comment">## https://github.com/elastic/elasticsearch/blob/master/distribution/docker/src/docker/config/elasticsearch.yml</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">&quot;docker-cluster&quot;</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## X-Pack settings</span></span><br><span class="line"><span class="comment">## see https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-xpack.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">xpack.license.self_generated.type:</span> <span class="string">trial</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.monitoring.collection.enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><code>kibana_config</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">## Default Kibana configuration from Kibana base image.</span></span><br><span class="line"><span class="comment">## https://github.com/elastic/kibana/blob/master/src/dev/build/tasks/os_packages/docker_generator/templates/kibana_yml.template.js</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">server.name:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [ <span class="string">&quot;http://elasticsearch:9200&quot;</span> ]</span><br><span class="line"><span class="attr">monitoring.ui.container.elasticsearch.enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## X-Pack security credentials</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">changeme</span></span><br></pre></td></tr></table></figure>

<p><code> logstash_config</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">## Default Logstash configuration from Logstash base image.</span></span><br><span class="line"><span class="comment">## https://github.com/elastic/logstash/blob/master/docker/data/logstash/config/logstash-full.yml</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">http.host:</span> <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="attr">xpack.monitoring.elasticsearch.hosts:</span> [ <span class="string">&quot;http://elasticsearch:9200&quot;</span> ]</span><br><span class="line"></span><br><span class="line"><span class="comment">## X-Pack security credentials</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">xpack.monitoring.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">xpack.monitoring.elasticsearch.username:</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">xpack.monitoring.elasticsearch.password:</span> <span class="string">changeme</span></span><br></pre></td></tr></table></figure>

<p><code>logstash_pipeline</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">input</span> &#123;</span><br><span class="line">	<span class="string">tcp</span> &#123;</span><br><span class="line">		<span class="string">port</span> <span class="string">=&gt;</span> <span class="number">5000</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Add your filters / logstash plugins configuration here</span></span><br><span class="line"></span><br><span class="line"><span class="string">output</span> &#123;</span><br><span class="line">	<span class="string">elasticsearch</span> &#123;</span><br><span class="line">		<span class="string">hosts</span> <span class="string">=&gt;</span> <span class="string">&quot;elasticsearch:9200&quot;</span></span><br><span class="line">		<span class="string">user</span> <span class="string">=&gt;</span> <span class="string">&quot;elastic&quot;</span></span><br><span class="line">		<span class="string">password</span> <span class="string">=&gt;</span> <span class="string">&quot;changeme&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>filebeat_config</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filebeat.config:</span></span><br><span class="line">  <span class="attr">modules:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">$&#123;path.config&#125;/modules.d/*.yml</span></span><br><span class="line">    <span class="attr">reload.enabled:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">filebeat.autodiscover:</span></span><br><span class="line">  <span class="attr">providers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">docker</span></span><br><span class="line">      <span class="attr">hints.enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">add_cloud_metadata:</span> <span class="string">~</span></span><br><span class="line"></span><br><span class="line"><span class="attr">output.elasticsearch:</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">&#x27;elasticsearch:9200&#x27;</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">&#x27;elastic&#x27;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&#x27;changeme&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>fluent_config</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># fluentd/conf/fluent.conf</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">  @type forward</span><br><span class="line">  port 24224</span><br><span class="line">  bind 0.0.0.0</span><br><span class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">match</span> *<span class="attr">.</span>**&gt;</span></span><br><span class="line">  @type copy</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">store</span>&gt;</span></span><br><span class="line">    @type elasticsearch</span><br><span class="line">    host elasticsearch</span><br><span class="line">    port 9200</span><br><span class="line">    logstash_format true</span><br><span class="line">    logstash_prefix fluentd</span><br><span class="line">    logstash_dateformat %Y%m%d</span><br><span class="line">    include_tag_key true</span><br><span class="line">    type_name access_log</span><br><span class="line">    tag_key @log_name</span><br><span class="line">    flush_interval 1s</span><br><span class="line">    user elastic</span><br><span class="line">	password changeme    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">store</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">store</span>&gt;</span></span><br><span class="line">    @type stdout</span><br><span class="line">  <span class="tag">&lt;/<span class="name">store</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.iexxk.com/2020/08/18/spring-autoconfiguration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/headimg.jpg">
      <meta itemprop="name" content="e想行空">
      <meta itemprop="description" content="e想天开，天马行空">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="e想行空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/08/18/spring-autoconfiguration/" class="post-title-link" itemprop="url">Spring AutoConfiguration</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-08-18 14:31:27 / 修改时间：17:59:15" itemprop="dateCreated datePublished" datetime="2020-08-18T14:31:27+00:00">2020-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
    <span id="/2020/08/18/spring-autoconfiguration/" class="post-meta-item leancloud_visitors" data-flag-title="Spring AutoConfiguration" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>springboot的配置使用很简单，也经常用，下面就是常用的AutoConfiguration入口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration</span> <span class="comment">//启用自动配置</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>但是这里主要讲下自动配置的禁用</p>
<h2 id="如何禁用某些自动配置"><a href="#如何禁用某些自动配置" class="headerlink" title="如何禁用某些自动配置"></a>如何禁用某些自动配置</h2><h3 id="需求场景"><a href="#需求场景" class="headerlink" title="需求场景"></a>需求场景</h3><ol>
<li>在公共依赖里面引入了数据库的依赖，你会发现，某些项目不需要数据库，但是由于公共依赖，也得配置数据库的连接地址</li>
<li>例如使用spring cloud config-bus热更新配置时，这个功能属于可选功能，因为有些环境可能不支持mq，但是不能每次打包都把依赖移除</li>
</ol>
<h3 id="禁用设置"><a href="#禁用设置" class="headerlink" title="禁用设置"></a>禁用设置</h3><h4 id="启动文件的修改"><a href="#启动文件的修改" class="headerlink" title="启动文件的修改"></a>启动文件的修改</h4><p>主要是在启动类上面的<code>@EnableAutoConfiguration</code>注解添加参数<code>exclude</code>后面填入需要禁用的启动类，这种适合场景1，因为已经确定这个服务是不需要这个配置的了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAutoConfiguration(exclude = &#123;MongoAutoConfiguration.class, MongoDataAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置文件的修改"><a href="#配置文件的修改" class="headerlink" title="配置文件的修改"></a>配置文件的修改</h4><p>在<code>application.properties</code>里面添加<code>spring.autoconfigure.exclude</code>这个配置项，这个就很灵活了，只需要修改配置文件，就可以开启或禁用某些功能</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.autoconfigure.exclude</span>=<span class="string">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,org.springframework.boot.actuate.autoconfigure.metrics.amqp.RabbitMetricsAutoConfiguration,org.springframework.boot.actuate.autoconfigure.amqp.RabbitHealthIndicatorAutoConfiguration,org.springframework.boot.actuate.autoconfigure.health.HealthEndpointAutoConfiguration,org.springframework.cloud.bus.BusAutoConfiguration</span></span><br></pre></td></tr></table></figure>

<h3 id="常用的实战场景"><a href="#常用的实战场景" class="headerlink" title="常用的实战场景"></a>常用的实战场景</h3><p>禁用操作很简单，但是要找到合适的配置禁用，这就需要了解功能用到了那些自动配置项，下面介绍几个常用场景，需要禁用的自动配置类</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mongodb数据库 依赖 org.springframework.data:spring-data-mongodb</span></span><br><span class="line"><span class="meta">spring.autoconfigure.exclude</span>=<span class="string">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration</span></span><br><span class="line"><span class="comment">#redis数据库 依赖 org.springframework.boot:spring-boot-starter-data-redis</span></span><br><span class="line"><span class="meta">spring.autoconfigure.exclude</span>=<span class="string">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration</span></span><br><span class="line"><span class="comment">#rabbitMQ 依赖 org.springframework.boot:spring-boot-starter-amqp</span></span><br><span class="line"><span class="meta">spring.autoconfigure.exclude</span>=<span class="string">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration</span></span><br><span class="line"><span class="comment">#springCloud-Bus 依赖org.springframework.cloud:spring-cloud-starter-bus-amqp</span></span><br><span class="line"><span class="meta">spring.autoconfigure.exclude</span>=<span class="string">org.springframework.cloud.bus.BusAutoConfiguration,org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration</span></span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">e想行空</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>




<script>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/mermaid@8.9.1/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  




  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.1.0/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink.listen({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://blog.iexxk.com/page/2/',]
      });
      });
  </script>

<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"Knshftme94xEJM6dEEop4Qnq-gzGzoHsz","appKey":"UpNFcvVri9iYUjDznVdodui4","serverURLs":"https://knshftme.lc-cn-n1-shared.com","placeholder":"Just go go","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":true,"comment_count":true,"recordIP":true,"enableQQ":false,"requiredFields":[]}, {
      el: '#valine-comments',
      path: "/page/2/",
      serverURLs: "https://knshftme.lc-cn-n1-shared.com"
    }));
  }, window.Valine);
});
</script>

</body>
</html>
